(function(){$.ajax({url:"//munchkin.marketo.net/munchkin.js",dataType:"script",cache:true,success:function(){Munchkin.init("369-GED-718",{cookieAnon:true})}});(function(){if(!window.GLIFFY){window.GLIFFY={}}if(!window.GLIFFY.ENV){window.GLIFFY.ENV={}}if(!window.GLIFFY.FEATURES){window.GLIFFY.FEATURES={}}GLIFFY.FEATURES.browserTabs=true;GLIFFY.FEATURES.charts=false;GLIFFY.FEATURES.tables=false;GLIFFY.FEATURES.premiumLibraries=true;GLIFFY.FEATURES.umlV1=true;GLIFFY.FEATURES.umlV2=true;GLIFFY.FEATURES.uiV2=true;GLIFFY.FEATURES.uiV3=true;GLIFFY.FEATURES.allowDisableAutosave=true;GLIFFY.FEATURES.mindmaps=true;GLIFFY.FEATURES.mindmapsAutoLayout=true;GLIFFY.FEATURES.popupNotesViewer=true;GLIFFY.FEATURES.svgPrint=false;GLIFFY.FEATURES.showPremiumShapesLocked=false;GLIFFY.FEATURES.labsMenu=false}());(function(){window.GLIFFY.onlineUtils={predecorate:function(a,b,d){var c=a.prototype[b];a.prototype[b]=function(){d.apply(this,arguments);return c.apply(this,arguments)}},postdecorate:function(a,b,c){var d=a.prototype[b];a.prototype[b]=function(){var e=[d.apply(this,arguments)].concat(Array.prototype.slice.call(arguments,0));return c.apply(this,e)}},override:function(b,c,a){b.prototype[c]=a},appendTemplates:function(a,c){var b;for(b=0;b<a.length;b++){window.GLIFFY.onlineUtils.appendTemplate(a[b],c)}},appendTemplate:function(a,b){b=b||"gliffy-popup-container";setTimeout(function(){var c=Ember.View.create({templateName:a});Ember.View.views[b].pushObject(c)},1)},requireCondition:function(c,a,b){return function(){var d=this,e=arguments,f=d._super;c(function(){var g=d._super;d._super=f;a.apply(d,e);d._super=g},function(){if(b){var g=d._super;d._super=f;b.apply(d,e);d._super=g}})}},requireEmailVerification:function(b,a){return GLIFFY.onlineUtils.requireCondition(function(c,d){GliffyApp.authController.requireAuth(function(){GliffyApp.authController.requireEmailVerification(c,d)},d)},b,a||null)},requireAuth:function(b,a){return GLIFFY.onlineUtils.requireCondition(function(c,d){GliffyApp.authController.requireAuth(c,d)},b,a||null)},requireAccountPermission:function(a,c,b){return GLIFFY.onlineUtils.requireCondition(function(d,e){GliffyApp.authController.requireAuth(function(){GliffyApp.authController.requireAccountPermission(a,d,e)},e)},c,b||null)},setLocation:function(a){if(window.history&&window.history.replaceState){window.history.replaceState({},document.title,a)}},setDocumentLocation:function(b){var a=window.location.pathname;a=a.replace(/\/[^\/]*$/,"/"+b);this.setLocation(a+window.location.search);window.name="gliffy"+b},setWindowTitle:function(a){document.title=a},updateQueryString:function(b,d,a){if(!a){a=window.location.href}var c=new RegExp("([?|&])"+b+"=.*?(&|#|$)(.*)","gi");if(c.test(a)){if(typeof d!=="undefined"&&d!==null){return a.replace(c,"$1"+b+"="+d+"$2$3")}else{return a.replace(c,"$1$3").replace(/(&|\?)$/,"")}}else{if(typeof d!=="undefined"&&d!==null){var f=a.indexOf("?")!==-1?"&":"?",e=a.split("#");a=e[0]+f+b+"="+d;if(e[1]){a+="#"+e[1]}return a}else{return a}}},formatFormError:function(c){var b=Array();for(var a=0;a<c.length;a++){if(c[a].key==="global"){b.push(c[a].message)}else{b.push(c[a].key+": "+c[a].message)}}return b.join("<br/>")},setModalErrorMessage:function(a,b){if(typeof(b)!=="string"){b=window.GLIFFY.onlineUtils.formatFormError(b)}$(a).find(".ember-view > .alert").show().children("span").html(b)},isValidEmail:function(b,e){var d=new RegExp("^([\\w+!#$%&'*+-/=?^_`{|}~.])+@(([a-z\\d-]+)|([a-z\\d-]+\\.[a-z\\d-]+))+\\.[a-z]+$","gi");var a=d.exec(b);if(a!==null){var c=a[1];if((c.indexOf(".")!==c.length-1)&&c.indexOf("..")===-1){return true}}return false},feedbackInit:function(){var b={feedback:"c86a7d4a",error:"7aa05b3b"};jQuery.ajax({url:"https://jira.gliffy.com/s/en_US-53ss6r/734/4/1.2.5/_/download/batch/com.atlassian.jira.collector.plugin.jira-issue-collector-plugin:issuecollector-embededjs/com.atlassian.jira.collector.plugin.jira-issue-collector-plugin:issuecollector-embededjs.js?collectorId="+b.feedback,type:"get",cache:true,dataType:"script"});jQuery.ajax({url:"https://jira.gliffy.com/s/en_US-53ss6r/734/4/1.2.5/_/download/batch/com.atlassian.jira.collector.plugin.jira-issue-collector-plugin:issuecollector-embededjs/com.atlassian.jira.collector.plugin.jira-issue-collector-plugin:issuecollector-embededjs.js?collectorId="+b.error,type:"get",cache:true,dataType:"script"});var a={};a[b.feedback]={triggerFunction:function(c){$("#gliffy-anchor-feedback").click(function(d){d.preventDefault();c()})}};a[b.error]={triggerFunction:function(c){$("body").bind("send-error.gliffy-body",function(e,d){console.log("error ",d.message,d.report);window.ATL_JQ_PAGE_PROPS[b.error].fieldValues.description=d.report;c()})}};window.ATL_JQ_PAGE_PROPS=jQuery.extend(window.ATL_JQ_PAGE_PROPS,a)},handleDiagramActionError:function(g,f,b,d,c){var e=b+": "+d,a;if(g.status===404){e=$.i18n._("online.404.error",[d]);g.responseText=e;a=$.i18n._("online.404.error.title")}if(c){window.GLIFFY.Dialog.showAlertDialog({content:e,title:a})}return e},getFileHandle:function(a){if(a===undefined||a===null){return""}else{return a.substring(a.lastIndexOf(".")+1)}},downloadFile:function(e,b,j){var d=function(m,l,k){};var i="download" in document.createElement("a");var f=window.BlobBuilder||window.WebKitBlobBuilder||window.MozBlobBuilder||window.MSBlobBuilder;var g=window.URL||window.webkitURL||window.mozURL||window.msURL;navigator.saveBlob=navigator.saveBlob||navigator.msSaveBlob||navigator.mozSaveBlob||navigator.webkitSaveBlob;window.saveAs=window.saveAs||window.webkitSaveAs||window.mozSaveAs||window.msSaveAs;var c={"image/jpeg":true,"image/png":true,"image/gif":true,"image/svg+xml":true,"image/bmp":true,"image/x-windows-bmp":true,"image/webp":true,"audio/wav":true,"audio/mpeg":true,"audio/webm":true,"audio/ogg":true,"video/mpeg":true,"video/webm":true,"video/ogg":true,"text/plain":true,"text/html":true,"text/xml":true,"application/xhtml+xml":true,"application/json":true};if(f&&(window.saveAs||navigator.saveBlob)){d=function(n,m,o){var l=new f();l.append(n);var k=l.getBlob(j||"application/octet-stream");if(!m){m="Download.bin"}if(window.saveAs){window.saveAs(k,m)}else{navigator.saveBlob(k,m)}}}else{if(f&&g){d=function(r,o,k){var m,n,l=new f();l.append(r);if(!k){k="application/octet-stream"}if(i){m=l.getBlob(k);n=g.createObjectURL(m);var q=document.createElement("a");q.setAttribute("href",n);q.setAttribute("download",o||"Download.bin");var p=document.createEvent("MouseEvents");p.initMouseEvent("click",true,true,window,1,0,0,0,0,false,false,false,false,0,null);q.dispatchEvent(p)}else{if(c[k.split(";")[0]]===true){k="application/octet-stream"}m=l.getBlob(k);n=g.createObjectURL(m);window.open(n,"_blank","")}setTimeout(function(){g.revokeObjectURL(n)},250)}}else{if(i){var h=document.createElement("a");h.setAttribute("href",e);h.setAttribute("download",b);var a=document.createEvent("MouseEvents");a.initMouseEvent("click",true,true,window,1,0,0,0,0,false,false,false,false,0,null);h.dispatchEvent(a)}else{if(/\bSafari\b/.test(navigator.userAgent)){var h=document.createElement("a");h.setAttribute("href",e);var a=document.createEvent("MouseEvents");a.initMouseEvent("click",true,true,window,1,0,0,0,0,false,false,false,false,0,null);h.dispatchEvent(a)}else{if(!/\bMSIE\b/.test(navigator.userAgent)){d=function(m,l,k){if(!k){k="application/octet-stream"}if(c[k.split(";")[0]]===true){k="application/octet-stream"}window.open(m,"_blank","")}}}}}}d(e,b,j)}}}());(function(){var b=window.location.protocol+"//"+window.location.host,a;function d(){var f,e;if(GLIFFY.ENV.app==="d8e91192-2f34-471c-80a6-900880844ffd"&&GliffyApp.authController){f=GliffyApp.authController.getUserID()||"0";e=GliffyApp.authController.getUserToken()||"NOT_A_TOKEN";return{uid:f,token:e}}return{}}function c(e){return e.split("?")[0]}a=GLIFFY.Class.extend({getApiRoot:function(){return b},getQueryUrl:function(f,i){var g,e=[],h="";for(g in i){if(i.hasOwnProperty(g)&&i[g]!==null){e.push(encodeURIComponent(g)+"="+encodeURIComponent(i[g]))}}if(e.length>0){h=e.join("&");if(f.indexOf("?")===-1){h="?"+h}else{h="&"+h}}return f+h},reauthUrl:function(f){var e=$.url(f),g=e.param();delete g.uid;delete g.token;return this.getAuthUrl(c(f),g)},getAuthUrl:function(e,g){var f=d();if(/\?(.*&)?uid=/.test(e)){delete f.uid}if(/\?(.*&)?token=/.test(e)){delete f.token}if(g){f=$.extend(f,g)}return this.getQueryUrl(e,f)},getActionUrl:function(g,f){var e;if(/\/$/.test(b)){e=b+g}else{e=b+"/"+g}return this.getAuthUrl(e,f)},GET:function(f,e){e=e||{};this._ajax("GET",f,e.query||null,null,e.isUrl||false,e.success||null,e.error||null,e.context||null)},POST:function(g,f,e){e=e||{};this._ajax("POST",g,e.query||null,f||null,e.isUrl||false,e.success||null,e.error||null,e.context||null)},PUT:function(g,f,e){e=e||{};this._ajax("PUT",g,e.query||null,f||null,e.isUrl||false,e.success||null,e.error||null,e.context||null)},DELETE:function(f,e){e=e||{};this._ajax("DELETE",f,e.query||null,null,e.isUrl||false,e.success||null,e.error||null,e.context||null)},_ajax:function(n,e,m,i,o,g,j,f){var l,k,h={type:n,url:o?this.getAuthUrl(e,m||{}):this.getActionUrl(e,m||{})};k=function(){GLIFFY.API._ajax(n,e,m,i,o,g,j,f)};l=j?function(r,p,q){j.call(f||window,r,p,q)}:function(){};if(i){h.processData=false;if(window.File&&i instanceof window.File){h.data=i;h.contentType="application/octet-stream"}else{h.data=JSON.stringify(i);h.contentType="application/json"}}if(g){h.success=function(q,r,p){g.call(f||window,q,r,p);k=null;l=null}}else{h.success=function(q,r,p){k=null;l=null}}h.error=function(r,p,q){if(r.status===401&&GliffyApp.authController){GliffyApp.authController.redirectToLogin(k,function(){l(r,p,q)})}else{l(r,p,q)}};$.ajax(h)}});if(!window.GLIFFY.API){window.GLIFFY.API={}}window.GLIFFY.API.init=function(e){if(e===undefined||e===null){throw new Error("apiRoot was not specified when initializing the API object.")}b=e;window.GLIFFY.API=new a()}}());(function(){GLIFFY.DragProxy=GLIFFY.Class.extend({init:function(a,c,b){this.originalX=c||0;this.originalY=b||0;this.threshold=a||0;this.duration=300;this.element=null},setElement:function(a){this.element=a},getElement:function(){return this.element},aboveThreshold:function(a,b){a-=this.originalX;b-=this.originalY;return this.threshold*this.threshold*2<a*a+b*b},activate:function(c,a){var b=this;$("#super-ui-blocker").show();$(document).bind("mousemove.drag",function(d){b.move(d.pageX,d.pageY);c(d)}).bind("mouseup.drag",function(d){b.deactivate();a(d,function(e){if(e){b.drop()}else{b.cancel()}})})},deactivate:function(){$(document).unbind(".drag");$("#super-ui-blocker").hide()},move:function(a,b){$(this.element).css({top:b,left:a})},drop:function(){var a=$(this.element);a.css({width:a.width()+"px",height:a.height()+"px",overflow:"hidden",whiteSpace:"nowrap"});a.animate({width:"10px",left:"10px",opacity:0},this.duration,function(){a.remove()})},cancel:function(){var a=$(this.element);a.animate({opacity:0,left:this.originalX+"px",top:this.originalY+"px"},this.duration,function(){a.remove()})}})}());(function(){GliffyApp.DocumentListItemModel=Ember.Object.extend({name:null,isFavorite:null,lastModified:null,lastModifiedFriendly:null,createDate:null,createDateFriendly:null,isPublic:false,createdBy:null,lastModifiedBy:null,currentlyEditedBy:null,urls:{thumbnail:null,open:null,update:null},"read-only":null,isBeingEdited:Ember.computed(function(){var a=this.get("currentlyEditedBy");return(a!==undefined&&a!==null&&a!=="N/A")}).property("currentlyEditedBy").cacheable(),isGliffyOnline:Ember.computed(function(){return this.get("type")===GliffyApp.accountFoldersController.GLIFFY_ONLINE_DIAGRAM_STORAGE_TYPE}).property("type").cacheable(),isGoogleDrive:Ember.computed(function(){return this.get("type")===GliffyApp.accountFoldersController.GOOGLE_DRIVE_DIAGRAM_STORAGE_TYPE}).property("type").cacheable(),tooltip:Ember.computed(function(){if(this.isEditable){return this.get("name")+", click to edit"}else{return this.get("name")}}).property("name").cacheable(),isEditable:false,isEditingName:false,isLoaded:false})}());(function(){GliffyApp.ImageInfoModel=Ember.Object.create({filename:null,height:null,id:null,image:null,size:null,tags:null,thumbnail:null,tid:null,uid:null,url:null,useOriginalDimensions:null,width:null,populate:function(a){this.set("filename",a.filename);this.set("height",a.height);this.set("id",a.id);this.set("image",a.image);this.set("size",a.size/1000);this.set("tags",a.tags);this.set("thumbnail",a.thumbnail);this.set("tid",a.tid);this.set("uid",a.uid);this.set("url",a.url);this.set("useOriginalDimensions",a.useOriginalDimensions);this.set("width",a.width);if(this.get("filename")==null){this.set("filename","import")}}})}());(function(){GliffyApp.UserModel=Ember.Object.extend({uid:null,token:null,username:null,createdDate:null,OptOut:false,isConfirmed:false,terms:false,isTempPwd:false,authenticated:false,accountUsers:false,currentAccount:null,userPreferences:null,gDriveOAuth2:false,isAuthenticated:Ember.computed(function(){return(this.get("authenticated")||this.get("token")!==null)&&this.get("uid")!==null}).property("token","uid"),init:function(){this.set("accountUsers",Ember.A([]))},displayName:Ember.computed(function(){if(this.get("username")){return this.get("username")}else{return"Demo User"}}).property("username"),optIn:Ember.computed(function(){return(!this.get("OptOut"))}).property("OptOut"),hasGDriveOAuth2:Ember.computed(function(){return(this.get("gDriveOAuth2"))}).property("gDriveOAuth2"),populate:function(b){this.set("authenticated",b.authenticated||null);this.set("uid",b.uid||null);this.set("username",b.username||null);this.set("createdDate",b.createdDate||null);this.set("token",b.token||null);this.set("OptOut",b.optOut||null);this.set("isConfirmed",b.isConfirmed||null);this.set("terms",b.token||null);this.set("isTempPwd",b.optOut||null);this.set("munchkinKey",b.munchkinKey||null);this.set("accountUsers",Ember.A([]));this.set("gDriveOAuth2",b.hasGDriveOAuth2||false);var c=GliffyApp.authController.getAccountId();if(typeof GliffyApp.documentManagerController!="undefined"){GliffyApp.documentManagerController.propertyWillChange("showSwitcher")}for(var a=0;a<b.accountUsers.length;a++){var d=GliffyApp.AccountUserListItem.create({accountId:b.accountUsers[a].accountId,productId:b.accountUsers[a].productId,accountName:b.accountUsers[a].name,userRole:b.accountUsers[a].userRole,isDefault:b.accountUsers[a].isDefault});if(b.accountUsers[a].accountId==c){this.set("currentAccount",d)}this.accountUsers.pushObject(d)}if(typeof GliffyApp.documentManagerController!="undefined"){GliffyApp.documentManagerController.propertyDidChange("showSwitcher")}},loadPreferences:function(c,b){var a=this;this.set("userPreferences",null);GLIFFY.API.GET("user/getAllUserPreferences",{success:function(d){a.getUserPreferences().setProperties(d);if(c){c(a)}},error:function(f,d,e){if(b){b(f,d,e)}console.error("error getting user preferences",f,d,e)}})},getUserPreferences:function(){if(this.get("userPreferences")===null){this.userPreferences=Ember.Object.create();this.get("userPreferences").setProperties(this.DEFAULT_USER_PREFERENCES)}return this.get("userPreferences")},setPreference:function(b,c){var a=this;this.getUserPreferences().set(b,c);GLIFFY.API.GET("user/setUserPreference?prefKey="+b+"&prefValue="+c,{success:function(d){},error:function(f,d,e){console.error("error setting user preference",f,d,e)}})},fetch:function(e,c){var b=this.get("uid"),a=this,d;if(b!==0){GLIFFY.API.GET("user.json",{success:function(f){a.populate(f);if(e){e(a)}},error:c})}},DEFAULT_USER_PREFERENCES:{printerPaperSize:"LETTER",navigatorOn:"true",SHAPE_LIBRARY_TIP:{shown:"false"}},switchAbleAccounts:Ember.computed(function(){var a=Ember.A([]),c=this;var b=c.get("accountUsers");for(var d=0;d<b.length;d++){if(b[d].get("productId").indexOf("GAPP")===-1){a.push(b[d])}}return a}).property("accountUsers")});GliffyApp.AccountUserListItem=Ember.Object.extend({accountId:null,productId:null,accountName:null,userRole:"USER",isDefault:false})}());(function(){var c=1024*1024;var a=0;var d=999999999;var b="unlimited";GliffyApp.AccountModel=Ember.Object.extend({id:null,userRole:null,status:null,name:null,daysLeftUntilExpiration:null,appsDomain:null,apiKey:null,apiSecret:null,storage:null,userCount:null,diagramCount:null,featureSet:null,isTrial:null,isAcademic:null,dateOfNextRecurringBilling:null,productId:null,productDescription:null,productType:null,maxDiagrams:null,maxStorage:null,maxUsers:null,trxnId:null,accountMetadata:null,init:function(){this.set("id",0);this.set("productType","unauthorized")},isSuspended:Ember.computed(function(){return(this.get("status")=="Suspended")}).property("status"),displayName:Ember.computed(function(){if(this.get("id")!==0){return this.get("name")}else{return"Demo Account"}}).property("id","name"),populate:function(e){GliffyApp.authController.propertyWillChange("isLoggedIn");this.set("id",e.id||0);this.set("userRole",e.userRole);this.set("status",e.status);this.set("name",e.name);this.set("daysLeftUntilExpiration",e.daysLeftUntilExpiration);this.set("appsDomain",e.appsDomain);this.set("apiKey",e.apiKey);this.set("apiSecret",e.apiSecret);this.set("storage",e.storage);this.set("userCount",e.userCount);this.set("diagramCount",e.diagramCount);this.set("featureSet",e.featureSet);this.set("isTrial",e.isTrial);this.set("isAcademic",e.isAcademic);this.set("dateOfNextRecurringBilling",e.dateOfNextRecurringBilling);this.set("productId",e.productId);this.set("productDescription",e.productDescription);this.set("productType",e.productType||"unauthorized");this.set("maxDiagrams",e.maxDiagrams||0);this.set("maxStorage",e.maxStorage||0);this.set("maxUsers",e.maxUsers||0);this.set("trxnId",e.trxnId||0);this.set("googleDriveUserName",e.googleDriveUserName||0);this.set("googleDriveUserEmail",e.googleDriveUserEmail||0);this.set("googleDriveUserIcon",e.googleDriveUserIcon||0);this.set("accountMetadata",e.accountMetadata||0);if(this.maxDiagrams===d){this.set("maxDiagrams",b)}if(this.maxStorage===d){this.set("maxStorage",b)}GLIFFY.Utils.analyticsEvent("setCustomVariables",{product:null,license:this.get("productType"),numUsers:(this.get("maxUsers")+" Users")});GliffyApp.authController.propertyDidChange("isLoggedIn");GliffyApp.authController.accountIsLoaded(this)},fetch:function(h,f){var i=this.get("id"),e=this,g;g={};if(i!==null){g.accountId=i}else{if(i==a){g.accountId=null}}GLIFFY.API.GET("account/settings.json",{query:g,success:function(j){e.populate(j);if(h){h(e)}},error:function(j){if(j.status==400){GliffyApp.authController.noAccount()}if(f){f(e)}}})},isUpgradeVisible:Ember.computed(function(){var e=(this.get("maxStorage")-this.get("storage"))/c;return !GliffyApp.authController.isAnonymousAccount()&&e<=5&&e>=0}).property("storage","maxStorage"),permissions_collaboration:Ember.computed(function(){return $.inArray("COLLABORATE",this.featureSet)>-1}).property("productType"),permissions_userCount:Ember.computed(function(){return this.__hasQuantityPermission("userCount","maxUsers")}).property("userCount","maxUsers"),permissions_diagramCount:Ember.computed(function(){return this.__hasQuantityPermission("diagramCount","maxDiagrams")}).property("diagramCount","maxDiagrams"),permissions_storage:Ember.computed(function(){return this.__hasQuantityPermission("storage","maxStorage")}).property("storage","maxStorage"),__hasQuantityPermission:function(g,f){var e=this.get(f);if(e===b){return true}else{return e-this.get(g)>0}},hasPermission:function(e){return this.get("permissions_"+e)},diagramsLeft:Ember.computed(function(){var e=this.get("maxDiagrams")-this.get("diagramCount");if(e<0){return 0}else{return e}}).property("diagramCount","maxDiagrams"),hasDiagramsLeft:Ember.computed(function(){return(this.get("diagramsLeft")>0)}).property("diagramsLeft"),isLowOnDiagrams:Ember.computed(function(){return(this.get("diagramsLeft")>0&&this.get("diagramsLeft")<6)}).property("diagramsLeft"),storageLeft:Ember.computed(function(){var e=Math.round(((this.get("maxStorage")-this.get("storage"))/c)*10)/10;if(e<0){e=0}return e+"MB"}).property("storage","maxStorage"),storageUsed:Ember.computed(function(){return Math.round(((this.get("storage"))/c)*100)/100+"MB"}).property("storage","maxStorage"),isGDocsFreemium:Ember.computed(function(){return this.get("productId")===("GOOG_GDOCS_FREEMIUM")}).property("productId")})}());(function(){GliffyApp.OnlineDocumentModel=GliffyApp.DocumentModel.extend({id:null,isPublic:false,folderId:null,populate:function(a){this.set("id",a.id);if(a.name!==undefined){this.set("title",a.name)}this.set("isPublic",a.isPublic)},update:function(a){this._super(a);this.set("id",a.getUrls().id);this.set("isPublic",a.getUrls().isPublic)},displayTitle:Ember.computed(function(){var a=this.get("title")+", v"+this.get("currentRevision");if(!$.isNumeric(this.get("currentRevision"))||this.get("currentRevision")<1){a=this.get("title")}return(this.get("unsavedChanges")===true?"*":"")+a}).property("title","unsavedChanges","currentRevision")});GliffyApp.documentModel=GliffyApp.OnlineDocumentModel.create()}());(function(){GliffyApp.CollaboratorsModel=Ember.ArrayProxy.extend({toObject:function(){var a={collaborators:[]};this.forEach(function(d,c,b){a.collaborators[a.collaborators.length]=d.toObject()});return a},fromObject:function(d){var c=Ember.A([]);for(var b=0;b<d.collaborators.length;b++){var a=GliffyApp.CollaboratorModel.create();a.fromObject(d.collaborators[b]);c.pushObject(a)}this.set("content",c)}})}());(function(){GliffyApp.CollaboratorModel=Ember.Object.extend({userId:null,permissions:Ember.computed(function(){if(this.get("isOwner")){return"Owner"}else{if(this.get("isCollaborator")){return"View & Edit"}else{return"View Only"}}}).property("isOwner","isViewer","isCollaborator"),canRemove:Ember.computed(function(){if(this.get("id")===Number(GliffyApp.authController.getUserID())){return false}return true}).property("isOwner","id"),toObject:function(){var a={};a.id=this.get("id");a.email=this.get("email");a.isCollaborator=this.get("isCollaborator");a.isViewer=this.get("isViewer");a.isOwner=this.get("isOwner");return a},fromObject:function(a){this.setProperties(a)}})}());(function(){GliffyApp.OnlineToolbarController=GliffyApp.ToolbarController.extend({actions:{menuRename:function(){$("#gliffy-rename-document-modal .gliffy-input-modal-error").hide();$("#gliffy-rename-document-modal .modal").modal("show");$("#gliffy-rename-document-modal input").val(GliffyApp.documentModel.title);$("#gliffy-rename-document-modal input").select()},menuSaveAs:function(){GliffyApp.saveDialogController.show();GliffyApp.saveDialogController.mode=GliffyApp.saveDialogController.DIALOG_MODE_SAVE_AS}},doNew:window.GLIFFY.onlineUtils.requireAccountPermission("diagramCount",function(){this._super();GLIFFY.Utils.analyticsEvent("trackEvent",{category:"menuClick",action:"new"})}),doOpen:window.GLIFFY.onlineUtils.requireAuth(function(){this._super()}),doSave:window.GLIFFY.onlineUtils.requireAuth(function(){this._super()}),doSaveAndClose:window.GLIFFY.onlineUtils.requireAuth(function(){this._super()}),doClose:function(){this._super()},doExportSvg:window.GLIFFY.onlineUtils.requireAuth(function(){this._super()}),doExportImage:window.GLIFFY.onlineUtils.requireAuth(function(c,b,a){this._super(c,b,a)}),doExportData:window.GLIFFY.onlineUtils.requireAuth(function(b,a){this._super(b,a)}),doCollaborate:GLIFFY.onlineUtils.requireAccountPermission("collaboration",GLIFFY.onlineUtils.requireEmailVerification(function(){if(this.__editor.getDocumentManager().getActiveStage().hasUnsavedChanges()||this.__editor.getDocumentManager().getActiveDocument().isNewNotDirty()){this.__editor.postSaveCallback=function(a){GliffyApp.collaborationController.show()};this.doSave()}else{GliffyApp.collaborationController.show()}})),doPublish:window.GLIFFY.onlineUtils.requireAuth(function(){if(this.__editor.getDocumentManager().getActiveStage().hasUnsavedChanges()||this.__editor.getDocumentManager().getActiveDocument().isNewNotDirty()){this.__editor.postSaveCallback=function(a){GliffyApp.publishController.show()};this.doSave()}else{GliffyApp.publishController.show()}}),__generateSvg:function(a){this.__editor.getDocumentManager().getSvgData(this.__editor.getDocumentManager().getActiveStage(),function(c){GliffyApp.progressBarController.getBar().delay(500).queue(function(d){GliffyApp.progressBarController.hide();d()});var b=c.getSerializedSvg(true);if(a){a(b)}},true)}});GliffyApp.toolbarController=GliffyApp.OnlineToolbarController.create()}());(function(){GliffyApp.OnlineSaveDialogController=GliffyApp.SaveDialogController.extend({DEFAULT_FOLDERS:null,DIALOG_MODE_SAVE:"save",DIALOG_MODE_SAVE_AS:"saveAs",documentList:null,selectedDocument:null,actions:{handleCancel:function(){this.cancelSave()},handleSave:function(){this.applySave()},handleDocumentSelect:function(a){this.selectedDocument=a;this.getModal().find(".gliffy-save-dialog-document-list-item").removeClass("gliffy-selected").find(".gliffy-document-list-item-delete").hide();this.getSelectedDocumentDOM().addClass("gliffy-selected").find(".gliffy-document-list-item-delete").show()},handleDocumentDelete:function(){var a=this;if(this.selectedDocument!==null){this.hide();GliffyApp.documentListController.doDocumentDelete(this.selectedDocument,function(){if(GliffyApp.authController.getAccountDiagramsLeft()<=0){GLIFFY.Utils.analyticsEvent("trackEvent",{category:"saveDialog",action:"deleteDocumentAtLimit",value:GliffyApp.authController.getAccountDiagramsLeft()})}a.__removeDocumentItemDOMElement();GLIFFY.Spinner.hide({context:"deleteDiagram"})},function(b){GLIFFY.Spinner.hide({context:"deleteDiagram"});a.__displayErrorMessage(b)},function(){a.show(true)})}},handleAddFolder:function(){var a=this;this.hide();GliffyApp.accountFoldersController.showCreateFolderModal();$("#gliffy-folder-create-modal .gliffy-modal").on("hide",function(b){$("#gliffy-folder-create-modal .gliffy-modal").off("hide");a.show(true)})},upgrade:function(){GLIFFY.Utils.analyticsEvent("trackEvent",{category:"saveDialog",action:"clickUpgrade"});GliffyApp.authController.openUpgrade("saveDialog")}},getModal:function(){return $("#gliffy-save-modal")},init:function(){this.documentList=Ember.A([])},show:function(b){var a=this,c=this.getFilenameElement().val();if(!b===true){this.refresh()}GliffyApp.authController.fetchAccount(function(){},function(){a.hide();throw new Error("Unable to update account settings for showing save dialog.")});a._super();if(b){this.getFilenameElement().val(c)}else{this.getFilenameElement().blur()}},reset:function(){this.mode=this.DIALOG_MODE_SAVE;this.selectedDocument=null;this.documentList.clear();GliffyApp.accountFoldersController.defaultFolders=this.DEFAULT_FOLDERS},refresh:function(){var a=this;this.reset();this.showUIBlocker();GliffyApp.accountFoldersController.load("folder_tree_online_save.json",a.getModal().find(".gliffy-account-folders-container"),function(b){GliffyApp.accountFoldersController.showFolderContainer();if(GliffyApp.documentModel.folderId!==null&&a.getModal().find(".gliffy-account-folders-container").find("#"+GliffyApp.documentModel.folderId).length>0){GliffyApp.accountFoldersController.selectFolder("#"+GliffyApp.documentModel.folderId)}else{GliffyApp.accountFoldersController.selectFolder("#"+b)}setTimeout(function(){GliffyApp.accountFoldersController.positionSelectionBar()},100)})},applySave:function(){this.__hideErrorMessage();if(this.__validate(this.getModal().find(".gliffy-save-filename").val())){GliffyApp.documentModel.set("folderId",Number(GliffyApp.accountFoldersController.getSelectedFolderId()));if(this.mode===this.DIALOG_MODE_SAVE_AS){this.doSaveAs()}else{this._super()}}},cancelSave:function(){this.__hideErrorMessage();this._super()},doSaveAs:function(){var d=this,e=GLIFFY.editor.getDocumentManager(),b,c,a=e.getActiveDocument(),f=a.getCurrentRevision();a.setCurrentRevision(0);b=function(g){if(g.error){a.setCurrentRevision(f);GliffyApp.documentModel.update(a)}};c=function(i,g,h){a.setCurrentRevision(f);GliffyApp.documentModel.update(a)};GLIFFY.editor.__doSave(b,c)},handleFolderClick:function(a){var b="folder_diagrams.json";if(a.type===GliffyApp.accountFoldersController.GOOGLE_DRIVE_DIAGRAM_STORAGE_TYPE){b="gdrive_folder_diagrams.json"}this.__loadDocuments(b,{folderId:a.id,app:window.GLIFFY.ENV.app})},getSelectedDocumentDOM:function(){return this.getModal().find(".gliffy-save-dialog-document-list-item[data-gliffy-id='"+this.selectedDocument.id+"']")},showUIBlocker:function(){this.getModal().find(".gliffy-modal-ui-blocker").show()},hideUIBlocker:function(){this.getModal().find(".gliffy-modal-ui-blocker").hide()},showErrorMessage:function(a){this.__displayErrorMessage(a)},__removeDocumentItemDOMElement:function(){GLIFFY.Dialog.hide();this.show(true);if(this.selectedDocument!==null){this.getSelectedDocumentDOM().remove()}},__loadDocuments:function(d,c){var a=this,b,e;this.showUIBlocker();window.GLIFFY.API.GET(d,{query:c,success:function(g,h,f){a.documentList.clear();for(b=0;b<g.diagrams.length;b++){e=Ember.Object.create();e.setProperties(g.diagrams[b]);a.documentList.pushObject(e)}a.hideUIBlocker();setTimeout(function(){a.getModal().find(".gliffy-save-dialog-document-list-item-title").tooltip(GLIFFY.Editor.TOOLTIP_OPTIONS_STANDARD);a.getModal().find(".gliffy-document-list-item-delete").tooltip(GLIFFY.Editor.TOOLTIP_OPTIONS_STANDARD);a.getFilenameElement().focus()},1)},error:function(h,f,g){console.error("error loading document list",h,f,g);a.hideUIBlocker()},context:this})},__validate:function(a){if(a.split(" ").join("")===""){this.__displayErrorMessage("Filename is required");return false}else{if(a.indexOf('"')>-1||a.indexOf("\\")>-1||a.indexOf("/")>-1||a.indexOf("<")>-1){this.__displayErrorMessage('Invalid characters:  " \\ / <');return false}}return true},__displayErrorMessage:function(a){this.getModal().find(".gliffy-save-dialog-error p").html(a);this.getModal().find(".gliffy-save-dialog-error").show();GliffyApp.accountFoldersController.positionSelectionBar()},__hideErrorMessage:function(){this.getModal().find(".gliffy-save-dialog-error").hide();GliffyApp.accountFoldersController.positionSelectionBar()},__showPremiumShapeWarning:function(){this.getModal().find(".gliffy-save-dialog-premium-shapes").show();this.getModal().find(".gliffy-save-dialog-fields").hide();this.getModal().find(".gliffy-save-dialog-button").attr("disabled",true);GliffyApp.accountFoldersController.positionSelectionBar()},__hidePremiumShapeWarning:function(){this.getModal().find(".gliffy-save-dialog-premium-shapes").hide();this.getModal().find(".gliffy-save-dialog-fields").show();this.getModal().find(".gliffy-save-dialog-button").attr("disabled",false);GliffyApp.accountFoldersController.positionSelectionBar()}});GliffyApp.saveDialogController=GliffyApp.OnlineSaveDialogController.create()}());(function(){var c=(new Date()).getTime(),a={collaboration:"Upgrading to a Standard or Pro account will allow you to invite others to collaborate on your diagram.",diagramCount:"Upgrading your account will allow you to make more diagrams.",storage:"Upgrading your account will give you more space for saving your diagrams and images.",userCount:"You have run out of users for this account. Would you like to upgrade the amount of users available for this account?"},b="You will need to upgrade your account to have this feature available.";GliffyApp.AuthController=Ember.ObjectController.extend({user:null,account:null,ACCOUNT_TYPE_BASIC:"FREE",ACCOUNT_TYPE_STANDARD:"STANDARD",ACCOUNT_TYPE_PREMIUM:"BUSINESS",ACCOUNT_STATUS_SUSPENDED:"Suspended",ACCOUNT_STATUS_ACTIVE:"Active",DOCMAN_URL:"/go/documentManager?uid=USERID&token=TOKEN",SIGNUP_URL:"/go/commerce/signup",UPGRADE_URL:"/go/commerce/purchase?accountID=ACCOUNTID&serviceLevel=SERVICELEVEL",PURCHASEPRO_URL:"/go/commerce/purchase?accountID=ACCOUNTID&serviceLevel=TYPE_PREMIUM",PURCHASESTD_URL:"/go/commerce/purchase?accountID=ACCOUNTID&serviceLevel=TYPE_STANDARD",NOACCOUNT_URL:"/go/noaccount",init:function(){var d=this;this.set("user",GliffyApp.UserModel.create());this.set("account",GliffyApp.AccountModel.create());this.__updateAccountTypeClass();this.__callbacks=[];$(window).focus(function(){})},actions:{openPurchaseStd:function(d){GLIFFY.Utils.analyticsEvent("trackEvent",{category:"account",action:d,label:"clickPurchaseStandard"});var e=this.get("PURCHASESTD_URL");window.open(this.__formatURL(e),"purchaseWindow");GLIFFY.Utils.analyticsEvent("trackEvent",{category:"accountManage",action:"adminNav",label:"purchaseSTD"})},openPurchaseProAction:function(d){this.openPurchasePro(d)},openChangePayment:function(){GLIFFY.Utils.analyticsEvent("trackEvent",{category:"account",action:"menuAction",label:"Payment Info"});window.open(this.__formatURL(this.get("UPGRADE_URL")),"purchaseWindow");GliffyApp.accountManageController.cancel()},userLogout:function(){GLIFFY.Utils.analyticsEvent("trackEvent",{category:"user",action:"logout",label:window.location.pathname});window.location="/go/ologout?app="+GLIFFY.ENV.app},openDocumentManager:function(){window.name="gliffy"+GliffyApp.documentModel.get("id");if(GLIFFY.BrowserDetect.browser==="Firefox"){var d=window.open(this.get("documentManagerUrl"),"gliffyDocumentManager");d.close()}window.open(this.get("documentManagerUrl"),"gliffyDocumentManager");GLIFFY.Utils.analyticsEvent("trackEvent",{category:"menuClick",action:"myDocuments"})}},openPurchasePro:function(d){GLIFFY.Utils.analyticsEvent("trackEvent",{category:"account",action:d,label:"clickPurchasePro"});window.open(this.__formatURL(this.get("PURCHASEPRO_URL")),"purchaseWindow");GLIFFY.Utils.analyticsEvent("trackEvent",{category:"accountManage",action:"adminNav",label:"purchasePRO"})},addLoginCallback:function(d){this.__callbacks.push(d)},isSuspended:function(){return this.getAccountStatus()===this.ACCOUNT_STATUS_SUSPENDED},login:function(j,k,h){var e,g,d=this;this.__removeAccountTypeClass();this.set("user",GliffyApp.UserModel.create());this.populateUserData(j);this.loadUserPreferences();if(window.mixpanel){try{window.mixpanel.identify(this.getUserID());window.mixpanel.track("login",{appId:window.GLIFFY.ENV.app})}catch(f){console.log(f)}}if(typeof mktoMunchkinFunction=="function"&&this.getMunchkinKey()){try{mktoMunchkinFunction("associateLead",{Email:this.getUsername()},this.getMunchkinKey())}catch(f){console.log(f)}}if(window.qualaroo){window.qualaroo.push(["identify",this.getUsername()])}this.setAccountId(k);this.fetchAccount(function(){d.__setHandlerForUserIcon();d.__updateAccountTypeClass();if(window.mixpanel){try{window.mixpanel.people.set({lastAuthAccountUsers:GliffyApp.authController.getAccountUserCount(),lastAuthAccountDiagrams:GliffyApp.authController.getAccountDiagrams(),lastAuthLoginDate:new Date()})}catch(i){console.log(i)}}if(window.qualaroo){try{window.qualaroo.push(["set",{account_users:GliffyApp.authController.getAccountUserCount().toString(),account_diagrams:GliffyApp.authController.getAccountDiagrams().toString(),last_login_date:(new Date()).toString()}])}catch(i){console.log(i)}}GLIFFY.onlineUtils.setLocation(GLIFFY.API.reauthUrl(window.location.href));for(e=0;e<d.__callbacks.length;e++){d.__callbacks[e]()}c=(new Date()).getTime();if(GLIFFY.editor&&GliffyApp.imageBrowserController&&GliffyApp.imageBrowserController.isOpen&&GliffyApp.imageBrowserController.isOpen()){GliffyApp.imageBrowserController.loadImages("")}d.updatePremiumLibraries();d.authLibraryCreate();if(h){h()}},function(){d.setAccountId(null)});if(GLIFFY.editor&&GLIFFY.editor.draftsEnabled){GLIFFY.editor.getDocumentManager().getDraftManager().enable()}this.toggleProperty("propMajorStatusChange")},logout:function(){$("html").addClass("gliffy-anonymous");this.set("user",GliffyApp.UserModel.create());c=(new Date()).getTime();if(GLIFFY.editor){GLIFFY.editor.getDocumentManager().getDraftManager().disable()}this.toggleProperty("propMajorStatusChange")},requireEmailVerification:function(d,e){if(this.isConfirmed()){d()}else{GliffyApp.verifyEmailController.show(d,e)}},requireAuth:function(d,e){if(this.isAuthenticated()){d()}else{if(GLIFFY.ENV.welcomeController==="loginWelcomeController"){setTimeout(function(){GliffyApp.loginWelcomeController.show(d)},100)}else{setTimeout(function(){GliffyApp.loginSignupController.show(d,e)},100)}}},redirectToLogin:function(d,e){GliffyApp.loginSignupController.show(d,e)},documentManagerUrl:Ember.computed(function(){return(this.__formatURL(this.get("DOCMAN_URL")))}).property(),openSignup:function(){GLIFFY.Utils.analyticsEvent("trackEvent",{category:"accountManage",action:"adminNav",label:"signup"});window.open(this.get("SIGNUP_URL"),"gliffySignup")},noAccount:function(){GLIFFY.Utils.analyticsEvent("trackEvent",{category:"user",action:"no_account_error",label:window.location.pathname});window.location=this.get("URL_NOACCOUNT")},getParameterByName:function(e){e=e.replace(/[\[]/,"\\[").replace(/[\]]/,"\\]");var d="[\\?&]"+e+"=([^&#]*)";var g=new RegExp(d);var f=g.exec(window.location.href);if(f==null){return""}else{return decodeURIComponent(f[1].replace(/\+/g," "))}},refreshAccountSettings:function(f,e){var d=this;this.account.fetch(function(g){d.__handleAccountLoaded(g);if(f){f()}d.expirationTest()},function(g){console.log("Error "+g.status);if(e){e()}});this.fetchUser();this.toggleProperty("propMajorStatusChange")},anonManageLibrarySignon:function(){$("#manageLibrary").modal("hide");GliffyApp.loginSignupController.show()},daysLeftText:Ember.computed(function(){var e=this.getDaysLeftUntilExpiration();var d;if(e===1){d=$.i18n._("BANNER_AD_TRIAL_TAGLINE_DAY")}else{d=$.i18n._("BANNER_AD_TRIAL_TAGLINE_DAYS")}return $.i18n._("BANNER_AD_TRIAL_TAGLINE",[e,d])}).property("daysLeft"),expirationTest:function(){if(this.getAccountIsExpired()){if(this.isSuspended()){GliffyApp.suspendedNoticeController.show()}else{GliffyApp.expirationNoticeController.show()}$("#gliffy-modal-welcome-screen").modal("hide")}else{GliffyApp.expirationNoticeController.hide();GliffyApp.suspendedNoticeController.hide()}},propMajorStatusChange:false,isAuthenticated:function(){return this.get("user").get("isAuthenticated")},getUserPreferences:function(){return this.get("user").getUserPreferences()},setUserPreference:function(d,e){this.get("user").setPreference(d,e)},getUsername:function(){return this.get("user").get("username")},getUserID:function(){return this.get("user").get("uid")},populateUserData:function(d){this.get("user").populate(d)},loadUserPreferences:function(){this.get("user").loadPreferences()},getMunchkinKey:function(){return this.get("user").get("munchkinKey")},isConfirmed:function(){return this.get("user").get("isConfirmed")},setIsConfirmed:function(d){this.get("user").set("isConfirmed",d)},getUserToken:function(){return this.get("user").get("token")},fetchUser:function(e,d){this.get("user").fetch(e,d);this.toggleProperty("propMajorStatusChange")},getSwitchableAccounts:function(){return this.get("user").get("accountUsers")},getCurrentUserAccount:function(){return this.get("user").get("currentAccount")},propUsername:Ember.computed(function(){return this.getUsername()}).property("user"),propUserID:Ember.computed(function(){return this.getUserID()}).property("user"),propUserToken:Ember.computed(function(){return this.getUserToken()}).property("user"),propIsConfirmed:Ember.computed(function(){return this.isConfirmed()}).property("user"),propHasMultipleAccounts:Ember.computed(function(){return this.getSwitchableAccounts().length>1}).property("user"),setAccountId:function(g,f){var e,d=this;if(d.getAccountId()!==g){d.__removeAccountTypeClass();e=GliffyApp.AccountModel.create();if(g!==null){e.set("id",g);e.fetch(function(h){d.__handleAccountLoaded(h);if(f){f()}},function(h){console.log("Error "+h.status)})}GliffyApp.expirationNoticeController.show()}},accountIsLoaded:function(d){this.propertyWillChange("account");this.set("account",d);this.propertyDidChange("account");$(window).trigger("gliffy.authController.accountLoadedEvent")},__handleAccountLoaded:function(d){this.accountIsLoaded(d);this.authLibraryCreate();this.updatePremiumLibraries();this.__updateAccountTypeClass();this.toggleProperty("propMajorStatusChange")},__setHandlerForUserIcon:function(){if(this.account){this.account.addObserver("googleDriveUserIcon",function(){if(GliffyApp.authController.getGoogleDriveUserIcon()){$(".gliffy-profile-icon").css({"background-size":"20px 20px","background-position":"right","background-image":"url("+GliffyApp.authController.getGoogleDriveUserIcon()+")"})}})}},getAccountId:function(){return this.get("account").get("id")},fetchAccount:function(e,d){this.get("account").fetch(e,d);this.toggleProperty("propMajorStatusChange")},hasAccount:function(){return(this.get("account"))?true:false},getAccountIsExpired:function(){return this.getDaysLeftUntilExpiration()==0},getDaysLeftUntilExpiration:function(){return this.get("account").get("daysLeftUntilExpiration")},getAccountCreateDate:function(){return this.get("account").get("createDate")},hasPermission:function(d){return this.get("account").hasPermission(d)},getAccountStatus:function(){return this.get("account").get("status")},getGoogleDriveUserIcon:function(){return this.get("account").get("googleDriveUserIcon")},unlinkGoogleDriveFromAccount:function(){this.get("account").set("googleDriveUserName",null);this.get("account").set("googleDriveUserEmail",null);this.get("account").set("googleDriveUserIcon",null)},getAccountName:function(){return this.get("account").get("name")},getAccountUserCount:function(){return this.get("account").get("userCount")},getAccountDiagrams:function(){return this.get("account").get("diagramCount")},increaseAccountDiagramCount:function(){this.get("account").set("diagramCount",this.getAccountDiagrams()+1)},decreaseAccountDiagramCount:function(){this.get("account").set("diagramCount",this.getAccountDiagrams()-1)},getAccountDiagramsLeft:function(){return this.get("account").get("diagramsLeft")},propAccountID:Ember.computed(function(){return this.getAccountId()}).property("account"),propGoogleDriveUserIcon:Ember.computed(function(){return this.getGoogleDriveUserIcon()}).property("account"),propIsAccountAdmin:Ember.computed(function(){return this.get("account").get("userRole")==="ADMIN"}).property("account"),propAccountName:Ember.computed(function(){return this.getAccountName()}).property("account"),propAccountDisplayName:Ember.computed(function(){return this.get("account").get("displayName")}).property("account"),propAccountStatus:Ember.computed(function(){return this.getAccountStatus()}).property("account"),propAccountIsActive:Ember.computed(function(){return this.getAccountStatus()==this.ACCOUNT_STATUS_ACTIVE}).property("account"),propAccountDaysLeftUntilExpiration:Ember.computed(function(){return this.getDaysLeftUntilExpiration()}).property("account"),propAccountHasExpirationDate:Ember.computed(function(){return this.getDaysLeftUntilExpiration()!=null}).property("account"),propAccountDiagramsCount:Ember.computed(function(){return this.getAccountDiagrams()}).property("account"),propGoogleDriveUserName:Ember.computed(function(){return this.get("account").get("googleDriveUserName")}).property("account"),propGoogleDriveUserEmail:Ember.computed(function(){return this.get("account").get("googleDriveUserEmail")}).property("account"),propAccountAppsDomain:Ember.computed(function(){return this.get("account").get("appsDomain")}).property("account"),propAccountAPIKey:Ember.computed(function(){return this.get("account").get("apiKey")}).property("account"),propAccountAPISecret:Ember.computed(function(){return this.get("account").get("apiSecret")}).property("account"),propHasNextRecurringBillingDate:Ember.computed(function(){var d=this.get("account").get("dateOfNextRecurringBilling");if(d==null||d==0){return false}return true}).property("account"),propNextRecurringBillingDate:Ember.computed(function(){var d=this.get("account").get("dateOfNextRecurringBilling");if(d==null||d==0){return""}var e=moment(d,"X");return e.format("MM/DD/YYYY")}).property("account"),__setAccountProductType:function(d){this.get("account").set("productType",d)},__getAccountProductID:function(){return this.get("account").get("productId")},__getAccountMaxUsers:function(){return this.get("account").get("maxUsers")},__handleFreemiumUpgradeClick:function(f,d){$("#manageLibrary").modal("hide");GliffyApp.accountUpgradePurchaseController.show()},__handlePremiumUpgradeClick:function(h,g){var f=$(h.currentTarget).data("uid");h.preventDefault();if(this.isAnonymousAccount()){g=g+"SignInClick";$("#manageLibrary").modal("hide");GliffyApp.loginSignupController.show()}else{g=g+"UpgradeToProClick";this.openPurchasePro("premiumLibraries")}if(window.mixpanel){try{window.mixpanel.track("account",{appId:window.GLIFFY.ENV.app,accountCreateDate:this.getAccountCreateDate(),action:g,label:f})}catch(d){console.log(d)}}GLIFFY.Utils.analyticsEvent("trackEvent",{category:"account",action:g,label:f})},__removeAccountTypeClass:function(){$("html").removeClass("gliffy-"+this.getProductType())},__updateAccountTypeClass:function(){$("html").addClass("gliffy-"+this.getProductType())},__isStandardAccount:function(){return this.getProductType()===this.ACCOUNT_TYPE_STANDARD},__formatURL:function(e){var f={TOKEN:this.getUserToken(),USERID:this.getUserID(),ACCOUNTID:this.getAccountId(),USEREMAIL:encodeURIComponent(this.getUsername()),ACCOUNTTYPE:this.__isAccountAcademic()?"ACADEMIC":this.ACCOUNT_TYPE_PREMIUM,SERVICELEVEL:this.__isStandardAccount()?this.ACCOUNT_TYPE_STANDARD:this.ACCOUNT_TYPE_PREMIUM,TYPE_PREMIUM:this.ACCOUNT_TYPE_PREMIUM,TYPE_STANDARD:this.ACCOUNT_TYPE_STANDARD};for(var d in f){e=e.replace(d,f[d])}return e},__isGDocsFreemium:function(){return this.get("account").get("isGDocsFreemium")},__isAccountAcademic:function(){return this.get("account").get("isAcademic")},getProductType:function(){return this.get("account").get("productType")},getAccountMaxUsers:function(){return this.get("account").get("maxUsers")},isPremiumAccount:function(){return this.get("account").get("productType")===this.ACCOUNT_TYPE_PREMIUM},enableDemoMode:function(){this.__removeAccountTypeClass();this.__setAccountProductType(null);this.__updateAccountTypeClass();GLIFFY.Utils.analyticsEvent("setCustomVariables",{product:null,license:null,numUsers:(this.__getAccountMaxUsers+" Users")})},updatePremiumLibraries:function(){var p=this,o,d,g,k,q,n,h,m,f;if(GLIFFY.FEATURES.premiumLibraries){$("#gliffy-symbol-library .gliffy-shape-library-panel-premium-ui-blocker").each(function(){$(this).remove()});$("#gliffy-symbol-library .gliffy-shape-library-panel-premium-alert").each(function(){$(this).remove()});$("#gliffyLibraryPreview .gliffy-library-preview-upgrade").each(function(){$(this).remove()});$("#manageLibrary .gliffy-library-list-container input").each(function(){$(this).attr("disabled",false)});GLIFFY.FEATURES.showPremiumShapesLocked=!(this.isAnonymousAccount()||this.isTrialAccount()||this.isPremiumAccount());var e=["com.gliffy.libraries.uml.uml_v2","com.gliffy.libraries.ui.ui_v3"];for(h=0;h<e.length&&GLIFFY.FEATURES.showPremiumShapesLocked;h++){o=e[h];m=$.i18n._("online.premium.libraries.to.pro.users");f=$.i18n._("online.premium.libraries.upgrade.link");if(p.isTrialAccount()){f=$.i18n._("online.premium.library.trial.users")}else{if(this.isAnonymousAccount()){f=$.i18n._("online.premium.libraries.signin.link")}}var j=(p.isTrialAccount())?"<div class='gliffy-shape-library-panel-premium-alert alert alert-block'><div><div><a href='http://support.gliffy.com/entries/28625864-Premium-Shapes-' target='_blank'>These shapes are <b>Pro</b></a></div><div><a href='http://support.gliffy.com/entries/28625864-Premium-Shapes-' target='_blank'>only. Click here for</a></div><div><a href='http://support.gliffy.com/entries/28625864-Premium-Shapes-' target='_blank'>more info</a></div></div></div>":"<div class='gliffy-shape-library-panel-premium-alert alert alert-block'><div class='gliffy-upgrade-pro-icon'></div><div class='gliffy-premium-libraries-upgrade-alert-message'><div>"+$.i18n._("online.premium.libraries.panel.msg.line1")+"</div><div>"+$.i18n._("online.premium.libraries.panel.msg.line2")+"</div><div>"+m+"</div></div><div class='gliffy-premium-libraries-upgrade-link'><a data-uid='"+o+"' href='#'>"+f+"</a></div></div>";$("#gliffy-symbol-library .gliffy-accordion-group[data-uid^='"+o+"']").each(function(){d=$(this);g=$("<div class='gliffy-shape-library-panel-premium-ui-blocker'></div>");n=$(j);k=d.find(".gliffy-accordion-inner");g.height(k.height());g.width(k.width()+50);k.prepend(n);if(!p.isTrialAccount()){n.find("a").on("click",function(i){p.__handlePremiumUpgradeClick(i,"shapePanelPremiumLibrary")})}g.css("left","0px");g.css("display","block");g.css("visibility","visible");if(!p.isAnonymousAccount()&&!p.isTrialAccount()&&!p.__isGDocsFreemium()){k.parent().append(g);g.mousedown(function(i){i.preventDefault();return false});k.find(".gliffy-shape-library-panel-premium-alert").removeClass("alert-block").addClass("alert-error");g.css("top",(d.find(".gliffy-shape-library-panel-premium-alert").height()+40)+"px")}});q=$("<div class='gliffy-library-preview-upgrade alert alert-block'><div class='gliffy-premium-libraries-upgrade-alert-message'><span>"+$.i18n._("online.premium.libraries.panel.msg.line1")+" "+$.i18n._("online.premium.libraries.panel.msg.line2")+" "+m+"</span><span class='gliffy-premium-libraries-upgrade-link'><br/><a data-uid='"+o+"' href='#'>"+f+"</a><span></div></div>");if(!p.isPaidAccount()){q.find("a").on("click",function(i){p.__handleFreemiumUpgradeClick(i,"manageLibraryPremiumLibrary")})}var l=$("#gliffyLibraryPreview h4[data-uid^='"+o+"']");if(l.size()>0){var h=0;for(;h<l.size();h++){if($(l[h]).has(".gliffy-shape-library-panel-premium-alert").size()<1&&$(l[h]).has(".gliffy-library-preview-upgrade").size()<1){l.append(q)}}}if(!p.isAnonymousAccount()){$("#manageLibrary .gliffy-library-list-container input[value^='"+o+"']").attr("disabled",true)}}}},authLibraryCreate:function(){$(".gliffy-add-library-container #library_auth").remove();if(this.isAnonymousAccount()){$(".gliffy-add-library-container a.btn").hide();$(".gliffy-add-library-container").prepend('<div id="library_auth">'+$.i18n._("online.custom.shape.library.sell")+' <a href="#" onclick="GliffyApp.authController.anonManageLibrarySignon()">'+$.i18n._("online.custom.shape.library.login")+"</a></div>")}else{if(!this.isPaidAccount()&&!this.isTrialAccount()){$(".gliffy-add-library-container a.btn").hide();$(".gliffy-add-library-container").prepend('<div id="library_auth">'+$.i18n._("online.custom.shape.library.sell")+' <a href="#" onclick="GliffyApp.authController.openUpgrade(\'customLibrary\')">'+$.i18n._("online.custom.shape.library.upgrade")+"</a></div>")}else{$(".gliffy-add-library-container a.btn").show()}}return false},openUpgrade:function(d){window.open(this.get("__upgradeUrl"),"purchaseWindow");if(d){GLIFFY.Utils.analyticsEvent("trackEvent",{category:d,action:"upgrade"})}else{GLIFFY.Utils.analyticsEvent("trackEvent",{category:"accountManage",action:"adminNav",label:"upgrade"})}},requireAccountPermission:function(d,f,e){if(this.hasPermission(d)){f()}else{this.showUpgradeDialog(d,f,e)}},isPaidAccount:function(){return(this.isPremiumAccount()||this.__isStandardAccount())},showUpgradeDialog:function(d,g,f){var e=this;GLIFFY.Dialog.showYesNoDialog({title:$.i18n._("online.upgrade.title"),content:a[d]||b,cancelCallback:null,buttons:[{text:$.i18n._("online.modal.cancel"),callback:f,primary:false,dismiss:true},{text:$.i18n._("online.modal.upgrade"),callback:function(){e.openUpgrade(d)},primary:true,dismiss:true}]})},isTrialAccount:function(){return this.get("account").get("isTrial")},isAnonymousAccount:function(){return(this.getProductType()==null||this.getProductType()=="unauthorized")},__upgradeUrl:Ember.computed(function(){return(this.__formatURL(this.get("UPGRADE_URL")))}).property(),isLoggedIn:Ember.computed(function(){return(!this.isAnonymousAccount()&&this.getParameterByName("app")!="d8e91192-2f34-471c-80a6-900880844ffd")}).property(),propAccountIsUpgradeVisible:Ember.computed(function(){return this.get("account").get("isUpgradeVisible")}).property("account"),propProductDescription:Ember.computed(function(){return this.get("account").get("productDescription")}).property("account"),propProductType:Ember.computed(function(){return this.getProductType()}).property("account"),propAccountHasDiagramsLeft:Ember.computed(function(){return this.get("account").hasPermission("diagramCount")}).property("account"),propAccountDiagramsLeft:Ember.computed(function(){return this.getAccountDiagramsLeft()}).property("account"),propIsLowOnDiagrams:Ember.computed(function(){return this.get("account").get("isLowOnDiagrams")}).property("account"),propAccountMaxDiagrams:Ember.computed(function(){return this.get("account").get("maxDiagrams")}).property("account"),propAccountStorageUsed:Ember.computed(function(){return this.get("account").get("storageUsed")}).property("account"),propAccountStorageLeft:Ember.computed(function(){return this.get("account").get("storageLeft")}).property("account"),propIsFreeAccount:Ember.computed(function(){return !this.isPaidAccount()&&!this.isTrialAccount()}).property("account"),propIsGDocsFreemium:Ember.computed(function(){return this.__isGDocsFreemium()}).property("account"),propIsTrialAccount:Ember.computed(function(){return this.isTrialAccount()}).property("account"),propIsStandardAccount:Ember.computed(function(){return this.__isStandardAccount()}).property("account"),propIsPremiumAccount:Ember.computed(function(){return this.isPremiumAccount()}).property("account"),propIsAnonymousAccount:Ember.computed(function(){return this.isAnonymousAccount()}).property("account"),messageDiagramsLeftFreeAd:Ember.computed(function(){return $.i18n._("online.save.free.banner.part1",[this.getAccountDiagramsLeft(),this.get("account").get("maxDiagrams")])}).property("account"),messageDiagramsLeft:Ember.computed(function(){return $.i18n._("online.save.diagram.limit.notice",[this.get("account").get("maxDiagrams"),this.getProductType()])}).property("account"),messageMaxUsers:Ember.computed(function(){return $.i18n._("online.account.management.add.users.warning.part1",[this.get("account").get("maxUsers")])}).property("account"),messageStorageLeftUpgrade:Ember.computed(function(){return $.i18n._("online.image.browser.upgrade",[this.get("account").get("storageLeft")])}).property("account"),messageBannerDiagramsLeft:Ember.computed(function(){return $.i18n._("BANNER_AD_STD_TAGLINE",[this.getAccountDiagramsLeft(),this.get("account").get("maxDiagrams")])}).property("account")});GliffyApp.authController=GliffyApp.AuthController.create()}());(function(){GliffyApp.AbstractFileDialogController=Ember.ObjectController.extend({DEFAULT_FOLDERS:null,containerSelector:null,INITIAL_IMAGE_LOAD_LIMIT:5,__sortKeys:["lastEdited","alphabetical","reverseAlphabetical","createDate"],createNewTab:true,init:function(a){this._super();this.containerSelector=a},configDocumentList:function(){GliffyApp.documentListController.clear();GliffyApp.documentListController.setContainer($(this.containerSelector+" .gliffy-document-list-container"));GliffyApp.documentListController.setListLayout(true)},configDocumentSearch:function(){GliffyApp.documentSearchController.clear()},configDocumentSort:function(){GliffyApp.documentSortController.populateDropdown(this.__sortKeys)},configAccountFolders:function(){GliffyApp.accountFoldersController.defaultFolders=this.DEFAULT_FOLDERS;var a=this;GliffyApp.accountFoldersController.load("folder_tree.json",$(this.containerSelector+" .gliffy-account-folders-container"),function(b){GliffyApp.accountFoldersController.showFolderContainer();$(a.containerSelector+" .gliffy-common-folder.recent").click()})},open:function(e){var b=this,c,a=null,d;if(e!==null){if(window.GLIFFY.FEATURES.browserTabs){window.open(e.urls.launch,"gliffy"+e.id);if(GLIFFY.editor){GliffyApp.fileOpenBrowserController.hide()}}else{d=e.urls.open;a=GLIFFY.editor.findOpenDocumentByUrl(d);if(a===null){c={url:d,callback:function(){b.hide()}};if(this.createNewTab){GLIFFY.editor.openInNewTab(c)}else{GLIFFY.editor.open(c)}}else{GliffyApp.documentTabsController.selectTab(a);this.hide()}}}},sortDocumentList:function(b,a){GliffyApp.documentListController.doSort(a,b)},search:function(a){GliffyApp.documentListController.doSearch(a)},handleDoubleClickItem:function(){GliffyApp.documentListController.handleDoubleClickItem()},handleDocumentListScroll:function(a){GliffyApp.documentListController.scroll(a)},handleDocumentListScrollStart:function(a){GliffyApp.documentListController.scrollStart(a)},handleDocumentListScrollEnd:function(a){GliffyApp.documentListController.scrollEnd(a)},handleFolderClick:function(a){if(a.id===GliffyApp.accountFoldersController.SHARED_FOLDER_ID){GliffyApp.documentListController.load("shared_diagrams.json",{app:window.GLIFFY.ENV.app},this.INITIAL_IMAGE_LOAD_LIMIT)}else{if(a.id===GliffyApp.accountFoldersController.RECENT_FOLDER_ID){GliffyApp.documentListController.load("recent_diagrams.json",{userId:GliffyApp.authController.getUserID(),accountId:GliffyApp.authController.getAccountId(),max:20,app:window.GLIFFY.ENV.app},this.INITIAL_IMAGE_LOAD_LIMIT)}else{if(a.id===GliffyApp.accountFoldersController.STARRED_FOLDER_ID){GliffyApp.documentListController.load("favorite_diagrams.json",{accountId:GliffyApp.authController.getAccountId(),app:window.GLIFFY.ENV.app},this.INITIAL_IMAGE_LOAD_LIMIT)}else{var b="folder_diagrams.json";if(a.type===GliffyApp.accountFoldersController.GOOGLE_DRIVE_DIAGRAM_STORAGE_TYPE){b="gdrive_folder_diagrams.json"}GliffyApp.documentListController.load(b,{folderId:a.id,app:window.GLIFFY.ENV.app},this.INITIAL_IMAGE_LOAD_LIMIT)}}}}})}());(function(){GliffyApp.AbstractModalController=Ember.ObjectController.extend({theModal:null,hide:function(){this.theModal.modal("hide")},setTitle:function(a){this.theModal.find(".gliffy-modal-header h4").html(a)},resetSize:function(a){this.setSize(this.theModal.css("max-width"),this.theModal.css("max-height"),a)},setSize:function(a,c,b){this.setWidth(a);this.setHeight(c,b)},setWidth:function(a){this.theModal.width(a);this.__center()},setHeight:function(c,b){var a=this;if(b===true){this.theModal.animate({height:c},{duration:500,step:function(){a.__center()}})}else{this.theModal.height(c);this.__center()}},__center:function(){this.theModal.css("margin","-"+(this.theModal.height()/2)+"px 0 0 -"+(this.theModal.width()/2)+"px")},showUIBlocker:function(){var a=this.theModal.find(".gliffy-modal-ui-blocker");var b=this.theModal.height()-this.theModal.find(".gliffy-modal-header").innerHeight();a.height(b);a.show()},hideUIBlocker:function(){this.theModal.find(".gliffy-modal-ui-blocker").hide()},__displayErrorMessage:function(a){var b=this.theModal.find(".alert-floating");b.removeClass("alert-success").addClass("alert-error").find("span").html(a);b.show()}})}());(function(){GliffyApp.DocumentTabsController=GliffyApp.DocumentTabsController.extend({getTabTemplateHTML:function(d,a){var c,b;if(GLIFFY.FEATURES.browserTabs){c=this._super(false,a)}else{c=this._super(d,a)}b=$(c);if(GliffyApp.documentModel.isPublic){$('<div class="gliffy-icon-public icon" title="public diagram"></div>').insertAfter(b.find("span:first"))}else{$('<div class="gliffy-icon-private icon" title="private diagram"></div>').insertAfter(b.find("span:first"))}setTimeout(function(){$("#gliffy-tabs-container div.icon").tooltip(GLIFFY.Editor.TOOLTIP_OPTIONS_STANDARD)},1000);c=b.wrap("<p/>").parent().html();return c},updateTabText:function(){var a=this.__editor.getDocumentManager().getActiveDocument().tabDomElement;a.find("div.icon").removeAttr("data-original-title").tooltip("hide");this._super()}})}());(function(){GliffyApp.ResumingModalController=Ember.Object.extend({modalSelector:null,init:function(){this.__onCancel=null;this.__onResume=null;this.__currentModal=null},resume:function(){$(this.__currentModal).unbind("hidden.gliffycancel").modal("hide");this.__currentModal=null;if(this.__onResume){this.__onResume()}this.__onCancel=null;this.__onResume=null},cancel:function(){$(this.__currentModal).unbind("hidden.gliffycancel");this.__currentModal=null;if(this.__onCancel){this.__onCancel()}this.__onCancel=null;this.__onResume=null},isModalUp:function(){return this.__currentModal!==null},getModal:function(){return this.__currentModal},show:function(d,c){var b=this,a;this.__onCancel=c||null;this.__onResume=d||null;a=function(){var e=$(b.modalSelector);if(e.length===0){setTimeout(a,10)}else{e.unbind("hidden.gliffycancel");if(c){e.bind("hidden.gliffycancel",function(){b.cancel()})}b.__currentModal=e;e.modal("show")}};a()}})}());(function(){GliffyApp.DocumentSearchController=Ember.Object.extend({searchValue:"",actions:{search:function(a){}},updateSearchValue:function(a){this.set("searchValue",a)},search:function(){},clear:function(){this.set("searchValue","");$(".gliffy-document-search input").val("")}});GliffyApp.documentSearchController=GliffyApp.DocumentSearchController.create()}());(function(){GliffyApp.DocumentSortController=Ember.ObjectController.extend({SORT_KEY_OBJECTS:null,sortKeys:null,init:function(){this.sortKeys=Ember.A([])},actions:{selectItem:function(a){$(".gliffy-document-sort-dropdown .dropdown-toggle").click();$(".gliffy-document-sort-dropdown-button").html(a.desc)}},populateDropdown:function(c){var a,b;this.sortKeys.clear();for(a=0;a<c.length;a++){b=Ember.Object.create();if(!this.SORT_KEY_OBJECTS){this.SORT_KEY_OBJECTS={lastEdited:{desc:$.i18n._("online.document.sort.filter.last.edited"),sortOrder:"desc",sortProperty:"lastModified"},alphabetical:{desc:$.i18n._("online.document.sort.filter.alphabetical.a.to.z"),sortOrder:"asc",sortProperty:"name"},reverseAlphabetical:{desc:$.i18n._("online.document.sort.filter.alphabetical.z.to.a"),sortOrder:"desc",sortProperty:"name"},createDate:{desc:$.i18n._("online.document.sort.filter.date.created"),sortOrder:"asc",sortProperty:"createDate"}}}b.setProperties(this.SORT_KEY_OBJECTS[c[a]]);this.sortKeys.pushObject(b)}}});GliffyApp.documentSortController=GliffyApp.DocumentSortController.create()}());(function(){GliffyApp.DocumentListController=Ember.ObjectController.extend({isEditableItems:false,isListLayout:false,documentList:null,masterDocumentList:null,introShown:false,sortOrder:null,sortProperty:null,filterValue:null,filterProperty:null,itemHeight:125,container:null,__itemIsBeingSelected:false,__initialLoadLimit:5,__scrollTimeout:null,__tempTime:null,__scrolling:null,__documentsCount:0,__documentsLoaded:0,__lazyRenderTimeout:null,__renamingDocument:false,__loadZoomPreviewBound:false,__zoomImgLoadCheckCounter:0,currentAction:null,selectedItem:null,actions:{closeAlert:function(){$(".gliffy-document-list-alert").hide()},handleInputKeyUp:function(){if(event.keyCode===13){this.handleRenameDocument(event.target.value)}else{if(event.keyCode===27){GliffyApp.documentListController.hideRenameInput()}}return true},handleDocumentNameClick:function(){var a=this;var b;var d=$(event.target).closest(".gliffy-document-content-column").prop("id");d=parseInt(d);var c=this.documentList.findBy("id",d);event.preventDefault();this.handleSelectItem(event,c);if(this.isEditableItems){$(event.currentTarget).removeAttr("data-original-title").tooltip("hide");this.selectedItem.set("isEditingName",true);b=setTimeout(function(){a.container.find(".gliffy-selected input").focus().select();a.hideRenameSpinner(a.getSelectedItemDOM())},5)}}},init:function(){var a=this;this._super();this.documentList=Ember.A([]);this.masterDocumentList=Ember.A([]);this.reset()},setContainer:function(a){this.container=a},setListLayout:function(a){this.set("isListLayout",a)},clear:function(){this.documentList.clear();this.__documentsLoaded=0;this.__documentsCount=0;this.filterValue="";if(this.__lazyRenderTimeout!==null){clearTimeout(this.__lazyRenderTimeout);this.__lazyRenderTimeout=null}},reset:function(){this.sortOrder="desc";this.sortProperty="lastModified";this.filterValue="";this.filterProperty="name";this.__initialLoadLimit=5;this.__itemIsBeingSelected=false},load:function(d,c,b){var a=this;a.set("currentAction",d);this.clear();this.clearSelectedItem();this.hideDocumentItemError();this.__itemIsBeingSelected=false;if(b){this.__initialLoadLimit=b}this.showSpinner();if(this.isDemo){this.__buildMasterDocumentList(this.documentListJSONStub.diagrams);this.render()}else{window.GLIFFY.API.GET(d,{query:c,success:function(f,g,e){a.__buildMasterDocumentList(f.diagrams);a.render();a.called="called"},error:function(g,e,f){console.error("error loading document list",g,e,f);a.hideSpinner()},context:this})}},isGoogleDrive:Ember.computed(function(){return(this.currentAction==="gdrive_folder_diagrams.json")}).property("currentAction"),showSpinner:function(){$(".gliffy-document-list .gliffy-inner-spinner-icon").show()},hideSpinner:function(){$(".gliffy-document-list .gliffy-inner-spinner-icon").hide()},setFilterValue:function(a){if(this.get("filterValue")!==a){this.set("filterValue",a);this.render()}},getSortedData:function(c){var b,a=this;if(this.get("sortOrder")=="asc"){b=c.sort(function(e,d){if(typeof e[a.sortProperty]=="number"){return e[a.sortProperty]-d[a.sortProperty]}else{return((e[a.sortProperty].toLowerCase()<d[a.sortProperty].toLowerCase())?-1:((e[a.sortProperty].toLowerCase()>d[a.sortProperty].toLowerCase())?1:0))}})}else{b=c.sort(function(e,d){if(typeof e[a.sortProperty]=="number"){return d[a.sortProperty]-e[a.sortProperty]}else{return((d[a.sortProperty].toLowerCase()<e[a.sortProperty].toLowerCase())?-1:((d[a.sortProperty].toLowerCase()>e[a.sortProperty].toLowerCase())?1:0))}})}return b},render:function(){var a=this;var d=Ember.A([]);var e=this.getFilteredData(this.getSortedData(this.masterDocumentList));var c=50;this.__documentsCount=e.length;if(c>this.__documentsCount){c=this.__documentsCount}if(this.__documentsCount===0){this.hideSpinner()}for(var b=0;b<c;b++){if(b>=0&&b<=this.__initialLoadLimit){if(!e[b].get("isLoaded")){e[b].set("isLoaded",true)}}this.__documentsLoaded++;d.pushObject(e[b])}this.set("documentList",d);if(this.__documentsLoaded<this.__documentsCount){this.__lazyRenderTimeout=setTimeout(function(){a.__renderRemaining(e,c)},250)}if(this.get("documentList").length===0){if(this.get("introShown")==false&&GliffyApp.authController.getAccountDiagrams()==0&&window.GLIFFY.ENV.location=="DOCUMENT_MANAGER"){$(".gliffy-recent-intro-documents").show();$(".gliffy-document-list-no-documents-message").hide()}else{$(".gliffy-document-list-no-documents-message").show();$(".gliffy-recent-intro-documents").hide()}}else{$(".gliffy-document-list-no-documents-message").hide();$(".gliffy-recent-intro-documents").hide()}this.set("introShown",true);this.container.parent().scrollTop(0);setTimeout(function(){a.hideSpinner();a.loadVisibleDocuments()},50)},__renderRemaining:function(f,e){var b=this;var a=this.__documentsCount-this.__documentsLoaded;var c=this.__documentsLoaded;if(e>a){e=a}for(var d=c;d<(c+e);d++){this.__documentsLoaded++;this.documentList.pushObject(f[d])}if(this.__documentsLoaded<this.__documentsCount){this.__lazyRenderTimeout=setTimeout(function(){b.__renderRemaining(f,e)},250)}},doSort:function(a,b){var c=this.filterValue;this.showSpinner();this.clear();this.set("filterValue",c);this.set("sortOrder",a);this.set("sortProperty",b);this.render();GLIFFY.Utils.analyticsEvent("trackEvent",{category:"documentList",action:"sort",label:b+"/"+a})},doSearch:function(a){this.showSpinner();this.clear();this.set("filterValue",a);this.render();GLIFFY.Utils.analyticsEvent("trackEvent",{category:"documentList",action:"search"})},__buildMasterDocumentList:function(d){var b,c,a;this.masterDocumentList=Ember.A([]);for(b=0;b<d.length;b++){c=d[b];a=GliffyApp.DocumentListItemModel.create();if(b>=0&&b<=5){a.set("isLoaded",true)}a.setProperties(c);a.set("isEditable",this.isEditableItems);this.masterDocumentList[this.masterDocumentList.length]=a}},getFilteredData:function(c){var a=this,b;b=c.filter(function(d){if(d[a.filterProperty].length>=a.get("filterValue").length&&d[a.filterProperty].toLowerCase().search(a.get("filterValue").toLowerCase())>-1){return true}else{return false}});return b},handleSelectItem:function(b,a){if(this.selectedItem!==null&&a.id!==this.selectedItem.id){this.clearSelectedItem();this.hideDocumentItemError()}if(this.isListLayout){$(".gliffy-document-list tr").removeClass("gliffy-selected")}else{$(".gliffy-document-list .gliffy-grid-item").removeClass("gliffy-selected")}$(b.currentTarget).addClass("gliffy-selected");this.selectedItem=a;if(this.isEditableItems){$(".gliffy-document-list-item-delete").hide();$(b.currentTarget).find(".gliffy-document-list-item-delete").show();$(".gliffy-document-list-item-share").hide();$(b.currentTarget).find(".gliffy-document-list-item-share").show()}},getDocumentTitleMaxWidth:function(){return $(".gliffy-document-list").width()-$(".gliffy-document-preview-column").width()-$(".gliffy-document-list-item-col3").width()-30},handleDoubleClickItem:function(){if(this.selectedItem!==null){this.container.trigger("documentListItemOpen",this.selectedItem)}},handleRenameDocument:function(b){var a=this;this.hideDocumentItemError();var c=this.getSelectedItemDOM();var d=this.selectedItem;if(d.name===b){this.hideRenameInput();return}if(this.validateDocumentName(b,function(e){a.displayDocumentItemError(e)})){if(!this.__renamingDocument){this.__renamingDocument=true;this.showRenameSpinner(c);this.renameDocument(d,b,function(e){if(e.error){a.displayDocumentItemError(e.error+" Press ESC to exit editing.")}else{d.set("name",b);a.hideRenameInput(d)}a.hideRenameSpinner(c);a.__renamingDocument=false},function(e){a.displayDocumentItemError(e);a.hideRenameSpinner(c);a.hideRenameInput(d);a.__renamingDocument=false})}}},renameDocument:function(b,e,a,d){var c=this;window.GLIFFY.API.PUT("diagram/"+b.id+"/rename",null,{query:{name:e},success:function(g,h,f){a(g);GLIFFY.Utils.analyticsEvent("trackEvent",{category:"document",action:"rename",label:window.location.pathname})},error:function(h,f,g){g=GLIFFY.onlineUtils.handleDiagramActionError(h,f,g,"An error occurred during rename.",false);d(g);console.error(h,g)},context:this})},showRenameSpinner:function(a){a.find("input").hide();a.find(".gliffy-document-rename-saving").show()},hideRenameSpinner:function(a){a.find(".gliffy-document-rename-saving").hide();a.find("input").show()},validateDocumentName:function(b,a){if(b.replace(" ","")===""){a("Document name cannot be blank.");return false}else{if(b.indexOf('"')>-1||b.indexOf("\\")>-1||b.indexOf("/")>-1||b.indexOf("<")>-1){a('Document name cannot contain the characters "/ or <.');return false}}return true},displayDocumentItemError:function(a){var b=this.getErrorAlertDOM();b.css("top",this.getSelectedItemDOM().position().top+50);b.css("left",this.getSelectedItemDOM().position().left+250);b.show();b.find("strong").html("Error!");b.find("span").html(a)},hideDocumentItemError:function(){this.getErrorAlertDOM().hide()},getSelectedItemDOM:function(){return this.container.find(".gliffy-selected")},getErrorAlertDOM:function(){return GliffyApp.documentListController.container.parent().find(".alert-floating")},clearSelectedItem:function(){if(this.selectedItem!==null){if(this.selectedItem.isEditingName){this.hideRenameInput(this.selectedItem)}this.selectedItem=null}},hideRenameInput:function(b){this.selectedItem.set("isEditingName",false);var a=setTimeout(function(){$(".gliffy-document-list-item-tooltip").tooltip(GLIFFY.Editor.TOOLTIP_OPTIONS_STANDARD)},5)},handleDocumentDelete:function(b){var a=this;if(this.selectedItem!==null){this.doDocumentDelete(this.selectedItem,function(){a.removeSelectedDocumentItem();GLIFFY.Utils.analyticsEvent("trackEvent",{category:"documentManager",action:"deleteDiagram",label:window.location.pathname});GLIFFY.Spinner.hide({context:"deleteDiagram"})},function(c){GLIFFY.Spinner.hide({context:"deleteDiagram"});a.displayDocumentItemError(c)})}},doDocumentDelete:function(c,a,b,g){var h=this,d,i,e,f;if(GliffyApp.accountFoldersController.isSharedFolderSelected()){d=$.i18n._("online.document.list.remove.shared.diagram");i=$.i18n._("online.document.list.remove.shared.diagram.confirm",[c.name]);e=$.i18n._("online.document.list.remove.shared.diagram.button");f=function(j){GliffyApp.collaborationController.removeCollaborator({id:GliffyApp.authController.getUserID()},c.id,function(){a()},function(m,k,l){b(l)})}}else{d=$.i18n._("online.document.list.delete.diagram");i=$.i18n._("online.document.list.delete.diagram.confirm",[c.name]);e=$.i18n._("online.modal.delete");f=function(j){GLIFFY.Spinner.show({context:"deleteDiagram"});h.deleteDocument(c.id,a,b)}}GLIFFY.Dialog.showYesNoDialog({title:d,content:i,cancelCallback:g,buttons:[{text:$.i18n._("online.modal.cancel"),callback:g,primary:false,dismiss:true},{text:e,callback:f,primary:true,dismiss:true}]})},deleteDocument:function(d,a,c){var b=this;window.GLIFFY.API.DELETE("diagram.json",{query:{diagramId:d},success:function(f,g,e){GliffyApp.authController.decreaseAccountDiagramCount();GliffyApp.authController.fetchAccount(function(){a()},function(){console.error("Unable to update account settings after diagram delete");a()})},error:function(g,e,f){f=GLIFFY.onlineUtils.handleDiagramActionError(g,e,f,"An error occurred during delete.",false);c(f);console.error("Error deleting document",f)},context:this})},removeSelectedDocumentItem:function(){this.masterDocumentList.removeObject(this.selectedItem);this.container.find("#"+this.selectedItem.id).parent().remove();this.clearSelectedItem()},handleDocumentCollaborate:function(a){if(this.selectedItem!==null){GliffyApp.collaborationController.show(this.selectedItem.id,this.selectedItem.name);GLIFFY.Utils.analyticsEvent("trackEvent",{category:"documentManager",action:"collaborateClick",label:window.location.pathname})}},handleDocumentPublish:function(b){var a=this;if(this.selectedItem!==null){GliffyApp.documentModel.populate(this.selectedItem);GliffyApp.publishController.show(function(){a.selectedItem.set("isPublic",GliffyApp.documentModel.get("isPublic"))});GLIFFY.Utils.analyticsEvent("trackEvent",{category:"documentManager",action:"publishClick",label:window.location.pathname})}},handleSelectFavorite:function(b,a){if($(b.target).hasClass("gliffy-icon-star-off")){this.callFavoriteAPI(a,true,function(){$(b.target).removeClass("gliffy-icon-star-off");$(b.target).addClass("gliffy-icon-star");$(b.target).attr("data-original-title","click to un-star")})}else{this.callFavoriteAPI(a,false,function(){$(b.target).removeClass("gliffy-icon-star");$(b.target).addClass("gliffy-icon-star-off");$(b.target).attr("data-original-title","click to star")})}},callFavoriteAPI:function(c,d,a){var b=this;window.GLIFFY.API.PUT("diagram_favorite.json",{value:d},{query:{diagramId:c.id},success:function(f,g,e){GLIFFY.Utils.analyticsEvent("trackEvent",{category:"document",action:"star",label:window.location.pathname});a()},error:function(g,e,f){f=GLIFFY.onlineUtils.handleDiagramActionError(g,e,f,"An error occurred setting favorite.",false);b.displayDocumentItemError(f);console.error("error setting favorite",g,e,f)},context:this})},isScrolledIntoView:function(c){var e=0;var d=e+this.container.parent().height();var a=$(c).offset().top-this.container.parent().offset().top;var b=a+$(c).height();return(b>=e&&b<=d)||(a>=e&&a<=d)},scroll:function(c){var a=this;var b=(new Date()).getTime();if(b-a.__tempTime>200&&!a.__scrolling){a.container.trigger("scrollStart");a.__tempTime=b}clearTimeout(a.__scrollTimeout);a.__scrollTimeout=setTimeout(function(){if(a.__scrolling){a.container.trigger("scrollEnd")}},200)},scrollStart:function(a){this.__scrolling=true},scrollEnd:function(a){this.__scrolling=false;this.loadVisibleDocuments()},loadVisibleDocuments:function(){var c,a;for(var b=0;b<this.documentList.length;b++){if(this.isListLayout){c=this.container.find("tr").get(b)}else{c=this.container.find(".gliffy-grid-item").get(b)}a=this.documentList.get(b);if(!a.get("isLoaded")){if(c!==null&&$(c).offset()!==null&&this.isScrolledIntoView(c)){if(!a.get("isLoaded")){a.set("isLoaded",true)}}}}},zoom:function(b){var a=this;this.__zoomImgLoadCheckCounter=0;$(".gliffy-zoom-view-modal .gliffy-zoom-view-modal-img").hide();$(".gliffy-zoom-view-modal .gliffy-inner-spinner-icon").show();$(".gliffy-zoom-view-modal-img").width("auto");$(".gliffy-zoom-view-modal-img").height("auto");if(!this.__loadZoomPreviewBound){$(".gliffy-zoom-view-modal-img").on("load",function(){a.__zoomImgLoadCheck()});this.__loadZoomPreviewBound=true}$(".gliffy-zoom-view-modal").modal("show");$(".gliffy-zoom-view-modal-img").attr("src","/go/view/"+b.id+".png?size=large");GLIFFY.Utils.analyticsEvent("trackEvent",{category:"documentList",action:"previewZoom"})},__zoomImgLoadCheck:function(){var a,c,b=this;setTimeout(function(){b.__zoomImgLoadCheckCounter++;a=$(".gliffy-zoom-view-modal-img").width();c=$(".gliffy-zoom-view-modal-img").height();if((a>0&&c>0)||b.__zoomImgLoadCheckCounter>100){$(".gliffy-zoom-view-modal .gliffy-zoom-view-modal-img").show();$(".gliffy-zoom-view-modal .gliffy-inner-spinner-icon").hide();b.__resizeZoomView()}else{b.__zoomImgLoadCheck()}},100)},__resizeZoomView:function(){var g=60,i=80,e,a,b=$(".gliffy-zoom-view-modal-img").width()+g,d=$(".gliffy-zoom-view-modal-img").height()+i,c=$(window).width(),f=$(window).height();if(b>c){e=b;b=c-50;d=b/e*d;$(".gliffy-zoom-view-modal-img").width(b-g);$(".gliffy-zoom-view-modal-img").height(d-i)}if(d>f){a=d;d=f-50;b=d/a*b;$(".gliffy-zoom-view-modal-img").width(b-g);$(".gliffy-zoom-view-modal-img").height(d-i)}$(".gliffy-zoom-view-modal").width(b);$(".gliffy-zoom-view-modal").height(d);$(".gliffy-zoom-view-modal").css("margin","-"+((d)/2)+"px 0 0 -"+((b)/2)+"px")},documentListJSONStub:{diagrams:[{name:"My Cool Diagram",isFavorite:true,lastModified:1350950400,lastModifiedFriendly:"October 23, 2012",createDate:1212969600,createDateFriendly:"June 09, 2008",isPublic:false,createdBy:"Jack Muir",lastModifiedBy:"Han Lee",currentlyEditedBy:"Han Lee",urls:{thumbnail:"/go/view/90209.png?size=thumbnail&ts=-408129242",open:"/go/api/diagram.json?diagramId=90000",update:"/go/api/diagram.json?diagramId=90000"},"read-only":false},{name:"Aardvark Migration",isFavorite:true,lastModified:1352678400,lastModifiedFriendly:"November 12, 2012",createDate:1342828800,createDateFriendly:"July 21, 2012",isPublic:true,createdBy:"Clint Dickson",lastModifiedBy:"Kerry Liu",urls:{thumbnail:"/go/view/90172.png?size=thumbnail&ts=-408129242",open:"/go/api/diagram.json?diagramId=90001",update:"/go/api/diagram.json?diagramId=90000"},"read-only":false},{name:"BPMN",isFavorite:false,lastModified:1338854400,lastModifiedFriendly:"June 05, 2012",createDate:1334188800,createDateFriendly:"April 12, 2012",isPublic:false,createdBy:"Todd",lastModifiedBy:"Rocco",urls:{thumbnail:"/go/view/90000.png?size=thumbnail&ts=-408129242",open:"/go/api/diagram.json?diagramId=90001",update:"/go/api/diagram.json?diagramId=90000"},"read-only":false},{name:"Floorplan of a really nice house on Mars that has big chickens in the garage and a small car in the yard",isFavorite:false,lastModified:1233792000,lastModifiedFriendly:"February 05, 2009",createDate:1231718400,createDateFriendly:"January 12, 2009",isPublic:true,createdBy:"Todd",lastModifiedBy:"Eric Chiang",urls:{thumbnail:"/go/view/90004.png?size=thumbnail&ts=-408129242",open:"/go/api/diagram.json?diagramId=90001",update:"/go/api/diagram.json?diagramId=90000"},"read-only":false},{name:"BPMN 2",isFavorite:false,lastModified:1272326400,lastModifiedFriendly:"April 27, 2010",createDate:1193788800,createDateFriendly:"October 31, 2007",isPublic:false,createdBy:"Ron",lastModifiedBy:"Carole",urls:{thumbnail:"/go/view/90001.png?size=thumbnail&ts=-408129242",open:"/go/api/diagram.json?diagramId=90001",update:"/go/api/diagram.json?diagramId=90000"},"read-only":false}]}});GliffyApp.documentListController=GliffyApp.DocumentListController.create()}());(function(){GliffyApp.AccountFoldersController=Ember.ObjectController.extend({SHARED_FOLDER_ID:"Shared",RECENT_FOLDER_ID:"Recent",STARRED_FOLDER_ID:"Starred",GLIFFY_ONLINE_DIAGRAM_STORAGE_TYPE:"gliffyOnline",GOOGLE_DRIVE_DIAGRAM_STORAGE_TYPE:"googleDrive",defaultFolders:null,selectedItem:null,selectedCommonFolderId:0,container:null,rootFolderId:0,__dropZones:null,__scrollTimeout:null,__tempTime:null,__scrolling:null,allowDelete:false,init:function(){var a=this;this.__dropZones=[]},actions:{handleSettingsClick:function(){this.toggleSettingsDropdown()},handleDeleteClick:function(){this.toggleSettingsDropdown();this.handleDelete()},handleRenameMenuClick:function(){this.toggleSettingsDropdown();this.showRenameFolderModal()},handlePermissionsClick:function(){this.toggleSettingsDropdown();GliffyApp.folderPermissionsModalController.show(this.getSelectedFolderId(),this.getSelectedFolderTitle());GLIFFY.Utils.analyticsEvent("trackEvent",{category:"accountFolders",action:"folderPermissions",label:window.location.pathname})}},showFolderContainer:function(){$(".gliffy-account-folders-loading").hide();this.container.show()},hideFolderContainer:function(){this.container.hide();$(".gliffy-account-folders-loading").show()},updateDropZones:function(){var b=this.__dropZones,c=$(".gliffy-account-folders-container"),a=c.offset().left,d=a+c.width();b.length=0;$(".gliffy-account-folders-container a:visible").each(function(f,g){var g=$(g),i=g.offset(),h=new GLIFFY.BoundingBox(a,i.top,d,i.top+g.height()),j=g.parent().attr("id"),e=GliffyApp.accountFoldersController.getFolderTitleById(j);b.push({element:g,bounds:h,id:j,name:e})})},getFolderInfoAtPosition:function(a,d){var b,c;for(b=0;b<this.__dropZones.length;b++){c=this.__dropZones[b];if(c.bounds.pointInside(a,d)){return c}}return null},scroll:function(d,c){var a=this;var b=(new Date()).getTime();this.positionSelectionBar();if(b-a.__tempTime>200&&!a.__scrolling){$(c).trigger("scrollStart");a.__tempTime=b}clearTimeout(a.__scrollTimeout);a.__scrollTimeout=setTimeout(function(){if(a.__scrolling){$(c).trigger("scrollEnd")}},200)},scrollStart:function(a){this.__scrolling=true},scrollEnd:function(a){this.__scrolling=false;this.updateDropZones()},load:function(d,b,e){var c=this,a;this.container=b;this.hideFolderContainer();window.GLIFFY.API.GET(d,{query:{accountId:GliffyApp.authController.getAccountId()},success:function(g,h,f){this.rootFolderId=0;if(this.defaultFolders){this.folder_data=$.extend(true,{},this.defaultFolders);this.folder_data.data.push(g);a=g.attr.id}else{this.folder_data=g;a=g.data[0].attr.id}c.rootFolderId=a;this.defaultFolders=null;b.jstree({json_data:c.folder_data,plugins:["themes","json_data","ui","sort"],themes:{theme:"gliffy-folder-tree",dots:false,icons:true,url:"../../go/assets/stylesheets/gliffy-folder-tree.css"},sort:function(j,i){return this.get_text(j).toLowerCase()>this.get_text(i).toLowerCase()?1:-1}}).bind("select_node.jstree",function(j,i){c.handleSelectNode(j,i)}).bind("loaded.jstree",function(j,i){e.apply(null,[a]);c.updateDropZones()}).bind("hover_node.jstree",function(j,i){c.showHoverBar(i.rslt.obj.attr("id"))}).bind("dehover_node.jstree",function(j,i){c.hideHoverBar()}).bind("open_node.jstree",function(j,i){c.updateDropZones()}).bind("after_open.jstree",function(j,i){if(!b.is(":visible")){setTimeout(function(){c.showFolderContainer()},500)}})},error:function(){this.defaultFolders=null;if(!b.is(":visible")){c.showFolderContainer()}},context:this})},selectFolder:function(a){this.container.jstree("select_node",a+":first")},openFolder:function(a,b){this.container.jstree("open_node",a+":first",function(){if(b){b()}})},openSelectedFolder:function(){this.openFolder(this.getSelectedFolder().attr("id"))},createFolder:function(g,b){var d=this.checkFolderNameError(g),c=this,a="inside",f=this.container.jstree("get_selected"),e,h=this.getSelectedFolderId();if(d){this.displayFolderNameError(d)}else{if(h<0){this.selectFolder(this.rootFolderId);f=this.container.jstree("get_selected");h=this.rootFolderId}window.GLIFFY.API.PUT("folder.json",null,{query:{accountId:GliffyApp.authController.getAccountId(),folderName:g,parentFolderId:h},success:function(j,k,i){e={data:g,attr:{id:j.attr.id,type:j.attr.type}};c.container.jstree("create_node",f,a,e,false,false);c.container.jstree("correct_state",e);b();c.openSelectedFolder();c.updateDropZones();GLIFFY.Utils.analyticsEvent("trackEvent",{category:"accountFolders",action:"addFolder",label:window.location.pathname})},error:function(k,i,j){c.displayFolderNameError(k.responseText);console.error("I borked",j)},context:this})}},renameFolder:function(f,b,a){var d=this.checkFolderNameError(b),c=this,e=this.container.jstree("get_selected"),g=this.getSelectedFolderId();this.showSpinner();if(d){this.displayFolderRenameError(d);this.hideSpinner()}else{window.GLIFFY.API.PUT("folder/"+this.selectedItem.attr("id")+"/rename",null,{query:{name:b},success:function(i,j,h){if(i.success==="false"||i.success===false){}else{c.renameNode(c.selectedItem.nodeName,b);c.deselectAllCommonFolders();c.showSelectionBar();GLIFFY.Utils.analyticsEvent("trackEvent",{category:"accountFolders",action:"renameFolder",label:window.location.pathname})}a();c.updateDropZones();c.hideSpinner()},error:function(j,h,i){console.log(j.responseText);c.displayFolderRenameError(j.responseText);c.hideSpinner();console.error("I borked")},context:this})}},displayFolderNameError:function(a){$("#gliffy-folder-create-modal .gliffy-input-modal-error").show();$("#gliffy-folder-create-modal .gliffy-input-modal-error p").html(a)},showCreateFolderModal:function(){$("#gliffy-folder-create-modal .gliffy-input-modal-input").val("");$("#gliffy-folder-create-modal .gliffy-input-modal-error").hide();$("#gliffy-folder-create-modal .gliffy-modal").modal("show");$("#gliffy-folder-create-modal .gliffy-input-modal-input").focus()},showRenameFolderModal:function(){$("#gliffy-folder-rename-modal .gliffy-input-modal-input").val($(".jstree-clicked").text().trim());$("#gliffy-folder-rename-modal .gliffy-input-modal-error").hide();$("#gliffy-folder-rename-modal .gliffy-modal").modal("show");$("#gliffy-folder-rename-modal .gliffy-input-modal-input").focus().select()},displayFolderRenameError:function(a){$("#gliffy-folder-rename-modal .gliffy-input-modal-error").show();$("#gliffy-folder-rename-modal .gliffy-input-modal-error p").html(a)},checkFolderNameError:function(b){var a=null,e="abcdefghijklmnopqrstuvwxyz0123456789@.-_ ",c,d;if(b.split(" ").join("")===""){a="Folder name is blank"}else{for(c=0;c<b.length;c++){d=b.charAt(c).toLowerCase();if(e.indexOf(d)!=-1){continue}a="Alpha-numeric characters only";break}}return a},handleSelectNode:function(d,c){var g=c.rslt.obj.attr("id"),f=$("#"+g+" .jstree-clicked").text(),b=c.rslt.obj.attr("type"),a=c.rslt.obj.attr("showOnlyPublic");this.container.trigger("folderClicked",{id:g,title:f,type:b,showOnlyPublic:a});this.selectedItem=c.rslt.obj;this.deselectAllCommonFolders();this.showSelectionBar();this.toggleDeleteButton(c)},showSelectionBar:function(){this.container.parent().find(".gliffy-folder-selection-bar").show();this.positionSelectionBar()},toggleDeleteButton:function(b){var a=$(".jstree-clicked").width();if(this.allowDelete&&a>0&&b.rslt.obj.parents("li").length>0&&b.rslt.obj.attr("type")===GliffyApp.accountFoldersController.GLIFFY_ONLINE_DIAGRAM_STORAGE_TYPE){$(".gliffy-folder-settings-button").show()}else{$(".gliffy-folder-settings-button").hide()}},hideSelectionBar:function(){$(".gliffy-folder-selection-bar").hide();$(".gliffy-folder-settings-button").hide()},showHoverBar:function(b){var a=this.container.parent().find(".gliffy-folder-hover-bar");a.show();a.css("top",this.container.find("#"+b+" a:first").offset().top-this.container.offset().top+this.container.position().top);a.css("left",3);a.width(this.container.width()-3)},hideHoverBar:function(){$(".gliffy-folder-hover-bar").hide()},positionSelectionBar:function(){var a=this.container.parent().find(".gliffy-folder-selection-bar");if(a.is(":visible")){a.width(this.container.width()-3);if(this.container.find(".jstree-clicked").offset()){a.css("top",this.container.find(".jstree-clicked").offset().top-this.container.offset().top+this.container.position().top);a.css("left",3);this.positionDeleteButton()}}},positionDeleteButton:function(){var a=this.container.parent().find(".gliffy-folder-selection-bar");$(".gliffy-folder-settings-button").css("top",a.offset().top+3);$(".gliffy-folder-settings-button").css("left",a.offset().left+a.width()-20)},handleDelete:function(){var a=this;GLIFFY.Dialog.showYesNoDialog({title:$.i18n._("online.account.folder.delete"),content:$.i18n._("online.account.folder.delete.confirm",[this.getSelectedFolderTitle()]),cancelCallback:null,buttons:[{text:$.i18n._("online.modal.cancel"),callback:null,primary:false,dismiss:true},{text:$.i18n._("online.modal.delete"),callback:function(b){a.deleteSelectedFolder()},primary:true,dismiss:true}]})},deleteSelectedFolder:function(){var a=this;window.GLIFFY.API.DELETE("folder.json",{query:{accountId:GliffyApp.authController.getAccountId(),folderId:a.selectedItem.attr("id")},success:function(c,d,b){if(c.success==="false"||c.success===false){a.displayFolderError(c.error)}else{a.hideSelectionBar();a.container.jstree("delete_node",a.selectedItem);GLIFFY.Utils.analyticsEvent("trackEvent",{category:"accountFolders",action:"deleteFolder",label:window.location.pathname})}a.updateDropZones()},error:function(d,b,c){a.displayFolderError(c);console.error("I borked")},context:this})},displayFolderError:function(a){GLIFFY.Dialog.showAlertDialog({title:$.i18n._("ERRORHANDLER_ERROR"),content:a,buttons:[{text:$.i18n._("DIALOG_OK"),primary:true,dismiss:true}]})},isNestedFolder:function(a){if(this.selectedItem!==null){if(this.container.jstree("get-parent",a)){return true}}return false},renameNode:function(b,a){this.container.jstree("rename_node",b,a)},getSelectedFolder:function(){return this.selectedItem},getSelectedFolderId:function(){if(this.selectedItem!==null){return this.selectedItem.attr("id")}return -1},getSelectedFolderType:function(){if(this.selectedItem!==null){return this.selectedItem.attr("type")}return null},getFolderTitleById:function(b){var a=$("#"+b+" > a").text();return a.substring(1)},getSelectedFolderTitle:function(){var a;if(this.selectedItem!==null){a=$("#"+this.selectedItem.attr("id")+" .jstree-clicked").text();return a.substring(1)}return null},handleCommonFolderClick:function(b,a){this.hideSelectionBar();this.deselectAllCommonFolders();$(b.currentTarget).addClass("gliffy-selected");if(this.selectedItem!==null){this.container.jstree("deselect_node",this.selectedItem);this.selectedItem=null}this.selectedCommonFolderId=a;this.container.trigger("folderClicked",{id:a})},deselectAllCommonFolders:function(){$(".gliffy-common-folders-container div.gliffy-common-folder").removeClass("gliffy-selected")},isSharedFolderSelected:function(){return(this.selectedItem===null&&this.selectedCommonFolderId===this.SHARED_FOLDER_ID)},toggleSettingsDropdown:function(){this.container.find(".gliffy-folder-settings-button .dropdown-toggle").click()},showSpinner:function(){$(".gliffy-document-list .gliffy-inner-spinner-icon").show()},hideSpinner:function(){$(".gliffy-document-list .gliffy-inner-spinner-icon").hide()},folder_data:null});GliffyApp.accountFoldersController=GliffyApp.AccountFoldersController.create()}());(function(){GliffyApp.FileOpenBrowserController=GliffyApp.AbstractFileDialogController.extend({init:function(){this._super(".gliffy-file-open-browser")},actions:{open:function(){this.handleDoubleClickItem()}},show:function(){this.createNewTab=true;$("#gliffy-modal-file-open-browser").modal("show");GliffyApp.documentListController.set("isEditableItems",false);this.configDocumentList();this.configDocumentSearch();this.configDocumentSort();this.configAccountFolders();GliffyApp.accountFoldersController.set("allowDelete",false)},hide:function(){$("#gliffy-modal-file-open-browser").modal("hide")}});GliffyApp.fileOpenBrowserController=GliffyApp.FileOpenBrowserController.create()}());(function(){GliffyApp.fileUploadController=Ember.Object.create({DEFAULT_MESSAGE_TYPE_ERROR:"This is not a valid file type for upload",DEFAULT_TEXT_UPLOAD_BUTTON:"Upload",FILE_EXTENSION_VDX:"vdx",FILE_EXTENSION_GXML:"gxml",FILE_EXTENSION_GON:"gon",FILE_EXTENSION_GLIFFY:"gliffy",FILE_EXTENSION_JPG:"jpg",FILE_EXTENSION_JPEG:"jpeg",FILE_EXTENSION_PNG:"png",FILE_EXTENSION_GIF:"gif",FILE_EXTENSION_SVG:"svg",init:function(){},createFileUploaderButton:function(b,a){b.fineUploader(this.getFileUploadConfigObject(a)).on("error",function(d,f,c,e){b.trigger("gliffy_fileUploadError",{id:f,filename:c,reason:e})}).on("complete",function(d,f,c,e){if(e&&e.success){b.trigger("giffy_fileUploadSuccess",{id:f,filename:c,data:e})}}).on("progress",function(e,g,c,d,f){b.trigger("gliffy_fileUploadProgress",{currentSize:d,totalSize:f})}).on("upload",function(d,e,c){b.trigger("gliffy_fileUploadStart",c)}).on("submit",function(d,e,c){$(this).fineUploader("setParams",{filename:c})}).on("click",function(c){console.log("upload click");if(a.click){return a.click(c)}});return b},updateOptions:function(b,a){b.fineUploader(this.getFileUploadConfigObject(a))},getFileUploadConfigObject:function(b){var a=this;if(!b||!b.url){throw new Error("GliffyApp.fileUploadController.getFileUploadConfigObject must have an options object passed in with a url parameter")}return{request:{endpoint:b.url},multiple:(b.multiple?b.multiple:false),validation:{allowedExtensions:(b.allowExtensions?b.allowExtensions:[]),acceptFiles:(b.acceptFiles?b.acceptFiles:[]),sizeLimit:b.sizeLimit},messages:{typeError:(b.invalidTypeMessage?b.invalidTypeMessage:a.DEFAULT_MESSAGE_TYPE_ERROR),sizeError:b.sizeLimitError},showMessage:function(c){},text:{uploadButton:(b.buttonText?b.buttonText:a.DEFAULT_TEXT_UPLOAD_BUTTON)},failedUploadTextDisplay:{mode:"none"},dragAndDrop:{disableDefaultDropzone:true}}},importDocument:function(){var a=window.GLIFFY.ENV.importDiagramUrl+"&accountId="+GliffyApp.authController.getAccountId()+"&noc="+(new Date()).getTime();GLIFFY.Dialog.showYesNoDialog({title:$.i18n._("online.file.upload.import.file"),content:$.i18n._("online.file.upload.import.success"),cancelCallback:null,buttons:[{text:$.i18n._("online.modal.open"),callback:function(b){window.open(a)},primary:true,dismiss:true},{text:$.i18n._("online.modal.cancel"),callback:null,primary:false,dismiss:true}]})}})}());(function(){GliffyApp.WelcomeScreenController=Ember.ObjectController.extend({recentDiagramList:null,templateList:null,isDemo:false,mode:null,showNoDocumentsState:false,init:function(){this.recentDiagramList=Ember.A([]);this.templateList=Ember.A([])},actions:{openAnotherDiagram:function(){this.handleOpenAnotherDiagram()},openTemplate:function(a){this.hide();this.handleOpenTemplate(a)},handleUploadClick:function(){$(".thumb-blue .qq-upload-button input[type=file]").trigger("click")},create:function(a){this.handleCreate(a)}},show:function(){$("#gliffy-modal-welcome-screen").modal("show");this.recentDiagramList.clear();this.loadRecentDiagramList("recent_diagrams.json",{userId:GliffyApp.authController.getUserID(),accountId:GliffyApp.authController.getAccountId(),max:5,app:window.GLIFFY.ENV.app});this._loadTemplates();this.clearUploadControlsUI()},_loadTemplates:function(){this.templateList.clear();this._addTemplate(80666,"Basic Diagram","symbol-basic.png");this._addTemplate(80003,"Flow Chart","symbol-flowchart.png");this._addTemplate(80008,"Org Chart","symbol-orgchart.png");this._addTemplate(80005,"UML / ERD","symbol-uml.png");this._addTemplate(80000,"BPMN","symbol-bpmn.png");this._addTemplate(80004,"Network Diagram","symbol-network.png");this._addTemplate(80007,"Wireframe","symbol-wireframe.png");this._addTemplate(80006,"Venn Diagram","symbol-venn.png");this._addTemplate(80002,"Floorplan","symbol-floorplan.png")},__getUploadOptions:function(){return{url:window.GLIFFY.API.getActionUrl("import_file.json",null),allowExtensions:[GliffyApp.fileUploadController.FILE_EXTENSION_GON,GliffyApp.fileUploadController.FILE_EXTENSION_GXML,GliffyApp.fileUploadController.FILE_EXTENSION_GLIFFY,GliffyApp.fileUploadController.FILE_EXTENSION_VDX],buttonText:$.i18n._("online.welcome.import.top"),click:function(a){GLIFFY.Utils.analyticsEvent("trackEvent",{category:"welcomeScreen",action:"importClick"})}}},createFileUploadControls:function(){var b=this.__getUploadOptions(),a=this;GliffyApp.fileUploadController.createFileUploaderButton($(".gliffy-welcome-screen .gliffy-file-upload-button"),jQuery.extend(b,{acceptFiles:[".gxml,application/gliffy+xml",".gliffy,application/gliffy+json",".gon,application/gliffy+json",".vdx,application/vnd.ms-visio"]}));b.buttonText=$.i18n._("online.welcome.import.button");GliffyApp.authController.addLoginCallback(function(){var c=a.__getUploadOptions();GliffyApp.fileUploadController.updateOptions($(".gliffy-welcome-screen .gliffy-file-upload-button"),jQuery.extend(c,{acceptFiles:[".gxml,application/gliffy+xml"]}))});$(".gliffy-welcome-screen [class^='gliffy-file-upload-button']").bind("giffy_fileUploadSuccess",function(d,c){a.handleFileImportSuccess(c)}).bind("gliffy_fileUploadError",function(d,c){a.handleFileImportError(c)}).bind("gliffy_fileUploadProgress",function(d,c){a.handleFileImportProgress(c)}).bind("gliffy_fileUploadStart",function(d,c){a.handleFileImportStart(c)})},clearUploadControlsUI:function(){$(".gliffy-welcome-screen-list-item").trigger("mouseleave")},handleFileImportSuccess:function(a){GliffyApp.progressBarController.hide();var b={callback:function(){GLIFFY.editor.handleCreateNewTab()}};GLIFFY.editor.openTemplateFromGON(a.data.diagram,b);GLIFFY.Utils.analyticsEvent("trackEvent",{category:"import",action:"importSuccess",label:"welcomeScreen;"+GLIFFY.onlineUtils.getFileHandle(a.filename)})},handleFileImportError:function(b){var a=this;this.hide();GliffyApp.progressBarController.hide();GLIFFY.Dialog.showAlertDialog({title:$.i18n._("ERRORHANDLER_ERROR"),content:$.i18n._("online.file.upload.import.error")+" "+b.reason+". "+$.i18n._("online.file.upload.import.error.action"),buttons:[{text:$.i18n._("DIALOG_OK"),callback:function(c){a.show()},primary:true,dismiss:true}]});GLIFFY.Utils.analyticsEvent("trackEvent",{category:"import",action:"importError",label:b.reason+";welcomeScreen;"+GLIFFY.onlineUtils.getFileHandle(b.filename)})},handleFileImportProgress:function(a){GliffyApp.progressBarController.updateProgress(a.currentSize,a.totalSize)},handleFileImportStart:function(a){this.hide();GliffyApp.progressBarController.show($.i18n._("online.welcome.importing")+" "+a)},hide:function(){$("#gliffy-modal-welcome-screen").modal("hide")},loadRecentDiagramList:function(b,a){if(this.isDemo){this.buildRecentDiagramList(GliffyApp.documentListController.documentListJSONStub.diagrams);this.render()}else{if(this.mode&&this.mode=="create"){this.set("showNoDocumentsState",true);$("#gliffy-modal-welcome-screen").height(400)}else{window.GLIFFY.API.GET(b,{query:a,success:function(d,e,c){this.buildRecentDiagramList(d.diagrams);this.render()},error:function(e,c,d){console.error("error loading document list",e,c,d)},context:this})}}},render:function(){if(this.recentDiagramList.length>0){this.set("showNoDocumentsState",false)}else{this.set("showNoDocumentsState",true)}},buildRecentDiagramList:function(d){var c,e,b,a=d.length;for(c=0;c<d.length;c++){e=d[c];b=Ember.Object.create();b.setProperties(e);this.recentDiagramList.pushObject(b)}setTimeout(function(){$(".gliffy-welcome-screen-list-item").tooltip(GLIFFY.Editor.TOOLTIP_OPTIONS_STANDARD)},1)},showSpinner:function(){},hideSpinner:function(){},handleOpenAnotherDiagram:function(a){this.hide();GliffyApp.fileOpenBrowserController.show();GliffyApp.fileOpenBrowserController.createNewTab=false;GLIFFY.Utils.analyticsEvent("trackEvent",{category:"welcomeScreen",action:"openAnother"})},handleSelectRecentDiagram:function(h,a){var c=this,d,b=null,g,f=a.content.urls.open;if(!GLIFFY.FEATURES.browserTabs){b=GLIFFY.editor.findOpenDocumentByUrl(f)}if(b===null){d={url:f,callback:function(){c.hide();if(a){a.alreadyClicked=true}}};GLIFFY.editor.open(d)}else{GliffyApp.documentTabsController.selectTab(b);this.hide()}GLIFFY.Utils.analyticsEvent("trackEvent",{category:"welcomeScreen",action:"openExisting"})},handleCreate:function(a){this.hide();if(a==="template"){GliffyApp.templateBrowserController.show();GliffyApp.templateBrowserController.createNewTab=false}GLIFFY.Utils.analyticsEvent("trackEvent",{category:"welcomeScreen",action:"createNew",label:a})},handleShowTips:function(c){var a=this;this.hide();var b=c.data("gliffy-tip-num");GliffyApp.tipsController.open(function(){a.show()});GliffyApp.tipsController.showTip(b);GLIFFY.Utils.analyticsEvent("trackEvent",{category:"welcomeScreen",action:"openTips",value:b})},_addTemplate:function(d,c,b){GliffyApp.templateBrowserController.set("createNewTab",false);var a=GliffyApp.welcomeTemplate.create({title:c,id:d,image:b,urls:{thumbnail:"/go/view/"+d+".png?size=thumbnail",open:"/go/api/diagram.json?diagramId="+d,update:"/go/api/diagram.json?diagramId="+d,template:"/go/api/diagram.json?diagramId="+d},"read-only":false});this.templateList.pushObject(a)},handleOpenTemplate:function(a){GLIFFY.API.GET(a.urls.template,{isUrl:true,success:function(b){GLIFFY.editor.open({jsonObj:b});GLIFFY.Utils.analyticsEvent("trackEvent",{category:"welcomeScreen",action:"openGliffyTemplate",label:a.title})},error:function(d,c,b){GLIFFY.Utils.analyticsEvent("trackEvent",{category:"welcomeScreen",action:"openGliffyTemplate",label:"fail"});GLIFFY.onlineUtils.handleDiagramActionError(d,c,b,$.i18n._("online.welcome.template.error"),true)}})}});GliffyApp.welcomeScreenController=GliffyApp.WelcomeScreenController.create();GliffyApp.welcomeTemplate=Ember.Object.extend({title:null,image:null,id:null,urls:{thumbnail:null,open:null,update:null},"read-only":false})}());(function(){var a=5000;GliffyApp.TemplateBrowserController=Ember.ObjectController.extend({createNewTab:true,actions:{open:function(){this.handleDoubleClickItem()}},show:function(){var b=this;this.createNewTab=!GLIFFY.FEATURES.browserTabs;$("#gliffy-modal-template-browser").modal("show");var b=this;GliffyApp.documentListController.clear();GliffyApp.documentListController.setContainer($(".gliffy-template-browser .gliffy-document-list-container"));GliffyApp.documentListController.setListLayout(false);GliffyApp.accountFoldersController.allowDelete=false;$(".gliffy-template-browser .gliffy-common-folders-container").hide();GliffyApp.accountFoldersController.load("templates_folder_tree.json",$(".gliffy-template-browser .gliffy-account-folders-container"),function(c){$(".gliffy-template-browser .gliffy-account-folders-container > ul > li > a").css("font-weight","bold");GliffyApp.accountFoldersController.selectFolder("#"+a);GliffyApp.accountFoldersController.openFolder("#"+a);GliffyApp.accountFoldersController.showSelectionBar()})},hide:function(){$("#gliffy-modal-template-browser").modal("hide")},handleCreate:function(d){var b=this,c=d.data("gliffy-create-type");if(c==="template"){this.hide();GliffyApp.templateBrowserController.show()}else{GLIFFY.editor.createUntitledTab(function(){b.hide()})}},openTemplate:function(e){var c=this,d,b;d={url:e.urls.open,callback:function(){c.hide();b=GLIFFY.editor.getDocumentManager().getActiveDocument();b.convertToTemplate();if(b.getStage().hasObjects()){b.getStage().setUnsavedChanges(true)}b.getUrls().isPublic=!GliffyApp.authController.isPaidAccount()&&!GliffyApp.authController.isTrialAccount();GliffyApp.documentModel.update(b)}};if(this.createNewTab){GLIFFY.editor.createUntitledTab(function(){GLIFFY.editor.open(d)})}else{GLIFFY.editor.open(d)}},handleFolderClick:function(b){if(b.showOnlyPublic){var c=GliffyApp.authController.getAccountId();GliffyApp.documentListController.load("folder_public_diagrams.json",{folderId:b.id,accountId:c},12)}else{GliffyApp.documentListController.load("folder_diagrams.json",{folderId:b.id},12)}},handleDoubleClickItem:function(){GliffyApp.documentListController.handleDoubleClickItem()},handleDocumentListScroll:function(b){GliffyApp.documentListController.scroll(b)},handleDocumentListScrollStart:function(b){GliffyApp.documentListController.scrollStart(b)},handleDocumentListScrollEnd:function(b){GliffyApp.documentListController.scrollEnd(b)}});GliffyApp.templateBrowserController=GliffyApp.TemplateBrowserController.create()}());(function(){GliffyApp.LoginSignupController=Ember.ObjectController.extend({user:null,modalBackdropState:"default",canCloseModal:true,init:function(){this.__signupModal=GliffyApp.ResumingModalController.create({modalSelector:"#gliffy-login-signup-modal"});this.__loginModal=GliffyApp.ResumingModalController.create({modalSelector:"#gliffy-login-signup-modal"})},actions:{handleLoginClick:function(){this.handleLoginClick()},handleSignupClick:function(){this.signUp()},handleForgotPassword:function(){window.open("/go/ologin/password/forgot?app=1b5094b0-6042-11e2-bcfd-0800200c9a66&email="+encodeURIComponent($("#gliffy-login-email").val()),"_blank")},handleGooglePlusLogin:function(){var a=window.open("/go/oauthStart?provider=google&app=1b5094b0-6042-11e2-bcfd-0800200c9a66");a.focus()},handleFacebookLogin:function(){var a=window.open("/go/oauthStart?provider=facebook&app=1b5094b0-6042-11e2-bcfd-0800200c9a66");a.focus()},handleMicrosoftLiveLogin:function(){var a=window.open("/go/oauthStart?provider=microsoft&app=1b5094b0-6042-11e2-bcfd-0800200c9a66");a.focus()}},resume:function(){if(this.__signupModal.isModalUp()){this.__signupModal.resume()}if(this.__loginModal.isModalUp()){this.__loginModal.resume()}},resumeExplicit:function(){var a=GliffyApp.loginSignupController;if(a.__signupModal.isModalUp()){a.__signupModal.resume()}if(a.__loginModal.isModalUp()){a.__loginModal.resume()}},handleLoginClick:function(){var a=this;window.GLIFFY.API.POST("login.json",{email:$("#gliffy-login-signup-modal").find(".gliffy-login-email").val(),password:$("#gliffy-login-signup-modal").find(".gliffy-login-password").val()},{success:function(c,d,b){if(c.errors&&c.errors.length>0){if(c.noaccount==true){window.location="/go/noaccount"}GLIFFY.onlineUtils.setModalErrorMessage("#gliffy-login-signup-modal",c.errors)}else{a.loginAndResume(c);GLIFFY.Utils.analyticsEvent("trackEvent",{category:"user",action:"loginSuccess"})}},error:function(d,b,c){GLIFFY.onlineUtils.setModalErrorMessage("#gliffy-login-signup-modal",c);console.error("error logging in",d,b,c)},context:this})},loginAndResume:function(a){var b=this;var c=a.defaultAccountId||a.accountId||null;GliffyApp.authController.login(a,c,function(){if(a.isTempPassword){$(b.__loginModal.modalSelector).unbind("hidden.gliffycancel").modal("hide");GliffyApp.tempPasswordController.show(function(){b.resume()})}else{b.resume()}$(window).trigger("gliffy.loginEvent")})},center:function(){this.theModal.css("margin-top","-"+(this.theModal.height()/2)+"px")},showSignup:function(a,b){this.theModal=$("#gliffy-login-signup-modal");this.__enablePrimaryButtons();this.__signupModal.show(a,b);this.center();if(typeof GLIFFY.onlineUtils.signupModalTimer!=="undefined"&&GLIFFY.onlineUtils.signupModalTimer){clearTimeout(GLIFFY.onlineUtils.signupModalTimer)}GLIFFY.Utils.analyticsEvent("trackEvent",{category:"lzxclient",action:"View Sign Up",label:window.location.pathname});GLIFFY.Utils.analyticsEvent("trackEvent",{category:"user",action:"viewSignUp",label:window.location.pathname})},resetForms:function(){$("#gliffy-login-email").val("");$("#gliffy-login-password").val("");$("#gliffy-signup-name").val("");$("#gliffy-signup-email").val("");$("#gliffy-signup-password").val("");$("#gliffy-signup-confirm").val("");$("#gliffy-signup-organization-size").val("");$("#gliffy-signup-accept-terms").attr("checked",false);$("#gliffy-login-signup-modal .alert-error").hide()},show:function(a,b){this.theModal=$("#gliffy-login-signup-modal");$(".gliffy-modal-instr.registered-instruction").show();this.__enablePrimaryButtons();this.resetForms();if(GliffyApp.authController.isAnonymousAccount()){this.showSignup(a,b)}else{this.__loginModal.show(a,b)}},signUp:function(){var a=this;a.__disablePrimaryButtons();window.GLIFFY.API.POST("signup.json",{email:$("#gliffy-signup-email").val(),confirmEmail:$("#gliffy-signup-emailconfirm").val(),password:$("#gliffy-signup-password").val(),confirmPassword:$("#gliffy-signup-confirm").val(),firstName:$("#gliffy-signup-firstname").val(),lastName:$("#gliffy-signup-lastname").val(),organizationSize:$("#organizationSizeField").val(),termsAndConditions:$("#gliffy-signup-accept-terms").is(":checked")?"true":"",abVar:window.abVar,abVarPremShape:""},{success:function(c,d,b){if(c.errors&&c.errors.length>0){$("#gliffy-login-signup-modal .alert").show().children("span").html(GLIFFY.onlineUtils.formatFormError(c.errors));this.__enablePrimaryButtons();a.center()}else{if(window.mixpanel){window.mixpanel.alias(c.uid);window.mixpanel.people.set({"$email":GliffyApp.authController.getUsername(),"$created":new Date(),product:"NOPE"});window.mixpanel.track("signup",{appId:window.GLIFFY.ENV.app,where:"inAppLoginSignup",appName:window.GLIFFY.ENV.appName})}a.loginAndResume(c);GLIFFY.Utils.analyticsEvent("trackEvent",{category:"lzxclient",action:"signUpSuccess",label:window.location.pathname});GLIFFY.Utils.analyticsEvent("trackEvent",{category:"user",action:"signUpSuccess",label:window.location.pathname});if((typeof chrome!=="undefined")&&chrome.app.isInstalled){GLIFFY.Utils.analyticsEvent("trackEvent",{category:"user",action:"signUpSuccessChromeAppUser",label:window.location.pathname})}window.optimizely=(window.optimizely&&window.optimizely.push)?window.optimizely:[];window.optimizely.push(["trackEvent","signUpSuccess"])}},error:function(d,b,c){GLIFFY.onlineUtils.setModalErrorMessage("#gliffy-login-signup-modal",c);a.center();console.error("error logging in",d,b,c);a.__enablePrimaryButtons()},context:this})},__disablePrimaryButtons:function(){this.theModal.find(".gliffy-btn-primary").attr("disabled",true);this.theModal.find(".gliffy-save-spinner").show()},__enablePrimaryButtons:function(){this.theModal.find(".gliffy-btn-primary").attr("disabled",false);this.theModal.find(".gliffy-save-spinner").hide()}});GliffyApp.loginSignupController=GliffyApp.LoginSignupController.create()}());(function(){GliffyApp.loginWelcomeController=Ember.Object.create({__loginModal:null,onLogin:null,init:function(){},show:function(a,b){this.onLogin=null;if(a){this.onLogin=a}this.__loginModal=$("#gliffy-login-modal");this.__loginModal.modal("show");if(window.GLIFFY.ENV.loginEmail){this.__loginModal.find(".gliffy-login-email").val(window.GLIFFY.ENV.loginEmail);this.__loginModal.find(".gliffy-login-password").focus()}else{this.__loginModal.find(".gliffy-login-email").focus()}},hide:function(){this.__loginModal.modal("hide")},showWelcomeScreen:function(){this.__loginModal.modal("hide");if(this.onLogin!==null){this.onLogin()}else{if(window.GLIFFY.ENV.newDiagramUrl&&window.GLIFFY.ENV.newDiagramUrl.indexOf(window.location.pathname)>-1){GliffyApp.templateBrowserController.show()}else{GliffyApp.welcomeScreenController.show()}}},handleLoginClick:function(b){var a=this;window.GLIFFY.API.POST("login.json",{email:this.__loginModal.find(".gliffy-login-email").val(),password:this.__loginModal.find(".gliffy-login-password").val(),folderId:(window.GLIFFY.ENV.newDiagramFolderId||null)},{success:function(d,e,c){if(d.errors&&d.errors.length>0){GLIFFY.onlineUtils.setModalErrorMessage("#gliffy-login-modal",d.errors)}else{a.loginAndResume(d);GLIFFY.Utils.analyticsEvent("trackEvent",{category:"user",action:"loginSuccess"})}},error:function(e,c,d){GLIFFY.onlineUtils.setModalErrorMessage("#gliffy-login-modal",d);console.error("error logging in",e,c,d)},context:this})},loginAndResume:function(a){var b=this;GliffyApp.authController.login(a,a.accountId||null,function(){if(a.isTempPassword){b.hide();GliffyApp.tempPasswordController.show(function(){b.showWelcomeScreen()})}else{b.showWelcomeScreen()}})}})}());(function(){GliffyApp.demoController=Ember.Object.create({init:function(){},show:function(){GliffyApp.authController.enableDemoMode();$("#gliffy-tips-checkbox-no-tips").parent().hide();GliffyApp.tipsController.open();GLIFFY.Utils.analyticsEvent("trackEvent",{category:"lzxclient",action:"Anonymous",label:window.location.pathname});GLIFFY.Utils.analyticsEvent("trackEvent",{category:"user",action:"anonymous",label:window.location.pathname})},hide:function(){GliffyApp.tipsController.close()}})}());(function(){GliffyApp.CollaborationController=GliffyApp.AbstractModalController.extend({masterCollaboratorList:null,newCollaboratorList:null,accountUserList:null,collaboratorCountHtml:0,diagramUrl:null,diagramId:0,diagramTitle:null,EMAIL_VERIFY_STATE:"email-verify",MAIN_STATE:"main",LOADING_STATE:"loading",UPGRADE_STATE:"upgrade",actions:{verifyEmailSubmit:function(){this.verifyEmail($("#gliffy-collaboration-modal .gliffy-collaboration-state-email-verify input").val())},resendLinkClick:function(){this.resendVerifyEmail()},learnMoreClick:function(){},upgrade:function(){GliffyApp.authController.openUpgrade("collaborate")},closeAlert:function(){$("#gliffy-collaboration-modal .alert-floating").hide()},handleRemoveUser:function(a){this.removeCollaborator(a,this.diagramId)},share:function(a){this.addCollaborators($("#gliffy-collaboration-modal textarea").val(),$("#gliffy-collaboration-modal .gliffy-collaboration-state-main input").get(0).checked)}},show:function(a,b){if(a){this.diagramId=a;this.diagramTitle=b}else{this.diagramId=window.GLIFFY.editor.getDocumentManager().getActiveDocument().getUrls().id;this.diagramTitle=window.GLIFFY.editor.getDocumentManager().getActiveDocument().getTitle()}this.theModal=$("#gliffy-collaboration-modal");this.theModal.find(".gliffy-manage-users-permissions").hide();this.reset();this.theModal.modal("show");if(GliffyApp.authController.get("propIsFreeAccount")){this.__showState(this.UPGRADE_STATE)}else{if(GliffyApp.authController.isConfirmed()){this.__getAccountUserList()}else{this.__showState(this.EMAIL_VERIFY_STATE)}}},reset:function(){var a=window.location.protocol+"//"+window.location.host;this.__showState(this.LOADING_STATE);this.theModal.find(".alert-floating").hide();this.__hideListUIBlocker();this.__enablePrimaryButtons();this.accountUserList=[];this.set("collaboratorCountHtml",0);this.__populateCollaboratorsModel("newCollaboratorList",{collaborators:[]});this.set("diagramUrl",a+"/go/html5/"+this.diagramId)},addCollaborators:function(e,b){var a,d;e=e.split(" ").join("");e=e.split("\r").join("");e=e.split("\n").join("");if(this.__validateEmailList(e)){d=this.__getCleanEmailList(e);if(d.length>1){GLIFFY.Utils.analyticsEvent("trackEvent",{category:"collaborate",action:"multipleEmails",value:d.length})}for(a=0;a<d.length;a++){var c=GliffyApp.CollaboratorModel.create();c.set("email",d[a]);c.set("isViewer",b);c.set("isCollaborator",!b);c.set("isOwner",false);this.newCollaboratorList.pushObject(c)}this.__persistCollaboratorList()}},removeCollaborator:function(e,b,a,d){var c=this;if(this.theModal){c.__showListUIBlocker()}window.GLIFFY.API.DELETE("diagram/"+b+"/collaborator/"+e.id,{query:{},success:function(g,h,f){if(a){a(g,h,f)}else{c.__hideListUIBlocker();c.masterCollaboratorList.removeObject(e)}GLIFFY.Utils.analyticsEvent("trackEvent",{category:"collaborate",action:"removeSuccess"});if(window.mixpanel){window.mixpanel.track("uncollaborate",{appId:window.GLIFFY.ENV.app,accountCreateDate:GliffyApp.authController.getAccountCreateDate(),diagramId:GliffyApp.documentModel.id})}if(typeof mktoMunchkinFunction=="function"&&GliffyApp.authController.getMunchkinKey()){mktoMunchkinFunction("visitWebPage",{url:"/go/application/uncollaborate"})}},error:function(h,f,g){g=GLIFFY.onlineUtils.handleDiagramActionError(h,f,g,"Failed to remove collaborator.",false);if(d){d(h,f,g)}else{c.__hideListUIBlocker();c.__displayErrorMessage(c.MAIN_STATE,"Failed to remove collaborator. "+g)}console.error("error removing collaborator",h,f,g)},context:this})},verifyEmail:function(b){var a=this;this.__disablePrimaryButtons();window.GLIFFY.API.PUT("user/verifyEmail",null,{query:{confCode:b},success:function(c){GliffyApp.authController.setIsConfirmed(true);a.__enablePrimaryButtons();a.show()},error:function(e,d,c){a.__enablePrimaryButtons();a.__displayErrorMessage(a.EMAIL_VERIFY_STATE,"Failed to verify email with confirmation code. Please enter a valid confirmation code.");console.error("error verifying confirmation code",e,status,c)},context:this})},resendVerifyEmail:function(){var a=this;window.GLIFFY.API.GET("user/resendVerification",{query:{app:window.GLIFFY.ENV.app},success:function(c,d,b){a.__displaySuccessMessage(a.EMAIL_VERIFY_STATE,"Verification email sent to "+c+".")},error:function(d,b,c){a.__displayErrorMessage(a.EMAIL_VERIFY_STATE,"Failed to send verification email.");console.error("error loading collaborator list",d,b,c)},context:this})},__displaySuccessMessage:function(b,a,d){var c=this.theModal.find(".gliffy-collaboration-state-"+b+" .alert-floating");c.removeClass("alert-error").addClass("alert-success").find("span").html(a);c.show();if(d){setTimeout(function(){c.fadeOut(1000)},d)}},__displayErrorMessage:function(b,a){var c=this.theModal.find(".gliffy-collaboration-state-"+b+" .alert-floating");c.removeClass("alert-success").addClass("alert-error").find("span").html(a);c.show()},__showState:function(a){$("[class*='gliffy-collaboration-state-']").hide();$(".gliffy-collaboration-state-"+a).show();if(a===this.EMAIL_VERIFY_STATE){this.setTitle("Confirm Your Email");this.setSize(600,320);$("#gliffy-collaboration-modal .gliffy-collaboration-state-email-verify input").focus();$("#gliffy-collaboration-modal .gliffy-collaboration-state-email-verify input").val("")}else{this.setTitle("Collaborate");if(a===this.UPGRADE_STATE){this.setSize(this.theModal.css("max-width"),210)}else{this.setSize(this.theModal.css("max-width"),this.theModal.css("max-height"))}}},__persistCollaboratorList:function(){var a=this;this.__disablePrimaryButtons();window.GLIFFY.API.PUT("diagram/"+this.diagramId+"/collaborators.json",{master:this.masterCollaboratorList.toObject().collaborators,"new":this.newCollaboratorList.toObject().collaborators},{query:{accountId:GliffyApp.authController.getAccountId(),app:GLIFFY.ENV.app},success:function(b){a.__displaySuccessMessage("main","<b>Done!</b> Your invitation has been sent!",4000);a.__enablePrimaryButtons();$("#gliffy-collaboration-modal textarea").val("");a.__getCollaboratorList();GLIFFY.Utils.analyticsEvent("trackEvent",{category:"collaborate",action:"addSuccess"});if(window.mixpanel){window.mixpanel.track("collaborate",{appId:window.GLIFFY.ENV.app,accountCreateDate:GliffyApp.authController.getAccountCreateDate(),diagramId:GliffyApp.documentModel.id,email:a.newCollaboratorList()})}if(typeof mktoMunchkinFunction=="function"&&GliffyApp.authController.getMunchkinKey()){mktoMunchkinFunction("visitWebPage",{url:"/go/application/collaborate"})}a.newCollaboratorList.clear()},error:function(d,c,b){a.newCollaboratorList.clear();a.__enablePrimaryButtons();b=GLIFFY.onlineUtils.handleDiagramActionError(d,c,b,"Failed to remove collaborator.",false);a.__displayErrorMessage(a.MAIN_STATE,"Failed to remove collaborator. "+b)},context:this})},__disablePrimaryButtons:function(){this.theModal.find(".gliffy-btn-primary").attr("disabled",true);this.theModal.find(".gliffy-save-spinner").show()},__enablePrimaryButtons:function(){this.theModal.find(".gliffy-btn-primary").attr("disabled",false);this.theModal.find(".gliffy-save-spinner").hide()},__showListUIBlocker:function(){this.theModal.find(".gliffy-processing-list-ui-blocker").css("left",0)},__hideListUIBlocker:function(){this.theModal.find(".gliffy-processing-list-ui-blocker").css("left",5000)},__getAccountUserList:function(){var a=this;window.GLIFFY.API.GET("account/users.json",{query:{accountId:GliffyApp.authController.getAccountId()},success:function(c,d,b){if(c.users){a.accountUserList=c.users}a.__getCollaboratorList()},error:function(d,b,c){a.__displayErrorMessage(a.LOADING_STATE,"Error getting account user list. "+c+"<br/>Please contact support@gliffy.com if problem persists.");console.error("error loading account user list",d,b,c)},context:this})},__getCollaboratorList:function(){var a=this;this.__showListUIBlocker();window.GLIFFY.API.GET("diagram/"+this.diagramId+"/listCollaborators.json",{query:{},success:function(c,d,b){a.__showState("main");a.__populateCollaboratorsModel("masterCollaboratorList",c);a.__updateCountDisplay();$("#gliffy-collaboration-modal textarea").focus();$("#gliffy-collaboration-modal textarea").val("");a.__hideListUIBlocker()},error:function(d,b,c){console.log("ERROR!");c=GLIFFY.onlineUtils.handleDiagramActionError(d,text,c,"Error getting collaborator list.",false);a.__displayErrorMessage(a.LOADING_STATE,"Error getting collaborator list. "+c+"<br/>Please contact support@gliffy.com if problem persists.");a.__hideListUIBlocker();console.error("error loading collaborator list",d,b,c)},context:this})},__populateCollaboratorsModel:function(b,c){var a=GliffyApp.CollaboratorsModel.create();a.fromObject(c);this.set(b,a)},__updateCountDisplay:function(){var a=this.get("masterCollaboratorList").content.length;if(a>1){this.set("collaboratorCountHtml",""+a+" Collaborators")}else{this.set("collaboratorCountHtml","1 Collaborator")}},__validateEmailList:function(c){var a,b,d=[];if(c===""){return false}b=c.split(",");for(a=0;a<b.length;a++){if(!window.GLIFFY.onlineUtils.isValidEmail(b[a])){GLIFFY.Utils.analyticsEvent("trackEvent",{category:"collaborate",action:"invalidEmailEntry"});this.__displayErrorMessage(this.MAIN_STATE,b[a]+" is an invalid email");return false}}return true},__getCleanEmailList:function(c){var a,b=c.split(","),d=[];for(a=0;a<b.length;a++){if(this.__collaboratorExists(b[a])){continue}if(!($.inArray(b[a],d)>-1)){d[d.length]=b[a]}}return d},__collaboratorExists:function(c){var d,b=this.masterCollaboratorList.content,a=this.n;for(d=0;d<b.length;d++){if(b[0].email===c){return true}}return false},__collaboratorIsInAccount:function(a){var b;for(b=0;b<this.accountUserList.length;b++){if(a===this.accountUserList[b].email){return true}}return false}});GliffyApp.collaborationController=GliffyApp.CollaborationController.create()}());(function(){GliffyApp.PublishController=GliffyApp.AbstractModalController.extend({webPageUrl:null,imageUrl:null,embedCode:null,showUpgrade:false,IMAGE_SIZE_LARGE:null,IMAGE_SIZE_MEDIUM:null,IMAGE_SIZE_SMALL:null,IMAGE_SIZE_THUMBNAIL:null,__publishCallback:null,__createdSocialButtons:false,actions:{upgrade:function(){GliffyApp.authController.openUpgrade("publish")},closeAlert:function(){this.theModal.find(".alert-floating").hide()}},config:function(){this.IMAGE_SIZE_LARGE=$.i18n._("online.publish.link.image.large");this.IMAGE_SIZE_MEDIUM=$.i18n._("online.publish.link.image.medium");this.IMAGE_SIZE_SMALL=$.i18n._("online.publish.link.image.small");this.IMAGE_SIZE_THUMBNAIL=$.i18n._("online.publish.link.image.thumbnail")},show:function(a){this.__publishCallback=a;this.theModal=$("#gliffy-publish-modal");this.theModal.modal("show");this.reset()},reset:function(){var b=this;var a=this.webPageUrl;this.theModal.find("input[name=gliffy-published-radio-group][value="+GliffyApp.documentModel.isPublic+"]").prop("checked",true);this.set("webPageUrl","http://"+window.location.host+"/go/publish/"+GliffyApp.documentModel.id);this.handleImageSizeSelect(this.IMAGE_SIZE_LARGE);if(GliffyApp.documentModel.isPublic&&this.webPageUrl!==a){b.__destroySocialButtons();b.__createSocialButtons()}b.theModal.find("textarea").text(b.__generateEmbedCode(b.IMAGE_SIZE_LARGE));b.toggleUpgradeMessage(false)},handlePublish:function(a){if(a==="true"){this.doPublish()}else{this.doUnpublish()}},handleImageSizeSelect:function(b){this.theModal.find(".gliffy-publish-images-share button:first-child").html(b);var a=this.theModal.find('.gliffy-publish-images-share ul li a[name="'+b+'"]').attr("code");this.set("imageUrl","http://"+window.location.host+"/go/publish/image/"+GliffyApp.documentModel.id+"/"+a+".png");GLIFFY.Utils.analyticsEvent("trackEvent",{category:"publish",action:"diagramUrlChange",label:b})},handleSocialPublish:function(a){},toggleUpgradeMessage:function(a){this.set("showUpgrade",a);this.updateModalUI()},updateModalUI:function(){var a=this;if(GliffyApp.documentModel.isPublic){if(this.get("showUpgrade")){this.theModal.find(".gliffy-modal-body-section.public").hide();this.theModal.find(".gliffy-modal-body-section.upgrade").show();this.setHeight(255,true)}else{this.theModal.find(".gliffy-modal-body-section.public").show();this.theModal.find(".gliffy-modal-body-section.upgrade").hide();this.resetSize(true);setTimeout(function(){if(!a.__createdSocialButtons){a.__destroySocialButtons();a.__createSocialButtons()}},500)}}else{this.theModal.find(".gliffy-modal-body-section.public").hide();this.theModal.find(".gliffy-modal-body-section.upgrade").hide();this.setHeight(160,true)}},doPublish:function(){var a=this;a.showUIBlocker();window.GLIFFY.API.PUT("diagram/"+GliffyApp.documentModel.id+"/publish",null,{query:{},success:function(b){a.hideUIBlocker();GliffyApp.documentModel.set("isPublic",true);if(window.GLIFFY.editor){window.GLIFFY.editor.getDocumentManager().getActiveDocument().getUrls().isPublic=true}a.reset();if(a.__publishCallback!==undefined){a.__publishCallback()}GLIFFY.Utils.analyticsEvent("trackEvent",{category:"publish",action:"publishClick",label:GliffyApp.authController.getProductType()});if(window.mixpanel){window.mixpanel.track("publish",{appId:window.GLIFFY.ENV.app,accountCreateDate:GliffyApp.authController.getAccountCreateDate(),diagramId:GliffyApp.documentModel.id})}},error:function(d,c,b){a.hideUIBlocker();a.reset();b=GLIFFY.onlineUtils.handleDiagramActionError(d,c,b,"Failed to publish your diagram.",false);a.__displayErrorMessage(b+"<br/>Please contact support@gliffy.com if the problem persists.");console.error("Failed to publish your diagram",d,status,b)},context:this})},doUnpublish:function(){var a=this;if(GliffyApp.authController.get("propIsFreeAccount")){this.toggleUpgradeMessage(true)}else{this.showUIBlocker();window.GLIFFY.API.PUT("diagram/"+GliffyApp.documentModel.id+"/unpublish",null,{query:{},success:function(b){a.hideUIBlocker();GliffyApp.documentModel.set("isPublic",false);if(window.GLIFFY.editor){window.GLIFFY.editor.getDocumentManager().getActiveDocument().getUrls().isPublic=false}a.reset();if(a.__publishCallback!==undefined){a.__publishCallback()}GLIFFY.Utils.analyticsEvent("trackEvent",{category:"publish",action:"privateClick",label:GliffyApp.authController.getProductType()});if(window.mixpanel){window.mixpanel.track("unpublish",{appId:window.GLIFFY.ENV.app,accountCreateDate:GliffyApp.authController.getAccountCreateDate(),diagramId:GliffyApp.documentModel.id})}},error:function(d,c,b){a.hideUIBlocker();b=GLIFFY.onlineUtils.handleDiagramActionError(d,c,b,"Failed to un-publish your diagram.",false);a.__displayErrorMessage(b+"<br/>Please contact support@gliffy.com if the problem persists.");console.error("error unpublishing the diagram",d,status,b)},context:this})}},__createSocialButtons:function(){var b=this,d,c,h="",a,g,f=this.webPageUrl,e=encodeURIComponent(this.webPageUrl);if(!this.__createdSocialButtons){$("body").append($('<div id="fb-root"></div><script>(function(d, s, id) {var js, fjs = d.getElementsByTagName(s)[0];if (d.getElementById(id)) return;js = d.createElement(s); js.id = id;js.src = "//connect.facebook.net/en_US/all.js#xfbml=1&status=0";fjs.parentNode.insertBefore(js, fjs);}(document, "script", "facebook-jssdk"));<\/script>'));c='<a href="'+this.__getTwitterHref(e)+'"><span></span></a>';$(".gliffy-publish-twitter").append($(c));h='<script src="//platform.linkedin.com/in.js" type="text/javascript"><\/script>';h+='<script type="IN/Share" data-url="'+f+'"><\/script>';$(".gliffy-publish-linkedin").append(h);$(".gliffy-publish-linkedin").on("click",function(){b.__tracksSocialButtonClick("linkedin")});g='<a data-pin-config="none" target="_blank" href="'+this.__getPinterestHref(e)+'" data-pin-do="buttonPin" ><img src="https://assets.pinterest.com/images/pidgets/pin_it_button.png" /></a>';g+='<script type="text/javascript" src="https://assets.pinterest.com/js/pinit.js"><\/script>';$(".gliffy-publish-pinterest").append(g);setTimeout(function(){$(".gliffy-publish-pinterest a").click(function(){b.__tracksSocialButtonClick("pinterest")});$(".gliffy-publish-twitter a").on("click",function(i){b.__tracksSocialButtonClick("twitter");i.preventDefault();window.open(b.__getTwitterHref(encodeURIComponent(b.webPageUrl)),"_blank","width=550,height=450")});if(FB){FB.Event.subscribe("edge.create",function(i){b.__tracksSocialButtonClick("facebook")})}},1000)}else{$(".gliffy-publish-linkedin script").attr("data-url",f);$(".gliffy-publish-pinterest a").attr("href",this.__getPinterestHref(e));$(".gliffy-publish-twitter a").attr("href",this.__getTwitterHref(e))}if(GLIFFY.FEATURES.browserTabs){d='<fb:like href="'+f+'" send="false" layout="button_count" width="450" show_faces="true"></fb:like>'}else{d=$('<iframe src="https://www.facebook.com/plugins/like.php?href='+e+'&amp;send=false&amp;layout=button_count&amp;width=450&amp;show_faces=false&amp;font=arial&amp;colorscheme=light&amp;action=like&amp;height=22" scrolling="no" frameborder="0" style="border:none; overflow:visible; width:47px; height:22px;" allowTransparency="true"></iframe>')}$(".gliffy-publish-facebook").append(d);a='<div class="g-plusone" data-size="medium" data-annotation="none" data-href="'+f+'" data-callback="plusOneClick"></div><script type="text/javascript">function plusOneClick(response) {    GliffyApp.publishController.__tracksSocialButtonClick("google");}(function() {var po = document.createElement("script"); po.type = "text/javascript"; po.async = true;po.src = "https://apis.google.com/js/plusone.js";var s = document.getElementsByTagName("script")[0]; s.parentNode.insertBefore(po, s);})();<\/script>';$(".gliffy-publish-google").append(a);this.__createdSocialButtons=true},__tracksSocialButtonClick:function(a){GLIFFY.Utils.analyticsEvent("trackEvent",{category:"publish",action:"socialButtonClick",label:a});if(window.mixpanel){window.mixpanel.track("social",{appId:window.GLIFFY.ENV.app,accountCreateDate:GliffyApp.authController.getAccountCreateDate(),channel:a,diagramId:GliffyApp.documentModel.id})}},__getPinterestHref:function(a){return"https://pinterest.com/pin/create/button/?url="+a+"&media="+encodeURIComponent(this.imageUrl)+"&description=Check%20out%20my%20Gliffy%20Diagram:%20"+encodeURIComponent(GliffyApp.documentModel.title)},__getTwitterHref:function(a){return"https://twitter.com/share?via=gliffy&url="+a+"&text=Check%20out%20my%20Gliffy%20Diagram:%20"+encodeURIComponent(GliffyApp.documentModel.title)},__destroySocialButtons:function(){$(".gliffy-publish-facebook").empty();$(".gliffy-publish-google").empty()},__generateEmbedCode:function(c,b,a){var d='<script src="https://www.gliffy.com/diagramEmbed.js" type="text/javascript"> <\/script><script type="text/javascript"> gliffy_did = "'+GliffyApp.documentModel.id+'"; embedGliffy(); <\/script>';return d}});GliffyApp.publishController=GliffyApp.PublishController.create()}());(function(){GliffyApp.AccountManageController=Ember.ObjectController.extend({USER_ROLE_ADMIN:"ADMIN",USER_ROLE_USER:"USER",accountUsers:null,accountUserNumber:null,accountMaxUsers:null,remainingDiagrams:null,remainingUsers:null,errorMessages:null,emailErrorMessages:null,emailUpdateSuccess:false,theModal:null,accountHistory:null,infoUpdateSuccess:false,changeEmail:null,changeAccountName:null,accountNameErrors:null,accountNameUpdateSuccess:false,showErrors:false,showEmailErrors:false,showAccountNameErrors:false,oldPassword:null,password1:null,password2:null,__tabIdToOpenOnLoad:null,init:function(){this.accountUsers=Ember.A([]);this.errorMessages=Ember.A([]);this.cancelReasons=Ember.A([]);this.accountNameErrors=Ember.A([])},populate:function(){this.loadBasic();this.loadUsers();GliffyApp.authController.fetchUser()},actions:{showAccountModal:function(){this.show()},showUpdate:function(){GLIFFY.Utils.analyticsEvent("trackEvent",{category:"/event/gliffy/upgrade",action:"viewAccountManageUpgradeTab"});this.setTab("#account-upgrade")},getInvoice:function(a){window.open("/go/api/account/invoice?accountId="+GliffyApp.authController.account.id+"&invoiceId="+a.get("id")+"&isPaymentJournalEntry="+a.get("isPaymentJournalEntry"),"_blank")},closePIAlert:function(){this.hidePIAlerts()},submitEMailChange:function(){var a=this;a.clearErrors();a.hidePIAlerts();GLIFFY.API.POST("user/changeEmail",{email:a.get("changeEmail")},{success:function(e,f,d){if(e.errors&&e.errors.length>0){for(var c=0;c<e.errors.length;c++){var b=GliffyApp.errorMsg.create({key:e.errors[c].key,message:e.errors[c].message});a.emailErrorMessages.pushObject(b)}a.set("showEmailErrors",true)}else{a.set("emailUpdateSuccess",true)}a.accountLoad();GliffyApp.authController.fetchUser()},error:function(d,c,b){var c=GliffyApp.ACMErrorMessage.create({fieldName:null,errorMsg:"The server encountered an error. Please try again later or contact support@gliffy.com"})}})},submitPasswordChange:function(){this.ga("piChangeSubmit","");var a=this;a.clearErrors();a.hidePIAlerts();GLIFFY.API.POST("user/changeUserPassword",{oldPassword:a.get("oldPassword"),password1:a.get("password1"),password2:a.get("password2")},{success:function(e,f,d){if(e.errors&&e.errors.length>0){for(var c=0;c<e.errors.length;c++){var b=GliffyApp.errorMsg.create({key:e.errors[c].key,message:e.errors[c].message});a.errorMessages.pushObject(b)}a.set("showErrors",true)}else{a.set("infoUpdateSuccess",true)}a.clearPassForm()},error:function(d,c,b){var c=GliffyApp.ACMErrorMessage.create({fieldName:null,errorMsg:"The server encountered an error. Please try again later or contact support@gliffy.com"})}})},unlinkGoogleDrive:function(){var a=this;GLIFFY.API.GET("user/unlinkGoogleDrive",{success:function(c,d,b){GliffyApp.authController.unlinkGoogleDriveFromAccount();a.populate()}})},launchVerify:function(){GliffyApp.verifyEmailController.show()},submitAccountNameChange:function(){var a=this;a.clearErrors();a.hidePIAlerts();GLIFFY.API.POST("account/changeName",{accountname:a.get("changeAccountName"),accountId:GliffyApp.authController.getAccountId()},{success:function(e,f,d){if(e.errors&&e.errors.length>0){for(var c=0;c<e.errors.length;c++){var b=GliffyApp.errorMsg.create({key:e.errors[c].key,message:e.errors[c].message});a.accountNameErrors.pushObject(b)}a.set("showAccountNameErrors",true)}else{a.set("accountNameUpdateSuccess",true)}a.accountLoad();GliffyApp.authController.get("account").fetch()},error:function(d,c,b){var c=GliffyApp.ACMErrorMessage.create({fieldName:null,errorMsg:"The server encountered an error. Please try again later or contact support@gliffy.com"})}})},upgradeClick:function(){GliffyApp.authController.openUpgrade()},closeAlert:function(){this.hideManageUsersErrorMessage()},handleAddClick:function(){this.addUsers()},handleRemoveUser:function(a){this.removeUser(a)},handleAdminClick:function(a){this.updateUserAdminStatus(a,!a.get("isAdmin"))}},ga:function(a,b){GLIFFY.Utils.analyticsEvent("trackEvent",{category:"accountManage",action:a,label:b})},loadBasic:function(){var a=this;var b=0;GliffyApp.authController.fetchAccount(function(){b=GliffyApp.authController.propAccountMaxDiagrams-GliffyApp.authController.getAccountDiagrams();if(b<0){b=0}a.set("remainingDiagrams",b);if(a.__tabIdToOpenOnLoad){a.setTab(a.__tabIdToOpenOnLoad)}})},hasRemainingUsers:Ember.computed(function(){return(this.get("remainingUsers")>0)}).property("remainingUsers"),accountLoad:function(){this.loadBasic();this.loadHistory()},show:function(){this.set("infoUpdateSuccess",false);this.set("showErrors",false);this.ga("showModal","");this.set("changeEmail",GliffyApp.authController.getUsername());this.set("changeAccountName",GliffyApp.authController.getAccountName());var a=this;this.theModal=$("#gliffy-account-modal");this.__enablePrimaryButtons();this.hideManageUsersErrorMessage();this.theModal.find(".gliffy-manage-users-add-textarea").val("");a.populate();a.setTab("#account-settings");$(".first-menu").addClass("open-pill-account");this.theModal.find(".cancel").click(function(){a.cancel()});this.theModal.modal("show");this.loadReasons();this.accountLoad()},setTab:function(a){if(!$(a).length){this.__tabIdToOpenOnLoad=a}else{this.__tabIdToOpenOnLoad=null}this.ga("modalNav",a);$(".open-pill-account").removeClass("open-pill-account");$("#gliffy-account-modal .contentbox div").removeClass("open-content-account");$("#gliffy-account-modal .contentbox "+a).addClass("open-content-account");$("#gliffy-account-modal .menubox li."+a.substring(1)+" a").addClass("open-pill-account");if(!this.theModal.find(".gliffy-btn-primary").attr("disabled")){this.theModal.find(".gliffy-save-spinner").hide()}},cancel:function(){this.ga("closeModal","cancel");$("#gliffy-account-modal").modal("hide");$("#gliffy-account-modal .cancel").unbind("click")},loadUsers:function(){var a=this;this.__showUserListUIBlocker();GLIFFY.API.GET("account/users.json",{query:{accountId:GliffyApp.authController.getAccountId()},success:function(c,e,b){a.set("accountMaxUsers",c.max_users);var d=c.max_users-c.users.length;if(d<0){d=0}a.set("remainingUsers",d);a.notifyPropertyChange("remainingUsers");a.populateUsers(c);a.__hideUserListUIBlocker()}})},populateUsers:function(a){var c=this;c.set("accountUsers",Ember.A([]));c.set("accountUserNumber",a.users.length);for(var d=0;d<a.users.length;d++){var b=GliffyApp.AccountUser.create({userId:a.users[d].user_id,email:a.users[d].email,lastToken:a.users[d].last_token,userRole:a.users[d].user_role});c.accountUsers.pushObject(b)}},numberUsersLabel:Ember.computed(function(){return(this.get("accountUserNumber")==1)?"One User":this.get("accountUserNumber")+" users"}).property("accountUserNumber"),removeUser:function(b){var a=this;$("#gliffy-account-modal").modal("hide");GLIFFY.Dialog.showYesNoDialog({title:$.i18n._("online.account.user.remove.title"),content:$.i18n._("online.account.user.remove.confirm",[b.email]),cancelCallback:null,buttons:[{text:$.i18n._("online.modal.cancel"),callback:function(c){$("#gliffy-account-modal").modal("show")},primary:false,dismiss:true},{text:$.i18n._("online.modal.remove"),callback:function(c){$("#gliffy-account-modal").modal("show");a.__removeUser(b)},primary:true,dismiss:true}]})},__removeUser:function(b){var a=this;this.__showUserListUIBlocker();window.GLIFFY.API.DELETE("account/user",{query:{userId:b.userId,accountId:GliffyApp.authController.getAccountId()},success:function(d,e,c){a.accountUsers.removeObject(b);a.set("remainingUsers",a.get("remainingUsers")+1);a.__hideUserListUIBlocker();GLIFFY.Utils.analyticsEvent("trackEvent",{category:"accountManage",action:"removeUser"})},error:function(e,c,d){a.displayManageUsersErrorMessage("Failed to remove user. "+d);a.__hideUserListUIBlocker();console.error("error removing user",e,c,d)},context:this})},addUsers:function(){var j=this,f=[],b=[],g=GliffyApp.authController.getAccountMaxUsers(),a=this.accountUsers.length,h,c=this.theModal.find(".gliffy-manage-users-add-textarea").val(),d,e;c=c.split(" ").join("");c=c.split("\r").join("");c=c.split("\n").join("");if(this.__validateEmailList(c)){h=c.split(",");for(e=0;e<h.length;e++){if(a>=g){b[b.length]=h[e]}else{d=GliffyApp.AccountUser.create();d.set("email",h[e]);d.set("userRole","USER");f[f.length]=d}a++}this.__disablePrimaryButtons();this.__persistUserList(f,function(){j.loadUsers();if(b.length>0){j.theModal.find(".gliffy-manage-users-add-textarea").val(b.join(", "))}else{j.theModal.find(".gliffy-manage-users-add-textarea").val("")}j.displayManageUsersSuccessMessage("Users added to account",5000);GLIFFY.Utils.analyticsEvent("trackEvent",{category:"manageUsers",action:"addUsers",value:a})},function(){j.displayManageUsersErrorMessage("unable to add users",error);console.error("unable to add users, failure",xhr,error)})}},updateUserAdminStatus:function(b,c){var a=this;this.__showUserListUIBlocker();if(c){b.set("userRole",this.USER_ROLE_ADMIN)}else{b.set("userRole",this.USER_ROLE_USER)}this.__persistUserList(null,function(){a.__hideUserListUIBlocker();GLIFFY.Utils.analyticsEvent("trackEvent",{category:"accountManage",action:"makeUserAdmin",label:c});a.loadUsers()},function(){a.__hideUserListUIBlocker();a.displayManageUsersErrorMessage("unable to update admin status",error);console.error("unable to update admin status",xhr,error);a.loadUsers()})},clearPassForm:function(){this.set("oldPassword",null);this.set("password1",null);this.set("password2",null)},hidePIAlerts:function(){this.set("showErrors",false);this.set("showEmailErrors",false);this.set("infoUpdateSuccess",false);this.set("showAccountNameErrors",false);this.set("emailUpdateSuccess",false);this.set("accountNameUpdateSuccess",false)},clearErrors:function(){this.set("errorMessages",Ember.A([]));this.set("emailErrorMessages",Ember.A([]))},displayManageUsersErrorMessage:function(a){var b=this.theModal.find(".gliffy-manage-users-error");b.removeClass("alert-success").addClass("alert-error").find("span").html(a);b.show()},displayManageUsersSuccessMessage:function(a,c){var b=this.theModal.find(".gliffy-manage-users-error");b.removeClass("alert-error").addClass("alert-success").find("span").html(a);b.show();if(c){setTimeout(function(){b.fadeOut(1000)},c)}},hideManageUsersErrorMessage:function(){this.theModal.find(".gliffy-manage-users-error").hide()},__persistUserList:function(b,a,d){var c=this;if(b===null){b={users:[]}}window.GLIFFY.API.PUT("account/users.json",{master:this.getAccountUsersAsJson(this.accountUsers).users,"new":this.getAccountUsersAsJson(b).users},{query:{accountId:GliffyApp.authController.getAccountId(),app:GLIFFY.ENV.app},success:function(e){c.__enablePrimaryButtons();a()},error:function(g,f,e){c.__enablePrimaryButtons();d()},context:this})},__hideUserListUIBlocker:function(){$("#gliffy-account-users .gliffy-processing-list-ui-blocker").hide()},__showUserListUIBlocker:function(){$("#gliffy-account-users .gliffy-processing-list-ui-blocker").show()},__disablePrimaryButtons:function(){this.theModal.find(".gliffy-btn-primary").attr("disabled",true);this.theModal.find(".gliffy-save-spinner").show()},__enablePrimaryButtons:function(){this.theModal.find(".gliffy-btn-primary").attr("disabled",false);this.theModal.find(".gliffy-save-spinner").hide()},__validateEmailList:function(c){var a,b;if(c===""){return false}b=c.split(",");for(a=0;a<b.length;a++){if(!window.GLIFFY.onlineUtils.isValidEmail(b[a])){this.displayManageUsersErrorMessage(b[a]+" is an invalid email");GLIFFY.Utils.analyticsEvent("trackEvent",{category:"accountManage",action:"addUsersInvalid",label:b[a]});return false}}return true},getAccountUsersAsJson:function(d){var c,b={},a=[];if(d){for(c=0;c<d.length;c++){a[a.length]=d[c].toJSON()}}b.users=a;return b},loadReasons:function(){var a=this;GLIFFY.API.GET("account/reasons.json",{success:function(c,d,b){a.populateReasons(c)}})},populateReasons:function(c){var a=this;a.set("cancelReasons",Ember.A([]));for(var b=0;b<c.reasons.length;b++){var d=GliffyApp.CancelReason.create({label:c.reasons[b].label,id:c.reasons[b].id});a.cancelReasons.pushObject(d)}},loadHistory:function(){var a=this;GLIFFY.API.GET("account/history.json",{query:{accountId:GliffyApp.authController.getAccountId()},success:function(c,d,b){a.populateHistory(c)}})},populateHistory:function(d){var a=this;a.set("accountHistory",Ember.A([]));for(var c=0;c<d.transactions.length;c++){var b=GliffyApp.TransactionHistory.create({id:d.transactions[c].id,payment:d.transactions[c].payment,paymentCurrency:d.transactions[c].payment_currency,status:d.transactions[c].status,transactionDate:d.transactions[c].transaction_date,transactionId:d.transactions[c].transaction_id,isPaymentJournalEntry:d.transactions[c].isPaymentJournalEntry});a.accountHistory.pushObject(b)}}});GliffyApp.AccountUser=Ember.Object.extend({userId:0,email:null,lastToken:null,userRole:null,isChecked:false,toJSON:function(){return{id:this.get("userId"),email:this.get("email"),user_role:this.get("userRole"),last_token:this.get("lastToken")}},notCurrentUser:Ember.computed(function(){return(Number(this.get("userId"))!==GliffyApp.authController.getUserID())}).property("userId"),isAdmin:Ember.computed(function(){return this.get("userRole")==="ADMIN"}).property("userRole"),canRemove:Ember.computed(function(){return(Number(this.get("userId"))!==GliffyApp.authController.getUserID())}).property("userRole")});GliffyApp.CancelReason=Ember.Object.extend({label:null,id:null});GliffyApp.TransactionHistory=Ember.Object.extend({id:null,payment:null,paymentCurrency:null,status:null,transactionDate:null,transactionId:null,isPaymentJournalEntry:null,showInvoiceBtn:Ember.computed(function(){if(this.get("status")==="processed"){return true}else{return false}}).property("status")});GliffyApp.errorMsg=Ember.Object.extend({key:null,message:null});GliffyApp.accountManageController=GliffyApp.AccountManageController.create()}());(function(){GliffyApp.tempPasswordController=Ember.Object.create({init:function(){},show:function(a){$("#gliffy-temp-password-modal").modal({show:true,keyboard:false,backdrop:"static"}).bind("hidden.gliffy",function(){$("#gliffy-temp-password-modal").unbind("hidden.gliffy");if(a){a()}})},hide:function(){$("#gliffy-temp-password-modal").modal("hide")}})}());(function(){GliffyApp.VerifyEmailController=GliffyApp.AbstractModalController.extend({init:function(){this.__resumingModal=GliffyApp.ResumingModalController.create({modalSelector:"#gliffy-verify-email-modal"})},actions:{verifyEmailSubmit:function(){this.verifyEmail($("#gliffy-verify-email-modal input").val())},resendLinkClick:function(){this.resendVerifyEmail()},closeAlert:function(){$("#gliffy-verify-email-modal .alert-floating").hide()}},show:function(b,a){this.__resumingModal.show(b,a);$("#gliffy-verify-email-modal .alert-floating").hide();$("#gliffy-verify-email-modal input").focus();$("#gliffy-verify-email-modal input").val("");this.__enablePrimaryButtons();this.theModal=this.__resumingModal.getModal();this.setSize(600,320)},verifyEmail:function(b){var a=this;this.__disablePrimaryButtons();window.GLIFFY.API.PUT("user/verifyEmail",null,{query:{confCode:b},success:function(c){GliffyApp.authController.setIsConfirmed(true);a.__resumingModal.resume()},error:function(e,d,c){a.__displayErrorMessage(a.EMAIL_VERIFY_STATE,"Failed to verify email with confirmation code. Please enter a valid confirmation code.");a.__enablePrimaryButtons()},context:this})},resendVerifyEmail:function(){var a=this;window.GLIFFY.API.GET("user/resendVerification",{query:{app:GLIFFY.ENV.app},success:function(c,d,b){a.__displaySuccessMessage(a.EMAIL_VERIFY_STATE,"Verification email sent to "+c+".")},error:function(d,b,c){a.__displayErrorMessage(a.EMAIL_VERIFY_STATE,"Failed to send verification email.");console.error("error loading collaborator list",d,b,c)},context:this})},__disablePrimaryButtons:function(){this.__resumingModal.getModal().find(".gliffy-btn-primary").attr("disabled",true);this.__resumingModal.getModal().find(".gliffy-save-spinner").show()},__enablePrimaryButtons:function(){this.__resumingModal.getModal().find(".gliffy-btn-primary").attr("disabled",false);this.__resumingModal.getModal().find(".gliffy-save-spinner").hide()},__displaySuccessMessage:function(b,a){var c=this.__resumingModal.getModal().find(".alert-floating");c.removeClass("alert-error").addClass("alert-success").find("span").html(a);c.show()},__displayErrorMessage:function(b,a){var c=this.__resumingModal.getModal().find(".alert-floating");c.removeClass("alert-success").addClass("alert-error").find("span").html(a);c.show()}});GliffyApp.verifyEmailController=GliffyApp.VerifyEmailController.create()}());(function(){GliffyApp.AccountSwitchController=Ember.ArrayController.extend({accountList:[],currentAccount:null,init:function(){this.set("accountList",Ember.A([]))},actions:{switchAccounts:function(){this.show()}},show:function(){var a=this;$("#setAsDefault").attr("checked",false);GliffyApp.authController.fetchUser(function(){a.populate();a.theModal=$("#gliffy-account-switch-modal");a.theModal.modal("show")})},showSwitcher:Ember.computed(function(){if(this.get("accountList").length>1){return true}else{return false}}).property(),populate:function(){this.set("accountList",Ember.A([]));this.set("accountList",GliffyApp.authController.getSwitchableAccounts());this.set("currentAccount",GliffyApp.authController.getCurrentUserAccount());GliffyApp.currentAccountSelect.set("selectedAccount",GliffyApp.authController.getCurrentUserAccount())},submitSwitch:function(){$(window).unbind("focus",GliffyApp.documentManagerController.handleRefocus);var b=this;var a=GliffyApp.currentAccountSelect.get("selectedAccount").get("accountId");var c=$("#setAsDefault").prop("checked");if(c){b.setDefaultAccount(a,function(){b.setDefaultAccountId(a)})}else{b.setDefaultAccountId(a)}GLIFFY.Utils.analyticsEvent("trackEvent",{category:"accounts",action:"switchAccount",label:c});b.theModal.modal("hide");$(window).bind("focus",GliffyApp.documentManagerController.handleRefocus)},setDefaultAccountId:function(a){var b=function(){GliffyApp.documentManagerController.configAccountFolders()};GliffyApp.authController.setAccountId(a,b);GliffyApp.documentManagerController.configAccountFolders();GliffyApp.authController.expirationTest();self.theModal=$("#gliffy-account-switch-modal");self.theModal.modal("hide")},setDefaultAccount:function(b,a){if(b!==0){GLIFFY.API.GET("user/setDefaultAccount",{query:{accountId:b},success:function(){a()},error:function(){alert("An error has occurred!")}})}},cancel:function(){self.theModal=$("#gliffy-account-switch-modal");self.theModal.modal("hide")}});GliffyApp.currentAccountSelect=Ember.Object.create({selectedAccount:null});GliffyApp.accountSwitchController=GliffyApp.AccountSwitchController.create()}());(function(){GliffyApp.FolderPermissionsModalController=GliffyApp.AbstractModalController.extend({folderName:null,folderId:null,usersWithAccess:null,usersWithoutAccess:null,accountUsers:null,userToAddList:null,userToRemoveList:null,init:function(){this.usersWithAccess=Ember.A([]);this.usersWithoutAccess=Ember.A([]);this.userToAddList=[];this.userToRemoveList=[];this.accountUsers=[]},actions:{accountUsersLinkClick:function(){this.openAccountUsers()},leftArrowClick:function(){this.handleLeftArrowClick()},rightArrowClick:function(){this.handleRightArrowClick()},submit:function(){this.updateUsers()},closeAlert:function(){$("#gliffy-folder-permissions-modal .alert-floating").hide()},handleWithAccessListClick:function(a){var b,c=$("#gliffy-folder-permissions-modal .gliffy-folder-permissions-access-list ."+a.uid);if(!a.isAdmin){if(c.hasClass("selected")){c.removeClass("selected");b=$.inArray(a,this.userToRemoveList);if(b>-1){this.userToRemoveList.splice(b,1)}}else{c.addClass("selected");if(this.userToRemoveList.indexOf(a)===-1){this.userToRemoveList[this.userToRemoveList.length]=a}}}},handleWithoutAccessUserClicked:function(a){var b,c=$("#gliffy-folder-permissions-modal .gliffy-folder-permissions-no-access-list ."+a.uid);if(c.hasClass("selected")){c.removeClass("selected");b=$.inArray(a,this.userToAddList);if(b>-1){this.userToAddList.splice(b,1)}}else{c.addClass("selected");if(this.userToAddList.indexOf(a)===-1){this.userToAddList[this.userToAddList.length]=a}}}},show:function(a,b){this.theModal=$("#gliffy-folder-permissions-modal");this.reset();this.theModal.modal("show");this.set("folderName",b);this.set("folderId",a);this.__loadAccountUsers()},reset:function(){this.usersWithAccess.clear();this.usersWithoutAccess.clear();this.userToAddList=[];this.userToRemoveList=[];this.accountUsers=[];this.theModal.find(".gliffy-folder-permissions-access-list div").removeClass("selected");this.theModal.find(".gliffy-folder-permissions-no-access-list div").removeClass("selected");this.theModal.find(".alert-floating").hide()},handleWithoutAccessUserClicked:function(c,a){var b;if(c.hasClass("selected")){c.removeClass("selected");b=$.inArray(a,this.userToAddList);if(b>-1){this.userToAddList.splice(b,1)}}else{c.addClass("selected");if(this.userToAddList.indexOf(a)===-1){this.userToAddList[this.userToAddList.length]=a}}},handleLeftArrowClick:function(){for(var a=0;a<this.userToAddList.length;a++){this.usersWithoutAccess.removeObject(this.userToAddList[a])}this.usersWithAccess.pushObjects(this.userToAddList);GLIFFY.Utils.analyticsEvent("trackEvent",{category:"folderPermissions",action:"addingUsers",value:this.userToAddList.length});this.userToAddList=[]},openAccountUsers:function(){this.hide();GliffyApp.accountManageController.show();GliffyApp.accountManageController.setTab("#gliffy-account-users");GLIFFY.Utils.analyticsEvent("trackEvent",{category:"folderPermissions",action:"addUsersLinkClick"})},updateUsers:function(){var a=this;this.showUIBlocker();window.GLIFFY.API.PUT("folder/"+this.folderId+"/users.json",this.__getJSONForUsersWithAccess(),{query:{},success:function(b){a.hideUIBlocker();a.hide()},error:function(d,c,b){a.hideUIBlocker();a.__displayErrorMessage("Failed to save folder users: "+b);console.error("error saving folder users",d,status,b)},context:this})},handleRightArrowClick:function(){for(var a=0;a<this.userToRemoveList.length;a++){this.usersWithAccess.removeObject(this.userToRemoveList[a])}this.usersWithoutAccess.pushObjects(this.userToRemoveList);GLIFFY.Utils.analyticsEvent("trackEvent",{category:"folderPermissions",action:"removingUsers",value:this.userToRemoveList.length});this.userToRemoveList=[]},__loadAccountUsers:function(){var a=this;this.showUIBlocker();GLIFFY.API.GET("account/users.json",{query:{accountId:GliffyApp.authController.getAccountId()},success:function(c,d,b){this.accountUsers=c.users;a.__loadFolderUsers()},error:function(d,c,b){a.hideUIBlocker();a.__displayErrorMessage("Failed to load account users: "+b);console.error("error loading account users",d,status,b)},context:this})},__loadFolderUsers:function(){var a=this;this.showUIBlocker();GLIFFY.API.GET("folder/"+this.folderId+"/users.json",{query:{},success:function(c,d,b){a.__populateUserAccessLists(c.users);a.hideUIBlocker()},error:function(d,c,b){a.hideUIBlocker();a.__displayErrorMessage("Failed to load folder users: "+b);console.error("error loading folder users",d,status,b)},context:this})},__populateUserAccessLists:function(f){var c,b,a,d=false,e=[];for(b=0;b<f.length;b++){e[e.length]=f[b].email}for(c=0;c<this.accountUsers.length;c++){a=Ember.Object.create({uid:this.accountUsers[c].user_id,email:this.accountUsers[c].email,isAdmin:(this.accountUsers[c].user_role==="ADMIN")});if(e.indexOf(this.accountUsers[c].email)>-1){this.usersWithAccess.pushObject(a)}else{this.usersWithoutAccess.pushObject(a)}}},__getJSONForUsersWithAccess:function(){var b,a={users:[]};for(b=0;b<this.usersWithAccess.length;b++){a.users[a.users.length]={id:this.usersWithAccess[b].uid}}return a}});GliffyApp.folderPermissionsModalController=GliffyApp.FolderPermissionsModalController.create()}());(function(){GliffyApp.BannerController=Ember.ObjectController.extend({integrations:null,init:function(){this.integrations=Ember.A([{display1:"Confluence",display2:"Plugin",url:"https://www.gliffy.com/products/confluence-plugin/?utm_source=gliffyonline_editor&utm_medium=bannerad&utm_term=confluence&utm_campaign=editorad"},{display1:"Chrome",display2:"App",url:"https://chrome.google.com/webstore/detail/gliffy-diagrams/bhmicilclplefnflapjmnngmkkkkpfad"},{display1:"Google",display2:"Apps",url:"https://www.google.com/enterprise/marketplace/viewListing?productListingId=5534+8831970581056655981&pli=1"},{display1:"Google Docs",display2:"Add-on",url:"https://chrome.google.com/webstore/detail/gliffy-diagrams/dajfclncmimpnbpagicmlglpbpamaabo?authuser=0&utm_source=Gliffy%20Customers&utm_campaign=c3cd2e4381-Google_Docs_Add_on_Announcement3_10_2014&utm_medium=editorad"},{display1:"Microsoft",display2:"App",url:"http://office.microsoft.com/en-us/store/gliffy-diagrams-WA103795937.aspx"}])},actions:{handleSignupClick:function(){GliffyApp.loginSignupController.show();GLIFFY.Utils.analyticsEvent("trackEvent",{category:"bannerAd",action:"signUpClick"})},handleIntegrationClick:function(a){window.open(a);GLIFFY.Utils.analyticsEvent("trackEvent",{category:"bannerAd",action:"integrationClick",label:a})},handleUpgradeClick:function(){GliffyApp.accountManageController.loadUsers();GliffyApp.accountUpgradePurchaseController.show();GLIFFY.Utils.analyticsEvent("trackEvent",{category:"bannerAd",action:"upgradeClick",label:window.location.pathname})},handleFeedbackClick:function(){GliffyApp.feedbackController.show();GLIFFY.Utils.analyticsEvent("trackEvent",{category:"bannerAd",action:"betaFeedback"})},handleCloseClick:function(){if(GLIFFY.editor){this.$(".standard-account").hide();GLIFFY.editor.updateContainerSize()}else{$("html").removeClass("gliffy-banner")}GLIFFY.Utils.analyticsEvent("trackEvent",{category:"bannerAd",action:"close"});return false}}});GliffyApp.bannerController=GliffyApp.BannerController.create()}());(function(){GliffyApp.AccountUpgradePurchaseController=Ember.ObjectController.extend({show:function(){if(window.GLIFFY.ENV.location=="DOCUMENT_MANAGER"){GliffyApp.accountManageController.show();GliffyApp.accountManageController.showUpdate()}else{this.theModal=$("#gliffy-account-upgrade-modal");this.theModal.find(".cancel").click(function(){self.cancel()});GLIFFY.Utils.analyticsEvent("trackEvent",{category:"/event/gliffy/upgrade",action:"viewUpgradeDialog"});this.theModal.modal("show")}}});GliffyApp.accountUpgradePurchaseController=GliffyApp.AccountUpgradePurchaseController.create()}());(function(){GliffyApp.FeedbackController=Ember.ObjectController.extend({init:function(){},actions:{send:function(){this.send()}},show:function(){$("#gliffy-feedback-modal").modal("show");$("#gliffy-feedback-modal input[name='fullname']").val("");if(GliffyApp.authController.isAuthenticated()){$("#gliffy-feedback-modal input[name='email']").val(GliffyApp.authController.getUsername());$("#gliffy-feedback-modal input[name='email']").attr("readonly","readonly")}else{$("#gliffy-feedback-modal input[name='email']").val("")}$("#gliffy-feedback-modal textarea").val("");$("#gliffy-feedback-modal input[name='performance']").attr("checked",false);$("#gliffy-feedback-modal input[name='design']").attr("checked",false);setTimeout(function(){$("#gliffy-feedback-modal input[name='fullname']").focus()},100)},hide:function(){$("#gliffy-feedback-modal").modal("hide")},send:function(){var i,j,a,h,f,c,d,k=$("#gliffy-feedback-modal input[name='fullname']").val(),g=$("#gliffy-feedback-modal input[name='email']").val(),e;a=$("#gliffy-feedback-modal textarea").val();if(k===""){k="N/A"}if(g===""){g="N/A"}i=a.substring(0,50);c=$("#gliffy-feedback-modal input[name='performance']:checked").val();d=$("#gliffy-feedback-modal input[name='design']:checked").val();h=GliffyApp.authController.getAccountId();f=GliffyApp.authController.getUserID();j="*Feedback:*\n"+a+"\n\n*"+$(".gliffy-feedback-performance-label").html()+":* "+c+"\n\n*"+$(".gliffy-feedback-design-label").html()+":* "+d+"\n\n*UID:* "+GliffyApp.authController.getUserID()+"\n\n*Account ID:* "+GliffyApp.authController.getAccountId();var b=this.uaMatch(window.navigator.userAgent);e="*Location*: "+window.location.href+"\n *Browser*: "+b.browser+" "+b.version+"\n *Platform*: "+window.navigator.platform+"\n *Screen Resolution*: "+screen.width+" X "+screen.height+"\n *User-Agent*: "+window.navigator.userAgent+"\n";$.post("/go/api/user/sendFeedback",{fullname:k,email:g,summary:i,description:j,webInfo:e,feedback:a,accountId:h,userId:f,performanceRating:c,designRating:d});GLIFFY.Utils.analyticsEvent("trackEvent",{category:"feedbackClick",action:"submit"});this.hide();GLIFFY.Utils.notify("success",$.i18n._("FEEDBACK_THANKS"),$.i18n._("FEEDBACK_APPRECIATION"),4000,$(window).width()/2-125,null)},uaMatch:function(b){b=b.toLowerCase();var a=/(chrome)[ \/]([\w.]+)/.exec(b)||/(webkit)[ \/]([\w.]+)/.exec(b)||/(opera)(?:.*version|)[ \/]([\w.]+)/.exec(b)||/(msie) ([\w.]+)/.exec(b)||b.indexOf("compatible")<0&&/(mozilla)(?:.*? rv:([\w.]+)|)/.exec(b)||[];return{browser:a[1]||"",version:a[2]||"0"}}});GliffyApp.feedbackController=GliffyApp.FeedbackController.create()}());(function(){GliffyApp.GoogleDriveController=Ember.ObjectController.extend({init:function(){},actions:{googleDriveHome:function(){GLIFFY.Utils.analyticsEvent("trackEvent",{category:"menuClick",action:"googleDrive"});window.open("/go/gdrive/installOrLaunchDrive?app="+window.GLIFFY.ENV.app,"googleDriveManager")}},setMenu:function(){if(!window.GLIFFY.ENV.googleDriveInstalled){$("#gliffy-mydocuments-googledrive a").text($.i18n._("online.menu.my.documents.install.google.drive"))}}});GliffyApp.googleDriveController=GliffyApp.GoogleDriveController.create()}());(function(){GliffyApp.ExpirationNoticeController=Ember.ObjectController.extend({expireUrl:"account/expire",freeSurveyComment:null,disableExpiration:false,actions:{goBasicSurveyPane:function(){GLIFFY.Utils.analyticsEvent("trackEvent",{category:"account",action:"expiration",label:"clickBasicSurvey"});this.showBasicSurveyPane()},goUpgradePane:function(){GLIFFY.Utils.analyticsEvent("trackEvent",{category:"account",action:"expiration",label:"clickUpgrade"});this.showUpgradePane()},goBasic:function(){GLIFFY.Utils.analyticsEvent("trackEvent",{category:"account",action:"expiration",label:"clickBasic"});if(!this.disableExpiration){this.expire();this.disableExpiration=true}},closeAlert:function(){this.theModal.find(".alert-floating").hide()}},show:function(){if(GliffyApp.authController.getAccountIsExpired()){$("#gliffy-modal-welcome-screen").modal("hide");$("#gliffy-expiration-modal").modal({keyboard:false,backdrop:"static",show:true})}else{this.hide()}},hide:function(){$("#gliffy-expiration-modal").modal("hide")},showBasicSurveyPane:function(){$(".exp_upgrade_pane").hide();$("#title_tagline").hide();$(".exp_free_survey_pane").show()},showUpgradePane:function(){$(".exp_upgrade_pane").show();$("#title_tagline").show();$(".exp_free_survey_pane").hide()},expire:function(){var a=this;a.theModal=$("#gliffy-expiration-modal");if($("#gliffy #gliffy-expiration-modal .exp_free_survey_pane #survey").is(":visible")&&!this.freeSurveyComment){$(".exp_free_survey_pane .alert span").html($.i18n._("online.free.survey.comment.required"));$(".exp_free_survey_pane .alert").show()}else{$.post("/go/api/user/sendFeedback",{email:GliffyApp.authController.getUsername(),description:"Expired Account Going To Basic",feedback:this.freeSurveyComment,accountId:GliffyApp.authController.getAccountId(),userId:GliffyApp.authController.getUserID(),dbOnly:"true"});window.GLIFFY.API.GET(a.get("expireUrl"),{query:{accountId:GliffyApp.authController.getAccountId()},success:function(c,d,b){this.theModal.modal("hide");GliffyApp.authController.fetchAccount()},error:function(d,b,c){alert("I am sorry, you do not have authorization to perform this operation. Please contact support <support@gliffy.com> if you believe you have received this notice in error.")},context:this})}}});GliffyApp.expirationNoticeController=GliffyApp.ExpirationNoticeController.create()}());(function(){GliffyApp.SuspendedNoticeController=Ember.ObjectController.extend({expireUrl:"/go/commerce/cancelsubscription",freeSurveyComment:null,accountSuspendToPurchaseUrl:"/go/commerce/purchase",actions:{goBasic:function(){GLIFFY.Utils.analyticsEvent("trackEvent",{category:"account",action:"expiration",label:"clickBasic"});this.expire()},accountSuspendToPurchase:function(){GLIFFY.Utils.analyticsEvent("trackEvent",{category:"account",action:"suspension",label:"ccUpdateClick"});var a=this;window.open(a.get("accountSuspendToPurchaseUrl"))}},show:function(){if(GliffyApp.authController.isSuspended()&&GliffyApp.authController.getAccountIsExpired()){$("#gliffy-modal-welcome-screen").modal("hide");$("#gliffy-suspended-modal").modal({keyboard:false,backdrop:"static",show:true});$("#gliffy-modal-welcome-screen").modal("hide")}else{$("#gliffy-suspended-modal").modal("hide")}},hide:function(){$("#gliffy-suspended-modal").modal("hide")},expire:function(){var a=this;a.theModal=$("#gliffy-suspended-modal");if($("#gliffy #gliffy-suspended-modal .exp_free_survey_pane #survey").is(":visible")&&!this.freeSurveyComment){$(".exp_free_survey_pane .alert span").html($.i18n._("online.free.survey.comment.required"));$(".exp_free_survey_pane .alert").show()}else{$.post("/go/api/user/sendFeedback",{email:GliffyApp.authController.getUsername(),description:"Expired Account Going To Basic",feedback:this.freeSurveyComment,accountId:GliffyApp.authController.getAccountId(),userId:GliffyApp.authController.getUserID(),dbOnly:"true"});$.post(a.get("expireUrl"),{accountId:GliffyApp.authController.getAccountId(),userId:GliffyApp.authController.getUserID(),reason_code:1}).done(function(){a.theModal.modal("hide");GliffyApp.authController.fetchAccount()}).fail(function(){alert($.i18n._("online.suspend.permission.denied.1")+" support@gliffy.com "+$.i18n._("online.suspend.permission.denied.2"))})}}});GliffyApp.suspendedNoticeController=GliffyApp.SuspendedNoticeController.create()}());(function(){GliffyApp.ApiEditorController=Ember.ObjectController.extend({returnToButtonText:Ember.computed(function(){return GLIFFY.ENV.returnButtonText}).property(),actions:{returnToUrlAction:function(){window.location.href=GLIFFY.ENV.returnUrl}}});GliffyApp.apiEditorController=GliffyApp.ApiEditorController.create()}());(function(){GliffyApp.HeaderView=Ember.View.extend({MSAppId:"d8e91192-2f34-471c-80a6-900880844ffd",appName:Ember.computed(function(){return GLIFFY.ENV.appName||"Gliffy Demo App"}).property(),isMSApp:Ember.computed(function(){return(GLIFFY.ENV.app==this.get("MSAppId"))}).property()})}());(function(){GliffyApp.FileOpenBrowserView=Ember.View.extend({didInsertElement:function(){$(".gliffy-file-open-browser .gliffy-document-list").bind("documentListItemOpen",function(b,a){GliffyApp.fileOpenBrowserController.open(a)});$(".gliffy-file-open-browser .gliffy-document-list").scroll(function(a){GliffyApp.fileOpenBrowserController.handleDocumentListScroll(a)});$(".gliffy-file-open-browser .gliffy-document-list").bind("scrollStart",function(a){GliffyApp.fileOpenBrowserController.handleDocumentListScrollStart(a)});$(".gliffy-file-open-browser .gliffy-document-list").bind("scrollEnd",function(a){GliffyApp.fileOpenBrowserController.handleDocumentListScrollEnd(a)});$(".gliffy-file-open-browser .gliffy-document-sort-dropdown").delegate("a","click",function(a){a.preventDefault();GliffyApp.fileOpenBrowserController.sortDocumentList($(a.currentTarget).data("gliffy-sort-key"),$(a.currentTarget).data("gliffy-sort-order"))});$(".gliffy-file-open-browser .gliffy-document-search a").on("click",function(a){GliffyApp.fileOpenBrowserController.search($(".gliffy-file-open-browser .gliffy-document-search input").attr("value"))});$(".gliffy-file-open-browser .gliffy-document-search input").on("keyup",function(a){if(a.keyCode===13){GliffyApp.fileOpenBrowserController.search($(".gliffy-file-open-browser .gliffy-document-search input").attr("value"))}});$(".gliffy-file-open-browser .gliffy-account-folders-container").bind("folderClicked",function(b,a){GliffyApp.fileOpenBrowserController.handleFolderClick(a)});$("#gliffy-modal-file-open-browser .close").tooltip(GLIFFY.Editor.TOOLTIP_OPTIONS_STANDARD);$(".gliffy-file-open-browser .gliffy-account-folders").scroll(function(a){GliffyApp.accountFoldersController.positionSelectionBar()});$(".gliffy-file-open-browser .gliffy-common-folder span").hover(function(){GliffyApp.accountFoldersController.hideHoverBar();$(this).parent().addClass("gliffy-folder-hovered")},function(){$(this).parent().removeClass("gliffy-folder-hovered")})}})}());(function(){GliffyApp.ShareMenuView=GliffyApp.AbstractMenuView.extend({sendMenuShareEventToOptimizely:function(){window.optimizely=(window.optimizely&&window.optimizely.push)?window.optimizely:[];var a=window.optimizely&&window.optimizely.GHAX&&window.optimizely.GHAX.shareButton;if(a){window.optimizely.push(["trackEvent","menuShareEvent"])}},didInsertElement:function(){var a=this;$(".gliffy-filemenu-publish").on("click",function(b){a.menuPublish(b)});$(".gliffy-filemenu-collaborate").on("click",function(b){a.menuCollaborate(b)})},menuPublish:function(a){if(!a.isTrigger){GLIFFY.Utils.analyticsEvent("trackEvent",{category:"menuClick",action:"publish"})}this.sendMenuShareEventToOptimizely();this.onMenuClick(a,"gliffy-toolbar-menu-file",false);window.GLIFFY.toolbarController.doPublish()},menuCollaborate:function(a){if(!a.isTrigger){GLIFFY.Utils.analyticsEvent("trackEvent",{category:"menuClick",action:"collaborate"})}this.sendMenuShareEventToOptimizely();this.onMenuClick(a,"gliffy-toolbar-menu-file",false);window.GLIFFY.toolbarController.doCollaborate()}})}());(function(){GliffyApp.WelcomeScreenView=Ember.View.extend({appName:"",didInsertElement:function(){$("#gliffy-modal-welcome-screen .close").tooltip(GLIFFY.Editor.TOOLTIP_OPTIONS_STANDARD);GliffyApp.welcomeScreenController.createFileUploadControls();this.set("appName",window.GLIFFY.ENV.appName)},willDestroyElement:function(){$(".gliffy-sidebar.scrollable").css("overflow-y","auto")},selectRecent:function(a){a.preventDefault();GliffyApp.welcomeScreenController.handleSelectRecentDiagram(a)},showTips:function(a){a.preventDefault();GliffyApp.welcomeScreenController.handleShowTips($(a.currentTarget))}});GliffyApp.WelcomeScreenTemplateView=Ember.View.extend({openTemplate:function(a){GliffyApp.welcomeScreenController.hide();a.preventDefault();GliffyApp.welcomeScreenController.handleOpenTemplate(a.context)}})}());(function(){GliffyApp.WelcomeScreenDocumentListItemView=Ember.View.extend({alreadyClicked:false,didInsertElement:function(a){$(".gliffy-document-list-item-tooltip").tooltip(GLIFFY.Editor.TOOLTIP_OPTIONS_STANDARD);$(".gliffy-welcome-screen-list-item").on("mouseenter",function(){$(this).css("background-color","#E9EEF4")});$(".gliffy-welcome-screen-list-item").on("mouseleave",function(){$(this).css("background-color","#FFFFFF")})},click:function(a){a.preventDefault();if(!this.alreadyClicked){this.alreadyClicked=true;GliffyApp.welcomeScreenController.handleSelectRecentDiagram(a,this)}}})}());(function(){GliffyApp.TemplateBrowserView=Ember.View.extend({didInsertElement:function(){var a=$(".gliffy-template-browser .gliffy-document-list");$(".gliffy-template-browser .gliffy-account-folders-container").bind("folderClicked",function(c,b){GliffyApp.templateBrowserController.handleFolderClick(b)});a.bind("documentListItemOpen",function(c,b){GliffyApp.templateBrowserController.openTemplate(b);if(GliffyApp.accountFoldersController.selectedItem.attr("showOnlyPublic")==="true"&&GliffyApp.accountFoldersController.rootFolderId===5000){GLIFFY.Utils.analyticsEvent("trackEvent",{category:"templateManager",action:"openGliffyTemplate",label:GliffyApp.accountFoldersController.getSelectedFolderTitle()+"/"+b.name})}else{GLIFFY.Utils.analyticsEvent("trackEvent",{category:"templateManager",action:"openAccountTemplate"})}});a.scroll(function(b){GliffyApp.templateBrowserController.handleDocumentListScroll(b)});a.bind("scrollStart",function(b){GliffyApp.templateBrowserController.handleDocumentListScrollStart(b)});a.bind("scrollEnd",function(b){GliffyApp.templateBrowserController.handleDocumentListScrollEnd(b)});$("#gliffy-modal-template-browser .close").tooltip(GLIFFY.Editor.TOOLTIP_OPTIONS_STANDARD);$(".gliffy-template-browser .gliffy-account-folders").scroll(function(b){GliffyApp.accountFoldersController.positionSelectionBar()});$("#gliffy-modal-template-browser a[data-dismiss='modal']").on("click",function(){GLIFFY.Utils.analyticsEvent("trackEvent",{category:"templateManager",action:"closeOrCancel"})})}})}());(function(){GliffyApp.AccountFoldersView=Ember.View.extend({didInsertElement:function(){$(".gliffy-common-folders-container .recent").on("click",function(a){GliffyApp.accountFoldersController.handleCommonFolderClick(a,GliffyApp.accountFoldersController.RECENT_FOLDER_ID)});$(".gliffy-common-folders-container .starred").on("click",function(a){GliffyApp.accountFoldersController.handleCommonFolderClick(a,GliffyApp.accountFoldersController.STARRED_FOLDER_ID);GLIFFY.Utils.analyticsEvent("trackEvent",{category:"accountFolders",action:"starredFolderClick",label:window.location.pathname})});$(".gliffy-common-folders-container .shared").on("click",function(a){GliffyApp.accountFoldersController.handleCommonFolderClick(a,GliffyApp.accountFoldersController.SHARED_FOLDER_ID);GLIFFY.Utils.analyticsEvent("trackEvent",{category:"accountFolders",action:"sharedFolderClick",label:window.location.pathname})})}})}());(function(){var a=true;GliffyApp.DocumentListItemView=Ember.View.extend({documentListItem:null,didInsertElement:function(f){var c=this,b,d;$(".gliffy-document-list-item-tooltip").tooltip(GLIFFY.Editor.TOOLTIP_OPTIONS_STANDARD);$(".gliffy-icon-star").tooltip(GLIFFY.Editor.TOOLTIP_OPTIONS_STANDARD);$(".gliffy-icon-star-off").tooltip(GLIFFY.Editor.TOOLTIP_OPTIONS_STANDARD);$(".gliffy-document-list-item-delete").tooltip(GLIFFY.Editor.TOOLTIP_OPTIONS_STANDARD);this.$().bind("dblclick",function(g){GliffyApp.documentListController.handleDoubleClickItem()});this.$().bind("mousedown",function(e){if(GliffyApp.accountFoldersController.getSelectedFolderType()===GliffyApp.accountFoldersController.GLIFFY_ONLINE_DIAGRAM_STORAGE_TYPE){c.mousedown(e)}});this.$().bind("mouseover",function(g){if($(g.currentTarget).hasClass("gliffy-grid-item")){if($(g.currentTarget).find(".gliffy-document-list-item-preview-container .gliffy-document-grid-item-preview-zoom").length===0){$(g.currentTarget).find(".gliffy-document-list-item-preview-container").append('<div class="gliffy-document-grid-item-preview-zoom"></div>');$(g.currentTarget).find(".gliffy-document-list-item-preview-container .gliffy-document-grid-item-preview-zoom").on("click",function(h){GliffyApp.documentListController.zoom(c.documentListItem)})}}else{if($(g.currentTarget).find(".gliffy-document-list-item-preview-container .gliffy-document-list-item-preview-zoom").length===0){$(g.currentTarget).find(".gliffy-document-list-item-preview-container").append('<div class="gliffy-document-list-item-preview-zoom"></div>');$(g.currentTarget).find(".gliffy-document-list-item-preview-container .gliffy-document-list-item-preview-zoom").on("click",function(h){GliffyApp.documentListController.zoom(c.documentListItem)})}}});this.$().bind("mouseout",function(g){d=$(g.currentTarget);setTimeout(function(){if(!d.is(":hover")){$(g.currentTarget).find(".gliffy-document-list-item-preview-container .gliffy-document-list-item-preview-zoom").remove();$(g.currentTarget).find(".gliffy-document-list-item-preview-container .gliffy-document-grid-item-preview-zoom").remove()}},50)});this.$(".favorite").bind("click",function(e){c.favorite(e)});this.$("img").bind("mousedown",function(e){if(GliffyApp.accountFoldersController.getSelectedFolderType()===GliffyApp.accountFoldersController.GLIFFY_ONLINE_DIAGRAM_STORAGE_TYPE&&GliffyApp.documentListController.isEditableItems){c.mousedown(e)}return false});$(".gliffy-document-list-container .gliffy-document-title").delegate("input","dblclick",function(g){return false});$(".gliffy-document-list-container .gliffy-document-title").delegate("input","focusout",function(g){GliffyApp.documentListController.handleRenameDocument(g.currentTarget.value)});this.$().find(".gliffy-document-title").css("max-width",GliffyApp.documentListController.getDocumentTitleMaxWidth())},mousedown:function(c){var b=this;if(!b.isRenameInputActive()){this.proxy=new GLIFFY.DragProxy(5,c.pageX,c.pageY);this.$().bind("mousemove.dragthreshold",function(d){b.startDrag(d)}).bind("mouseup.dragthreshold",function(d){b.endDrag(d)}).bind("mouseout.dragthreshold",function(d){b.endDrag(d)})}},isRenameInputActive:function(){return this.$().find(".gliffy-document-title input").is(":visible")},startDrag:function(d){var b=this,c;if(this.proxy.aboveThreshold(d.pageX,d.pageY)){this.click(d);$(d.currentTarget).unbind(".dragthreshold");this.proxy.setElement($("<div></div>").addClass("gliffy-document-proxy").html("<span class='dropping'><span class='gliffy-document-rename-spinner'></span></span><span class='dragging'>Move</span> <strong class='source'></strong> to <strong class='target'></strong><span class='no-target'>...</span>").appendTo("#gliffy"));this.proxy.getElement().children(".source").html(b.documentListItem.name);this.proxy.getElement().children(".dropping").hide();this.proxy.activate(function(e){b.drag(e)},function(f,e){b.drop(f,e)});this.proxy.move(d.pageX,d.pageY)}},endDrag:function(b){this.proxy=null;$(b.currentTarget).unbind(".dragthreshold")},drag:function(c){var b=GliffyApp.accountFoldersController.getFolderInfoAtPosition(c.pageX,c.pageY);$(".gliffy-dropzone").removeClass("gliffy-dropzone");if(b){$(b.element).addClass("gliffy-dropzone");this.proxy.getElement().children(".target").html(b.name);this.proxy.getElement().children(".no-target").hide()}else{this.proxy.getElement().children(".target").html("");this.proxy.getElement().children(".no-target").show()}return true},drop:function(g,d){var f=GliffyApp.accountFoldersController.getFolderInfoAtPosition(g.pageX,g.pageY),c=this.proxy,b=this,e;this.proxy=null;if(!f){$(".gliffy-dropzone").removeClass("gliffy-dropzone");d(false)}else{if(f.type===GliffyApp.accountFoldersController.GOOGLE_DRIVE_DIAGRAM_STORAGE_TYPE){$(".gliffy-dropzone").removeClass("gliffy-dropzone");d(false)}else{if(f.id===GliffyApp.accountFoldersController.getSelectedFolderId()){$(".gliffy-dropzone").removeClass("gliffy-dropzone");d(true)}else{c.getElement().children(".dropping").show();c.getElement().children(".dragging").hide();e=this.get("content");GLIFFY.API.POST("move_diagram.json",{diagramId:b.documentListItem.id,folderId:f.id},{success:function(h){if(h&&h.error){GliffyApp.documentListController.displayDocumentItemError(h.error);c.getElement().css({backgroundColor:"#ffbbaa"}).children(".dropping").hide();d(false)}else{c.getElement().css({backgroundColor:"#ccffdd"}).children(".dropping").hide();b.$().hide();GliffyApp.documentListController.removeSelectedDocumentItem();d(true);GLIFFY.Utils.analyticsEvent("trackEvent",{category:"documentManager",action:"moveDiagram",label:window.location.pathname})}$(".gliffy-dropzone").removeClass("gliffy-dropzone")},error:function(k,i,h){var j;if(i==="timeout"){j="This could not be moved to "+f.name+" because the server could not be reached. Please make sure that you are connected to the internet and try again."}else{if(i==="error"&&k.status===401){j="You do not have permissions to move this to "+f.name+"."}else{if(i==="error"&&k.status===404){j="The document or folder does not exist anymore."}else{j="This could not be moved to "+f.name+" because of an unknown error. Please contact support if this continues to happen."}}}GliffyApp.documentListController.displayDocumentItemError(j);$(".gliffy-dropzone").removeClass("gliffy-dropzone");c.getElement().css({backgroundColor:"#ffbbaa"}).children(".dropping").hide();d(false)}})}}}},click:function(b){b.preventDefault();if(!b.target.className.match(/\bclickable\b/)){GliffyApp.documentListController.handleSelectItem(b,this.documentListItem)}},handleDocumentCollaborate:function(b){b.preventDefault();GliffyApp.documentListController.handleDocumentCollaborate(b)},handleDocumentPublish:function(b){b.preventDefault();GliffyApp.documentListController.handleDocumentPublish(b)},favorite:function(b){b.preventDefault();GliffyApp.documentListController.handleSelectFavorite(b,this.documentListItem)},handleDocumentNameClick:function(b){b.preventDefault();GliffyApp.documentListController.handleDocumentNameClick(b,this.documentListItem)},handleInputKeyDown:function(b){if(b.keyCode===13){GliffyApp.documentListController.handleRenameDocument(b.currentTarget.value)}else{if(b.keyCode===27){GliffyApp.documentListController.hideRenameInput()}}}})}());(function(){GliffyApp.DocumentListView=Ember.View.extend({})}());(function(){GliffyApp.DocumentSearchView=Ember.View.extend({});GliffyApp.DocumentSearchTextField=Ember.TextField.extend({keyDown:function(a){if(a.keyCode===13){a.preventDefault();GliffyApp.documentSearchController.updateSearchValue(this.value)}},keyUp:function(a){GliffyApp.documentSearchController.updateSearchValue(a.currentTarget.value)}})}());(function(){GliffyApp.DocumentSortView=Ember.View.extend({})}());(function(){GliffyApp.FileMenuView=GliffyApp.FileMenuView.extend({menuRename:function(a){if(!a.isTrigger){GLIFFY.Utils.analyticsEvent("trackEvent",{category:"menuClick",action:"rename"})}this.onMenuClick(a,"gliffy-toolbar-menu-file",false);$("#gliffy-rename-document-modal .gliffy-input-modal-error").hide();$("#gliffy-rename-document-modal .modal").modal("show");$("#gliffy-rename-document-modal input").val(GliffyApp.documentModel.title);$("#gliffy-rename-document-modal input").select()},menuSaveAs:function(a){if(!a.isTrigger){GLIFFY.Utils.analyticsEvent("trackEvent",{category:"menuClick",action:"saveAs"})}this.onMenuClick(a,"gliffy-toolbar-menu-file",false);GliffyApp.saveDialogController.show();GliffyApp.saveDialogController.mode=GliffyApp.saveDialogController.DIALOG_MODE_SAVE_AS}})}());(function(){GliffyApp.FolderCreateModalView=GliffyApp.AbstractInputModalView.extend({didInsertElement:function(){var a=this;this.set("titleText",$.i18n._("online.folder.create.folder"));this.set("submitButtonText",$.i18n._("online.folder.create"));this.set("inputPlaceholderText",$.i18n._("online.folder.create.folder.untitled"));$("#gliffy-folder-rename-modal input").on("keydown",function(b){a.handleInputKeyDown(b)});$("#gliffy-folder-create-modal .gliffy-modal-footer .gliffy-btn-primary").on("click",function(b){a.handleSubmit(b)})},handleSubmit:function(a){this._super(a);GliffyApp.accountFoldersController.createFolder($("#gliffy-folder-create-modal input").val(),function(){$("#gliffy-folder-create-modal .gliffy-modal").modal("hide")})}})}());(function(){GliffyApp.RenameModalView=GliffyApp.AbstractInputModalView.extend({didInsertElement:function(){var a=this;this.set("titleText",$.i18n._("online.document.rename.diagram"));this.set("submitButtonText",$.i18n._("online.document.rename"));$("#gliffy-rename-document-modal .gliffy-btn-primary").on("click",function(b){a.handleSubmit(b)});$("#gliffy-rename-document-modal .gliffy-input-modal-input").on("keydown",function(b){a.handleInputKeyDown(b)})},handleSubmit:function(d){var b=this,c=$("#gliffy-rename-document-modal input").val(),a=GLIFFY.editor.getDocumentManager().getActiveDocument();this._super(d);if(GliffyApp.documentListController.validateDocumentName($("#gliffy-rename-document-modal input").val(),function(e){b.displayErrorMessage(e)})){GliffyApp.documentListController.renameDocument(GliffyApp.documentModel,c,function(e){if(e.error){b.displayErrorMessage(e.error)}else{a.setTitle(c);GliffyApp.documentModel.update(a);$("#gliffy-rename-document-modal .gliffy-modal").modal("hide")}},function(e){b.displayErrorMessage(e)})}}})}());(function(){GliffyApp.TagImageModalView=Ember.View.extend({didInsertElement:function(b){var a=this;$("#gliffy-modal-online-tag-image").on("hide",function(c){$(".gliffy-tag-name-error").hide()});$("#gliffy-modal-online-tag-image").on("show",function(c){$("#gliffy-image-tag-input").val("")});$("#gliffy-modal-online-tag-image").on("shown",function(c){$("#gliffy-image-tag-input").focus()});$("#gliffy-image-tag-input").on("keydown",function(c){a.handleInputKeyDown(c)})},handleInputKeyDown:function(a){if(a.keyCode===13){$("#gliffy-modal-online-tag-image .gliffy-modal-footer .gliffy-btn-primary").click()}}})}());(function(){GliffyApp.ImageSearchResultsModalView=Ember.View.extend({currentPageBinding:Ember.Binding.oneWay("GliffyApp.imageBrowserController.externalImageSearchPage"),currentPageHtml:Ember.computed(function(){var a=Number(this.get("currentPage"))*20;var b=a-20+1;return b+" of "+a}).property("currentPage").cacheable(),totalResultsBinding:Ember.Binding.oneWay("GliffyApp.imageBrowserController.externalImageSearchResults"),totalResultsHtml:Ember.computed(function(){if(this.get("totalResults")){return this.get("totalResults").toLocaleString()}else{return null}}).property("totalResults").cacheable(),imageSearchResultsSummaryMessage:Ember.computed(function(){return $.i18n._("online.image.search.results.instructions",[this.get("currentPageHtml"),this.get("totalResultsHtml")])}).property("currentPageHtml","totalResultsHtml"),didInsertElement:function(){$("#gliffy-modal-image-search-results .gliffy-pager-previous-btn").tooltip(GLIFFY.Editor.TOOLTIP_OPTIONS_STANDARD);$("#gliffy-modal-image-search-results .gliffy-pager-next-btn").tooltip(GLIFFY.Editor.TOOLTIP_OPTIONS_STANDARD);$("#gliffy-modal-image-search-results .gliffy-image-search-results").delegate(".gliffy-image-search-result img","click",function(a){GliffyApp.imageBrowserController.addExternalImage($(a.currentTarget).parent().data("params"))});$("#gliffy-modal-image-search-results .gliffy-image-search-results-body-top").on("keydown",function(a){if(a.keyCode===13){GliffyApp.imageBrowserController.doExternalImageSearch($("#gliffy-modal-image-search-results input").val())}})}})}());(function(){GliffyApp.LoginSignupModalView=Ember.View.extend({didInsertElement:function(h){var i,c,f,b=0;var j="#gliffy-signup-organization-size";var d=j+" ul";var a=j+" .dropdown-toggle";var g="#organizationSizeField";$.ajax({url:"/go/getOrganizationSizesJson",dataType:"json",success:function(e){i=e;_.each(i,function(k){$(d).append('<li><a href="#" data-index="'+b+'">'+k+"</a></li>");b++});$(d).on("click",function(k){k.preventDefault();c=$(k.target);FormHelpers.updateDropDown(a,c);FormHelpers.updateHiddenField(g,c)});if($(g).val()!=""){f=$(g).val();if(f!=""){$(d+" li a:contains('"+f+"')").click()}}}})}})}());(function(){GliffyApp.LoginView=Ember.View.extend({controller:null})}());(function(){GliffyApp.SignupView=Ember.View.extend({})}());(function(){GliffyApp.CollaborationModalView=Ember.View.extend({didInsertElement:function(b){var a=this;$("#gliffy-collaboration-modal .close").tooltip(GLIFFY.Editor.TOOLTIP_OPTIONS_STANDARD);$("#gliffy-collaboration-modal .gliffy-collaboration-state-email-verify input").on("keydown",function(c){a.handleConfirmCodeKeyDown(c)})},handleConfirmCodeKeyDown:function(a){if(a.keyCode===13){GliffyApp.collaborationController.verifyEmail($("#gliffy-collaboration-modal .gliffy-collaboration-state-email-verify input").val())}}})}());(function(){GliffyApp.UserListItemView=Ember.View.extend({})}());(function(){GliffyApp.CollaboratorListItemView=GliffyApp.UserListItemView.extend({})}());(function(){GliffyApp.PublishModalView=Ember.View.extend({didInsertElement:function(b){var a=this;GliffyApp.publishController.config();$("#gliffy-publish-modal .gliffy-icon-question").popover({placement:"right",trigger:"hover",delay:{show:650,hide:50}});$("#gliffy-publish-modal .close").tooltip(GLIFFY.Editor.TOOLTIP_OPTIONS_STANDARD);$("#gliffy-publish-modal .gliffy-publish-images-share li a").on("click",function(c){a.handleImageSizeSelect(c)})},handleImageSizeSelect:function(a){a.preventDefault();GliffyApp.publishController.handleImageSizeSelect($(a.currentTarget).html())},handleSocialClick:function(a){GliffyApp.publishController.handleSocialPublish($(a.currentTarget).data("gliffy-social"))}})}());(function(){GliffyApp.AccountManageModalView=Ember.View.extend({remainingUsersBinding:Ember.Binding.oneWay("GliffyApp.accountManageController.remainingUsers"),remainingDiagramsBinding:Ember.Binding.oneWay("GliffyApp.accountManageController.remainingDiagrams"),remainingUsersMessage:Ember.computed(function(){return $.i18n._("online.account.management.add.users.notice",[this.get("remainingUsers")])}).property("remainingUsers"),remainingDiagramsMessage:Ember.computed(function(){return $.i18n._("online.account.management.account.summary.warning",[this.get("remainingDiagrams")])}).property("remainingDiagrams")});GliffyApp.AccountUserList=Ember.View.extend({tagName:"tr"});GliffyApp.AccountErrorList=Ember.View.extend({tagName:"li"});GliffyApp.AccountMenuView=Ember.View.extend({tagName:"a",isSelected:false,click:function(){GliffyApp.accountManageController.setTab(this.href);GliffyApp.accountManageController.hidePIAlerts();this.$().addClass("open-pill-account")}});GliffyApp.AccountManagerButtonView=Ember.View.extend({classNames:["account-manage-btn"],showAccountModal:function(a){a.preventDefault();GliffyApp.accountManageController.show()},switchAccounts:function(a){a.preventDefault();GliffyApp.accountSwitchController.show()}})}());(function(){GliffyApp.TempPasswordView=Ember.View.extend({didInsertElement:function(){var a=this;$(".gliffy-reset-password-primary-button").on("click",function(b){a.handleResetPasswordClick(b)})},getPassword1:function(){return $("#gliffy-password1").val()},getPassword2:function(){return $("#gliffy-password2").val()},validate:function(){var b=this.getPassword1(),a=this.getPassword2();if(b.length===0){GLIFFY.onlineUtils.setModalErrorMessage("#gliffy-temp-password-modal","You need to enter in a new password.");return false}if(a.length===0){GLIFFY.onlineUtils.setModalErrorMessage("#gliffy-temp-password-modal","You need to confirm your new password.");return false}if(b!==a){GLIFFY.onlineUtils.setModalErrorMessage("#gliffy-temp-password-modal","Your passwords do not match.");return false}return true},handleResetPasswordClick:function(a){a.preventDefault();if(this.validate()){window.GLIFFY.API.POST("user/changePassword",{password1:this.getPassword1(),password2:this.getPassword2()},{success:function(c,d,b){if(c.errors&&c.errors.length>0){GLIFFY.onlineUtils.setModalErrorMessage("#gliffy-temp-password-modal",c.errors)}else{GliffyApp.tempPasswordController.hide()}},error:function(d,b,c){console.error("error logging in",d,b,c)},context:this})}}})}());(function(){GliffyApp.SaveModalView=Ember.View.extend({didInsertElement:function(){GliffyApp.saveDialogController.getModal().find("form").submit(function(a){a.preventDefault();GliffyApp.saveDialogController.applySave()});GliffyApp.saveDialogController.getModal().find(".gliffy-account-folders-container").bind("folderClicked",function(b,a){GliffyApp.saveDialogController.handleFolderClick(a)});GliffyApp.saveDialogController.getModal().find(".close").tooltip(GLIFFY.Editor.TOOLTIP_OPTIONS_STANDARD);$(".gliffy-save-modal .gliffy-account-folders").scroll(function(a){GliffyApp.accountFoldersController.scroll(a,this)})}})}());(function(){GliffyApp.VerifyEmailView=Ember.View.extend({didInsertElement:function(a){$("#gliffy-verify-email-modal .close").tooltip(GLIFFY.Editor.TOOLTIP_OPTIONS_STANDARD)}})}());(function(){GliffyApp.ManageUsersView=Ember.View.extend({listTitle:null,didInsertElement:function(a){this.set("listTitle",$.i18n._("online.account.current.users"));GliffyApp.accountManageController.addObserver("remainingUsers",function(){var b=(GliffyApp.accountManageController.get("remainingUsers")<=0);if(GliffyApp.accountManageController.theModal){GliffyApp.accountManageController.theModal.find(".gliffy-manage-users-add-textarea").attr("disabled",b);GliffyApp.accountManageController.theModal.find(".gliffy-manage-users-btns .gliffy-btn-primary").attr("disabled",b);if(b){GliffyApp.accountManageController.theModal.find(".gliffy-manage-users-btns .gliffy-btn-primary .gliffy-save-spinner").hide()}}})}})}());(function(){GliffyApp.AccountSwitchView=Ember.View.extend({})}());(function(){GliffyApp.FolderPermissionsModalView=Ember.View.extend({didInsertElement:function(){var a=this;$("#gliffy-folder-permissions-modal .close").tooltip(GLIFFY.Editor.TOOLTIP_OPTIONS_STANDARD)}})}());(function(){GliffyApp.BannerView=Ember.View.extend({didInsertElement:function(b){var a=this;$(this.element).show();if(GLIFFY.editor){GLIFFY.editor.updateContainerSize();this.addObserver("majorStatusChange",function(){a.rerender();GLIFFY.editor.updateContainerSize()})}else{$("html").addClass("gliffy-banner");this.addObserver("majorStatusChange",function(){if(GliffyApp.authController.isPremiumAccount()||GliffyApp.authController.isAnonymousAccount()){$("html").removeClass("gliffy-banner")}else{$("html").addClass("gliffy-banner")}})}}})}());(function(){GliffyApp.ModalAlertView=Ember.View.extend({didInsertElement:function(a){this.$().find("a.close").on("click",function(b){$(b.currentTarget).parent().hide()})}})}());(function(){GliffyApp.AccountUpgradePurchaseView=Ember.View.extend({});GliffyApp.AccountUpgradePurchaseModalView=Ember.View.extend({})}());(function(){GliffyApp.FeedbackModalView=Ember.View.extend({didInsertElement:function(){}})}());(function(){GliffyApp.expirationNoticeView=Ember.View.extend({commentPlaceholderMessage:Ember.computed(function(){return $.i18n._("online.free.survey.comment.placeholder")}).property()})}());(function(){GliffyApp.SuspendedNoticeView=Ember.View.extend({});GliffyApp.suspendedNoticeView=GliffyApp.SuspendedNoticeView.create()}());(function(){GliffyApp.ImageInfoView=Ember.View.extend({filenameBinding:Ember.Binding.oneWay("GliffyApp.ImageInfoModel.filename"),heightBinding:Ember.Binding.oneWay("GliffyApp.ImageInfoModel.height"),idBinding:Ember.Binding.oneWay("GliffyApp.ImageInfoModel.id"),imageBinding:Ember.Binding.oneWay("GliffyApp.ImageInfoModel.image"),sizeBinding:Ember.Binding.oneWay("GliffyApp.ImageInfoModel.size"),tagsBinding:Ember.Binding.oneWay("GliffyApp.ImageInfoModel.tags"),thumbnailBinding:Ember.Binding.oneWay("GliffyApp.ImageInfoModel.thumbnail"),tidBinding:Ember.Binding.oneWay("GliffyApp.ImageInfoModel.tid"),uidBinding:Ember.Binding.oneWay("GliffyApp.ImageInfoModel.uid"),urlBinding:Ember.Binding.oneWay("GliffyApp.ImageInfoModel.url"),useOriginalDimensionsBinding:Ember.Binding.oneWay("GliffyApp.ImageInfoModel.useOriginalDimensions"),widthBinding:Ember.Binding.oneWay("GliffyApp.ImageInfoModel.width")})}());(function(){GLIFFY.onlineUtils.postdecorate(GLIFFY.Renderer.ImageCanvas,"getUrl",function(b,a){var c=window.location.protocol+"//"+window.location.host;if(b&&b.indexOf(c)===0){return window.GLIFFY.API.getAuthUrl(b)}else{if(b==null){return window.GLIFFY.API.getAuthUrl("/go/assets/images/image_not_available.jpg")}else{return b}}})}());(function(){var a=0;function c(f){a=(new Date()).getTime();try{window.localStorage.setItem("clipboardtime",a);window.localStorage.setItem("clipboard",JSON.stringify({type:"local",data:f}))}catch(g){window.localStorage.removeItem("clipboard");$.ajax({url:GLIFFY.API.getAuthUrl("/go/clipboard/copy"),type:"POST",data:{data:JSON.stringify(f)},async:false,success:function(){window.localStorage.setItem("clipboardtime",a);window.localStorage.setItem("clipboard",JSON.stringify({type:"server",url:"/go/clipboard/copy"}))}})}}GLIFFY.onlineUtils.postdecorate(GLIFFY.CopyCommand,"execute",function(f,e){c(this.nodeObject)});GLIFFY.onlineUtils.postdecorate(GLIFFY.CutCommand,"execute",function(f,e){c(this.nodeObject)});GLIFFY.onlineUtils.override(GLIFFY.PasteCommand,"getNode",function(f,j){var g=new GLIFFY.Node(),i=f.commandHistory.getClipboard(),e=window.localStorage.getItem("clipboardtime"),h;if(e){e=parseInt(e)}else{e=0}if(e<=a&&i){g.fromObject(i.nodeObject);j(g)}else{h=JSON.parse(window.localStorage.getItem("clipboard"));if(h.type==="local"){g.fromObject(h.data);d(g,function(){j(g)})}else{if(h.type==="server"){$.ajax({url:GLIFFY.API.getAuthUrl(h.url),type:"GET",dataType:"json",async:false,success:function(k){a=(new Date()).getTime();g.fromObject(k);d(g,function(){j(g)})}})}}}});function d(h,g){var f=[],j=[],e,i;b([h],f,j);i=function(){g()};e=function(){GLIFFY.shapeLibrary.loadStencils(j).done(i)};g()}function b(e,j,l){var g,k,h,f;for(f=0;f<e.length;f++){h=e[f];if(h.isShape()){g=h.getUid();if($.inArray(g,j)===-1&&g){j.push(g)}if(h.getGraphic()){k=h.getGraphic().getTid();if($.inArray(k,l)===-1&&k){l.push(k)}}}if(h.children){b(h.children,j,l)}}}}());(function(){var b="/go/assets/images/loading.png",a=new Image();a.src=b;GLIFFY.UrlFileHandler=GLIFFY.DefaultFileHandler.extend({init:function(c){this.drawManager=c},handle:GLIFFY.onlineUtils.requireAccountPermission("storage",function(f,e){var d=this,g,c=GLIFFY.Mouse.getPosition(),h;if(e&&e>0){c.x+=e%5*OFFSET;c.y+=Math.floor(e/5)*OFFSET}g=new GLIFFY.Node();h={name:f.name,getImageUrl:function(i){GLIFFY.API.POST("upload_image_url.json",{url:f.url},{query:{accountId:GliffyApp.authController.getAccountId()},success:function(j){if(typeof(j)==="string"){j=JSON.parse(j)}i(GLIFFY.API.getAuthUrl(j.url));GliffyApp.imageBrowserController.loadImages("");GLIFFY.Utils.analyticsEvent("trackEvent",{category:"imageBrowser",action:"uploadImage",label:f.name.substring(f.name.lastIndexOf(".")+1)})},error:function(){i(null)}})},uid:"com.gliffy.shape.basic.basic_v1.default.image",tid:"com.gliffy.stencil.image",useOriginalDimensions:true};GLIFFY.Utils.analyticsEvent("trackEvent",{category:"browserDragAndDrop",action:"image"});d.drawManager.setupShape(g,h,c)}),canHandleFile:function(c){return c.type==="url"&&c.url!==null}})}());(function(){GLIFFY.UploadImageFileHandler=GLIFFY.DefaultFileHandler.extend({MAX_FILE_SIZE_BYTES:512000,init:function(a){this.drawManager=a},handle:GLIFFY.onlineUtils.requireAccountPermission("storage",function(f,e){var b=new window.FileReader(),a=GLIFFY.Mouse.getPosition(),d=this,g=100;if(a.x<0){a.x=100}if(a.y<0){a.y=100}if(e&&e>0){a.x+=e%5*g;a.y+=Math.floor(e/5)*g}b.onload=function(h){if(f.size>d.MAX_FILE_SIZE_BYTES){d.__resizeImage(h.target.result).then(function(i){d.__addImage(f.name,i,a)})}else{d.__addImage(f.name,h.target.result,a)}};b.readAsDataURL(f);var c=new FormData();c.append("file-0",f);c.append("accountId",GliffyApp.authController.getAccountId());c.append("filename",f.name);$.ajax({url:window.GLIFFY.API.getActionUrl("upload_image.json",null),data:c,cache:false,contentType:false,processData:false,type:"POST",success:function(h){GliffyApp.imageBrowserController.render();GLIFFY.Utils.analyticsEvent("trackEvent",{category:"imageBrowser",action:"uploadImageD&D",label:f.name})}})}),canHandleFile:function(a){return a.type==="image/jpeg"||a.type==="image/png"||a.type==="image/gif"},handleCustomLibraryUpload:function(e,d,c){var a=new window.FileReader(),b=this;a.onload=function(f){b.__generateThumbnail(f.target.result,50).then(function(g){if(e.size>b.MAX_FILE_SIZE_BYTES){b.__resizeImage(f.target.result).then(function(h){c.addFile({name:e.name,uid:"com.gliffy.shape.basic.basic_v1.default.image",data:h,thumbnail:g})})}else{c.addFile({name:e.name,uid:"com.gliffy.shape.basic.basic_v1.default.image",data:f.target.result,thumbnail:g})}},function(){c.addFile({name:e.name,uid:"com.gliffy.shape.basic.basic_v1.default.image",data:f.target.result,thumbnail:f.target.result});GLIFFY.Logger.warn("Failed to generate a thumbnail")})};a.readAsDataURL(e)},__generateThumbnail:function(a,f){var c=document.createElement("canvas"),i=c.getContext("2d"),d=new Image(),h=new $.Deferred(),b,e,g=this;d.onload=function(){e=g.__resize(d.width,d.height,f,f);c.width=f;c.height=f;i.drawImage(d,e.x,e.y,e.w,e.h);b=c.toDataURL("image/png");h.resolve(b)};d.onerror=function(){h.reject()};d.src=a;return h.promise()},__resize:function(l,c,a,d){var i=0,b=0,g=0,f=0,k=l/a,j=c/d,e=Math.max(k,j);if(e>1){i=l/e;b=c/e}else{i=l;b=c}g=(a-i)/2;f=(d-b)/2;return{w:i,h:b,x:g,y:f}},__addImage:function(b,e,a){var c,d;c=new GLIFFY.Node();d={name:b,thumbnail:e,doNotProxyImage:true,image:e,uid:"com.gliffy.shape.basic.basic_v1.default.image",tid:"com.gliffy.stencil.image",useOriginalDimensions:true};GLIFFY.Utils.analyticsEvent("trackEvent",{category:"fileDragAndDrop",action:"image"});this.drawManager.setupShape(c,d,a)},__resizeImage:function(h){var e=document.createElement("canvas"),a=e.getContext("2d"),d=new Image(),c=new $.Deferred(),g,f,b=this;d.onload=function(){var i=1;do{f=b.__resize(d.width,d.height,d.width/i,d.height/i);e.width=d.width/i;e.height=d.height/i;a.drawImage(d,f.x,f.y,f.w,f.h);g=e.toDataURL("image/png");i=i*2}while(g.length>b.MAX_FILE_SIZE_BYTES);c.resolve(g)};d.onerror=function(){c.reject()};d.src=h;return c.promise()}})}());(function(){GLIFFY.onlineUtils.override(GLIFFY.FileHandlerRegister,"register",function(a){this.add(new GLIFFY.UploadImageFileHandler(a));this.add(new GLIFFY.UrlFileHandler(a));this.add(this.SVG_FILE_HANDLER);this.add(this.DEFAULT_FILE_HANDLER)})}())}());