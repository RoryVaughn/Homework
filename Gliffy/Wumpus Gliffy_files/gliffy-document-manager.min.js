(function(){(function(){GliffyApp.DocumentManagerController=GliffyApp.AbstractFileDialogController.extend({init:function(){var a=this;this._super(".gliffy-document-manager");$(window).bind("focus",this.handleRefocus);$(window).resize(function(){$(".gliffy-document-title").css("max-width",GliffyApp.documentListController.getDocumentTitleMaxWidth())});$(window).bind("gliffy.loginEvent",function(b){GliffyApp.authController.refreshAccountSettings(function(){a.configAccountFolders();if(GliffyApp.authController.hasAccount()&&GliffyApp.authController.getGoogleDriveUserIcon()){$(".gliffy-profile-icon").css({"background-size":"20px 20px","background-position":"right","background-image":"url("+GliffyApp.authController.getGoogleDriveUserIcon()+")"})}})})},actions:{handleNewDiagramBasedOnTemplate:function(){if(GliffyApp.authController.hasPermission("diagramCount")){this.handleNewDiagram(window.GLIFFY.ENV.newDiagramFromTemplateUrl);$(".gliffy-document-create-button .gliffy-btn-primary").click()}else{GliffyApp.authController.showUpgradeDialog("diagramCount")}},handleNewFolder:function(){$(".gliffy-document-create-button .gliffy-btn-primary").click();if(!GliffyApp.accountFoldersController.getSelectedFolder()||GliffyApp.accountFoldersController.getSelectedFolder().attr("type")===GliffyApp.accountFoldersController.GLIFFY_ONLINE_DIAGRAM_STORAGE_TYPE){this.handleCreateNewFolder()}else{GliffyApp.accountFoldersController.displayFolderError("Creating google drive folders is not currently supported")}},handleNewDiagram:function(){if(GliffyApp.authController.hasPermission("diagramCount")){this.handleNewDiagram(window.GLIFFY.ENV.newDiagramUrl);$(".gliffy-document-create-button .gliffy-btn-primary").click()}else{GliffyApp.authController.showUpgradeDialog("diagramCount")}}},config:function(){this.createNewTab=true;GliffyApp.documentListController.isEditableItems=true;this.configDocumentList();this.configDocumentSearch();this.configDocumentSort();this.configAccountFolders();GliffyApp.accountFoldersController.allowDelete=true;this.configBindings();var a=this;GliffyApp.fileUploadController.createFileUploaderButton($(".gliffy-document-manager .gliffy-document-real-import-button"),this.__getImportOptions()).bind("giffy_fileUploadSuccess",function(c,b){GliffyApp.progressBarController.hide();GliffyApp.fileUploadController.importDocument();GLIFFY.Utils.analyticsEvent("trackEvent",{category:"import",action:"importSuccess",label:"documentManager;"+GLIFFY.onlineUtils.getFileHandle(b.filename)})}).bind("gliffy_fileUploadError",function(c,b){GliffyApp.progressBarController.hide();GLIFFY.Dialog.showAlertDialog({title:$.i18n._("ERRORHANDLER_ERROR"),content:$.i18n._("online.file.upload.import.error")+" "+b.reason+". "+$.i18n._("online.file.upload.import.error.action"),buttons:[{text:$.i18n._("DIALOG_OK"),primary:true,dismiss:true}]});GLIFFY.Utils.analyticsEvent("trackEvent",{category:"import",action:"importError",label:b.reason+";documentManager;"+GLIFFY.onlineUtils.getFileHandle(b.filename)})}).bind("gliffy_fileUploadProgress",function(c,b){GliffyApp.progressBarController.updateProgress(b.currentSize,b.totalSize)}).bind("gliffy_fileUploadStart",function(c,b){GliffyApp.progressBarController.show($.i18n._("online.welcome.importing")+" "+b)});GliffyApp.authController.addLoginCallback(function(){GliffyApp.fileUploadController.updateOptions($(".gliffy-document-manager .gliffy-document-real-import-button"),a.__getImportOptions())});$("#gliffy-anchor-feedback").click(function(b){b.preventDefault();GliffyApp.feedbackController.show()});$("#gliffy-google-drive-nav .dropdown-toggle").tooltip(GLIFFY.Editor.TOOLTIP_OPTIONS_STANDARD);$("#gliffy-account-logout-dropdown .dropdown-toggle").tooltip(GLIFFY.Editor.TOOLTIP_OPTIONS_STANDARD);$(".gliffy-help-menu-link-eula a").attr("href","/legal/terms-of-use");$(".gliffy-navbar-helpmenu-productVersion a").text($.i18n._("MENU_GLIFFY_VERSION",[window.GLIFFY.ENV.productVersion]));GliffyApp.accountManageController.accountLoad();this.analyticsEnabled=window.GLIFFY.ENV.isProduction;this.analyticsAccount="UA-248648-1";this.analyticsProduct="Online";this.analyticsLicense=GliffyApp.authController.getProductType();this.analyticsNumUsers=1;if(this.analyticsEnabled){GLIFFY.Utils.analyticsEvent("init",{accountType:"google",accountID:this.analyticsAccount,debug:false});if(this.analyticsLabel){GLIFFY.Utils.analyticsEvent("setLabel",{label:this.analyticsLabel})}GLIFFY.Utils.analyticsEvent("setCustomVariables",{product:this.analyticsProduct,license:this.analyticsLicense,numUsers:(this.analyticsNumUsers+" Users")})}},__getImportOptions:function(){return{url:window.GLIFFY.API.getActionUrl("upload_file.json"),allowExtensions:[GliffyApp.fileUploadController.FILE_EXTENSION_GON,GliffyApp.fileUploadController.FILE_EXTENSION_GXML,GliffyApp.fileUploadController.FILE_EXTENSION_GLIFFY,GliffyApp.fileUploadController.FILE_EXTENSION_VDX],buttonText:$.i18n._("online.welcome.import"),click:function(a){GLIFFY.Utils.analyticsEvent("trackEvent",{category:"documentManager",action:"importClick"})}}},configBindings:function(){$(".gliffy-document-manager .gliffy-document-list").bind("documentListItemOpen",function(b,a){GliffyApp.documentManagerController.open(a);GLIFFY.Utils.analyticsEvent("trackEvent",{category:"documentManager",action:"documentOpen"})});$(".gliffy-document-manager .gliffy-document-list").scroll(function(a){GliffyApp.documentManagerController.handleDocumentListScroll(a)});$(".gliffy-document-manager .gliffy-document-list").bind("scrollStart",function(a){GliffyApp.documentManagerController.handleDocumentListScrollStart(a)});$(".gliffy-document-manager .gliffy-document-list").bind("scrollEnd",function(a){GliffyApp.documentManagerController.handleDocumentListScrollEnd(a)});$(".gliffy-document-manager .gliffy-account-folders").scroll(function(a){GliffyApp.accountFoldersController.scroll(a,this)});$(".gliffy-document-manager .gliffy-account-folders").bind("scrollStart",function(a){GliffyApp.accountFoldersController.scrollStart(a)});$(".gliffy-document-manager .gliffy-account-folders").bind("scrollEnd",function(a){GliffyApp.accountFoldersController.scrollEnd(a)});$(".gliffy-document-manager .gliffy-document-sort-dropdown").delegate("a","click",function(a){a.preventDefault();GliffyApp.documentManagerController.sortDocumentList($(a.currentTarget).data("gliffy-sort-key"),$(a.currentTarget).data("gliffy-sort-order"))});$(".gliffy-document-manager .gliffy-document-search a").on("click",function(a){GliffyApp.documentManagerController.search($(".gliffy-document-manager .gliffy-document-search input").attr("value"))});$(".gliffy-document-manager .gliffy-document-search input").on("keyup",function(a){if(a.keyCode===13){GliffyApp.documentManagerController.search($(".gliffy-document-manager .gliffy-document-search input").attr("value"))}});$(".gliffy-document-manager .gliffy-account-folders-container").bind("folderClicked",function(b,a){GliffyApp.documentManagerController.handleFolderClick(a)});$(window).resize(function(a){GliffyApp.accountFoldersController.positionSelectionBar()});$(".gliffy-document-manager .gliffy-account-folders").scroll(function(a){GliffyApp.accountFoldersController.positionSelectionBar()});$(".gliffy-document-manager .gliffy-common-folder span").hover(function(){GliffyApp.accountFoldersController.hideHoverBar();$(this).parent().addClass("gliffy-folder-hovered")},function(){$(this).parent().removeClass("gliffy-folder-hovered")})},handleRefocus:function(a){GliffyApp.authController.refreshAccountSettings();if(GliffyApp.authController.hasAccount()&&GliffyApp.authController.getGoogleDriveUserIcon()){$(".gliffy-profile-icon").css({"background-size":"20px 20px","background-position":"right","background-image":"url("+GliffyApp.authController.getGoogleDriveUserIcon()+")"})}},handleCreateNewFolder:function(){GliffyApp.accountFoldersController.showCreateFolderModal();GLIFFY.Utils.analyticsEvent("trackEvent",{category:"documentManager",action:"createNewFolderClick"})},handleNewDiagram:function(b){var c="";var a=GliffyApp.accountFoldersController.getSelectedFolderType();if(a===GliffyApp.accountFoldersController.GLIFFY_ONLINE_DIAGRAM_STORAGE_TYPE){c+="&folderId="+GliffyApp.accountFoldersController.getSelectedFolderId()}else{if(a===GliffyApp.accountFoldersController.GOOGLE_DRIVE_DIAGRAM_STORAGE_TYPE){b="/go/gdrive/create?folderId="+GliffyApp.accountFoldersController.getSelectedFolderId()}else{c+="&folderId="+GliffyApp.accountFoldersController.rootFolderId}}window.open(b+c);GLIFFY.Utils.analyticsEvent("trackEvent",{category:"documentManager",action:"createNewDiagramClick",value:a})}});GliffyApp.documentManagerController=GliffyApp.DocumentManagerController.create()}());(function(){GliffyApp.DocumentManagerCreateButtonView=Ember.View.extend({didInsertElement:function(){$(".gliffy-document-create-button .gliffy-btn-primary").on("click",function(b){b.preventDefault();var a=GliffyApp.accountFoldersController.getSelectedFolderTitle();if(a===null){a="Account Diagrams"}$(b.currentTarget).parent().find(".gliffy-menu-item-new-diagram").html("New Diagram in folder "+a)})}})}());(function(){GliffyApp.FolderRenameModalView=GliffyApp.AbstractInputModalView.extend({didInsertElement:function(){var a=this;this.set("titleText",$.i18n._("online.folder.rename.folder"));this.set("submitButtonText",$.i18n._("online.folder.update"));this.set("inputPlaceholderText",$.i18n._("online.folder.rename.folder.untitled"));$("#gliffy-folder-rename-modal input").on("keydown",function(b){a.handleInputKeyDown(b)});$("#gliffy-folder-rename-modal .gliffy-btn-primary").on("click",function(b){a.handleSubmit(b)})},handleSubmit:function(c){this._super(c);var b=$("a.jstree-clicked");var a=$("#gliffy-folder-rename-modal input").val();GliffyApp.accountFoldersController.renameFolder(b,a,function(){$("#gliffy-folder-rename-modal .gliffy-modal").modal("hide")})}})}())}());